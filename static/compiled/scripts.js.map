{"version":3,"file":"scripts.js","mappings":"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","sources":["webpack://march-tales/./src/assets/helpers/CommonHelpers.js","webpack://march-tales/./src/assets/CommonNotify/CommonNotifySingleton.ts","webpack://march-tales/./src/assets/helpers/getJsText.ts","webpack://march-tales/./src/assets/helpers/sendApiRequest.ts","webpack://march-tales/./src/assets/track-blocks/localTrackInfoDb.ts","webpack://march-tales/./src/assets/track-blocks/TrackInfo.ts","webpack://march-tales/./src/assets/entities/ActivePlayerData/ActivePlayerData.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/FloatingPlayerState.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/HiddenPlayer.ts","webpack://march-tales/./src/assets/track-blocks/tracksPlayer.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/FloatingPlayerCallbacks.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/FloatingPlayerClass.ts","webpack://march-tales/./src/assets/entities/ActivePlayerData/getActivePlayerDataFromTrackNode.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/floatingPlayer.ts"],"sourcesContent":["// @ts-check\n\nexport function NOOP() {}\n\n/** Compare two arrays with scalar (number, string, boolean) values\n * @param {(number | string | boolean)[]} a1\n * @param {(number | string | boolean)[]} a2\n * @return {boolean}\n */\nexport function compareArrays(a1, a2) {\n  if (!a1 || !a1) {\n    return a1 === a2;\n  }\n  if (a1.length !== a2.length) {\n    return false;\n  }\n  // Compare all the items...\n  for (let i = 0; i < a1.length; i++) {\n    if (a1[i] !== a2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/** getErrorText - Return plain text for error.\n * @param {string|Error|string[]|Error[]} error - Error or errors list.\n * @return {string}\n */\nexport function getErrorText(error) {\n  if (!error) {\n    return;\n  }\n  if (Array.isArray(error)) {\n    return error.map(this.getErrorText.bind(this)).join('\\n');\n  }\n  if (error instanceof Error) {\n    error = error.message;\n  } else if (typeof error !== 'string') {\n    // TODO?\n    error = String(error);\n  }\n  return error;\n}\n\n/** quoteHtmlAttr -- quote all invalid characters for html\n * @param {string} str\n * @param {boolean} [preserveCR]\n */\nexport function quoteHtmlAttr(str, preserveCR) {\n  const crValue = preserveCR ? '&#13;' : '\\n';\n  return (\n    String(str) // Forces the conversion to string\n      .replace(/&/g, '&amp;') // This MUST be the 1st replacement\n      .replace(/'/g, '&apos;') // The 4 other predefined entities, required\n      .replace(/\"/g, '&quot;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      // You may add other replacements here for HTML only (but it's not\n      // necessary). Or for XML, only if the named entities are defined in its\n      // DTD.\n      .replace(/\\r\\n/g, crValue) // Must be before the next replacement\n      .replace(/[\\r\\n]/g, crValue)\n  );\n}\n\n/** htmlToElement -- Create dom node instance from html string\n * @param {string} html - Html representing a single element\n * @return {HTMLElement}\n */\nexport function htmlToElement(html) {\n  const template = document.createElement('template');\n  if (Array.isArray(html)) {\n    html = html.join('');\n  }\n  html = html.trim(); // Never return a text node of whitespace as the result\n  template.innerHTML = html;\n  const content = template.content;\n  return /** @type HTMLElement */ (content.firstChild);\n}\n\n/** htmlToElements -- Convert text html representation to HTMLCollection object\n * @param {string|string[]} html\n * @return {HTMLCollection}\n */\nexport function htmlToElements(html) {\n  const template = document.createElement('template');\n  if (Array.isArray(html)) {\n    html = html.join('');\n  }\n  html = html.trim(); // Never return a text node of whitespace as the result\n  template.innerHTML = html;\n  const content = template.content;\n  return content.children;\n}\n\n/** updateNodeContent -- Replace all inner dom node content.\n * @param {Element} node\n * @param {THtmlContent} content\n */\nexport function updateNodeContent(node, content) {\n  if (!node) {\n    throw new Error('Undefined node to update content');\n  }\n  if (typeof content === 'string') {\n    // Replace with string content...\n    node.innerHTML = content;\n  } else if (Array.isArray(content)) {\n    // Replace multiple elements...\n    node.replaceChildren.apply(node, content);\n  } else {\n    // Replace single element...\n    node.replaceChildren(content);\n  }\n}\n\n/** decodeQuery\n * @param {string | string[]} qs\n * @param {string} [sep]\n * @param {string} [eq]\n * @param {any} [options]\n * @returns {{}}\n */\nexport function decodeQuery(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  /** @type {Record<string, unknown> | unknown[]} */\n  const obj = {};\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n  const regexp = /\\+/g;\n  qs = qs.split(sep);\n  let maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n  let len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n  for (let i = 0; i < len; ++i) {\n    const x = qs[i].replace(regexp, '%20'),\n      idx = x.indexOf(eq);\n    let kstr, vstr;\n    if (idx >= 0) {\n      kstr = x.substring(0, idx);\n      vstr = x.substring(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n    const k = decodeURIComponent(kstr);\n    const v = decodeURIComponent(vstr);\n    const it = obj[k];\n    if (!Object.prototype.hasOwnProperty.call(obj, k)) {\n      obj[k] = v;\n    } else if (Array.isArray(it)) {\n      it.push(v);\n    } else {\n      obj[k] = [it, v];\n    }\n  }\n  return obj;\n}\n\n/** parseQuery -- Parse url query string (in form `?xx=yy&...` or `xx=yy&...`)\n * @param {string} search  - Query string\n * @return {Record<string, string>} query - Query object\n */\nexport function parseQuery(search) {\n  if (!search) {\n    return {};\n  }\n  if (search.indexOf('?') === 0) {\n    search = search.substring(1);\n  }\n  return decodeQuery(search);\n}\n\n/** makeQuery\n * @param {Record<string, string | number | boolean> | {}} params\n * @param {{ addQuestionSymbol?: boolean; useEmptyStrings?: boolean; useUndefinedValues?: boolean }} opts\n * @returns {string}\n */\nexport function makeQuery(params, opts = {}) {\n  let url = Object.entries(params)\n    .map(([id, val]) => {\n      const valStr = String(val);\n      if (val == undefined && !opts.useUndefinedValues) {\n        return undefined;\n      }\n      if (valStr === '' && !opts.useEmptyStrings) {\n        return undefined;\n      }\n      return encodeURI(id) + '=' + encodeURI(String(val == undefined ? '' : val));\n    })\n    .filter(Boolean)\n    .join('&');\n  if (opts.addQuestionSymbol && url) {\n    url = '?' + url;\n  }\n  return url;\n}\n\n/** Dynamically load external script\n * @param {string} url\n * @return {Promise<Event>}\n */\nexport function addScript(url) {\n  return new Promise((resolve, reject) => {\n    // document.write('<script src=\"' + url + '\"></script>');\n    const script = document.createElement('script');\n    script.setAttribute('src', url);\n    script.addEventListener('load', resolve);\n    script.addEventListener('error', (event) => {\n      const {\n        target,\n        // srcElement,\n      } = event;\n      // @ts-ignore\n      const { href, baseURI } = target;\n      const error = new Error(`Cannot load script resurce by url '${url}'`);\n      // eslint-disable-next-line no-console\n      console.error('[CommonHelpers:addScript]', {\n        error,\n        url,\n        href,\n        baseURI,\n        target,\n        event,\n      });\n      // eslint-disable-next-line no-debugger\n      debugger;\n      reject(error);\n    });\n    document.head.appendChild(script);\n  });\n}\n\n/** Dynamically load external css\n * @param {string} url\n * @return {Promise<unknown>}\n */\nexport function addCssStyle(url) {\n  return new Promise((resolve, reject) => {\n    // Try to find exists node...\n    const testNode = document.head.querySelector(\n      'link[href=\"' + url + '\"], link[data-url=\"' + url + '\"]',\n    );\n    if (testNode) {\n      // Style already found!\n      return resolve({ type: 'already-loaded', target: testNode });\n    }\n    // reject(new Error('test')); // DEBUG: Test errors catching\n    const node = document.createElement('link');\n    node.setAttribute('href', url);\n    node.setAttribute('type', 'text/css');\n    node.setAttribute('rel', 'stylesheet');\n    node.setAttribute('data-url', url);\n    node.addEventListener('load', resolve);\n    node.addEventListener('error', (event) => {\n      const {\n        target,\n        // srcElement,\n      } = event;\n      // @ts-ignore\n      const { href, baseURI } = target;\n      const error = new Error(`Cannot load css resurce by url '${url}'`);\n      // eslint-disable-next-line no-console\n      console.error('[CommonHelpers:addCssStyle]', {\n        error,\n        url,\n        href,\n        baseURI,\n        target,\n        event,\n      });\n      // eslint-disable-next-line no-debugger\n      debugger;\n      reject(error);\n    });\n    document.head.appendChild(node);\n  });\n}\n\n/**\n * @param {HTMLSelectElement} node\n * @param {(string|number)[]} values\n */\nexport function setMultipleSelectValues(node, values) {\n  const strValues = values.map(String);\n  const options = Array.from(node.options);\n  options.forEach((item) => {\n    const { value, selected } = item;\n    const isSelected = strValues.includes(value);\n    if (isSelected !== selected) {\n      item.selected = isSelected;\n    }\n  });\n}\n\n/** processMultipleRequestErrors\n * @param {Response[]} resList\n * @return {Error[]}\n */\nexport function processMultipleRequestErrors(resList) {\n  return /** @type {Error[]} */ (\n    resList\n      .map((res) => {\n        if (!res.ok) {\n          return new Error(`Can't load url '${res.url}': ${res.statusText}, ${res.status}`);\n        }\n      })\n      .filter(Boolean)\n  );\n}\n\n/**\n * @param {number} n\n * @param {TNormalizedFloatStrOptions} [opts={}]\n * @returns {string}\n */\nexport function normalizedFloatStr(n, opts = {}) {\n  const {\n    // prettier-ignore\n    fixedPoint = 2,\n    stripFixedZeros = true,\n  } = opts;\n  let str = n.toFixed(fixedPoint);\n  if (stripFixedZeros) {\n    str = str.replace(/\\.*0+$/, '');\n  }\n  return str;\n}\n/**\n * @param {number} size\n * @param {TGetApproxSizeOptions} [opts={}]\n * @returns {[number | string, string]}\n */\nexport function getApproxSize(size, opts = {}) {\n  const { normalize } = opts;\n  const levels = [\n    'B', // Bytes\n    'K', // Kilobytes\n    'M', // Megabytes\n    'G', // Gigabites\n  ];\n  const lastLevel = levels.length - 1;\n  const range = 1024;\n  let level = 0;\n  while (level < lastLevel) {\n    if (size < range) {\n      break;\n    }\n    size /= range;\n    level++;\n  }\n  const currLevelStr = levels[level];\n  /** Result: final number or normalized representation (depends on option's `normalize`)\n   * @type {number | string}\n   */\n  let result = size;\n  if (normalize) {\n    const normalizeOpts = typeof normalize === 'object' ? normalize : undefined;\n    result = normalizedFloatStr(size, normalizeOpts);\n  }\n  return [result, currLevelStr];\n}\n\n/** @param {number} time - Time duration, ms\n * @return {string}\n */\nexport function formatDuration(time) {\n  const sec = time / 1000;\n  const min = sec / 60;\n  const hrs = min / 60;\n  const days = hrs / 24;\n  const srcItems = [\n    // prettier-ignore\n    days,\n    hrs % 24,\n    min % 60,\n    sec % 60,\n  ];\n  const items = srcItems.map(Math.floor).map((val, idx) => {\n    // Not mins and secs and empty...\n    if (idx < 2 && !val) {\n      return undefined;\n    }\n    // Hours, mins, secs...\n    if (idx >= 1) {\n      return String(val).padStart(2, '0');\n    }\n    // Days...\n    if (!idx) {\n      return String(val) + 'd';\n    }\n  });\n  /* console.log('[CommonHelpers:formatDuration]', {\n   *   sec,\n   *   min,\n   *   hrs,\n   *   days,\n   *   items,\n   *   srcItems,\n   *   time,\n   * });\n   */\n  const daysStr = items.shift();\n  return [\n    // prettier-ignore\n    daysStr,\n    items.filter(Boolean).join(':'),\n  ]\n    .filter(Boolean)\n    .join(' ');\n}\n\n/** @param {string} str */\nexport function getAsyncHash(str) {\n  const encoder = new TextEncoder();\n  const buf = encoder.encode(str);\n  return crypto.subtle.digest('SHA-256', buf).then((aryBuf) => {\n    const ary = new Uint8Array(aryBuf);\n    const res = Array.from(ary)\n      .map((x) => x.toString(16).padStart(2, '0'))\n      .join('');\n    return res;\n  });\n}\n\n/** @param {string} cookieId */\nexport function getCookie(cookieId) {\n  const cookiesStr = document.cookie;\n  const cookiesList = cookiesStr.split(';'); // .map((s) => s.trim().split('='));\n  for (let i = 0; i < cookiesList.length; i++) {\n    const s = cookiesList[i];\n    const [id, val] = s.trim().split('=').map(decodeURIComponent);\n    if (id === cookieId) {\n      return val;\n    }\n  }\n  return undefined;\n}\n\n/**\n * @param {string} id\n * @param {string} val\n * @param {number} maxAgeSecs -- Seconds of expire period\n */\nexport function setCookie(id, val, maxAgeSecs) {\n  const cookieVal = [id, val || ''].map(encodeURIComponent).join('=');\n  const parts = [\n    // prettier-ignore\n    cookieVal,\n  ];\n  if (maxAgeSecs) {\n    parts.push('max-age=' + maxAgeSecs);\n  }\n  const fullCookie = parts.filter(Boolean).join(';');\n  document.cookie = fullCookie;\n}\n","import * as CommonHelpers from '../helpers/CommonHelpers';\n\n/** Toast types */\ntype TMode = 'info' | 'error' | 'warn' | 'success';\n\n/** Icon shapes (move to constants?) */\nconst icons: Record<TMode, string> = {\n  success: 'bi-check',\n  error: 'bi-exclamation-triangle-fill',\n  warn: 'bi-bell-fill',\n  info: 'bi-info-lg',\n};\n\nconst iconClassNamePrefix = 'bi';\n\ninterface TNotifyData {\n  node: HTMLDivElement;\n  handler?: TSetTimeout;\n}\n\n// Define module...\nclass CommonNotify {\n  notifyRoot: HTMLDivElement = undefined;\n\n  timeoutDelay = 3000;\n\n  inited = false;\n\n  // Methods...\n\n  removeNotify(notifyData: TNotifyData) {\n    const { node, handler } = notifyData;\n    // Play animation...\n    node.classList.remove('active');\n    if (handler) {\n      clearTimeout(handler);\n      notifyData.handler = undefined;\n    }\n    setTimeout(() => {\n      // ...And remove node (TODO: Check if node still exists in dom tree)...\n      try {\n        this.notifyRoot.removeChild(node);\n      } catch (\n        _e // eslint-disable-line @typescript-eslint/no-unused-vars\n      ) {\n        // NOOP\n      }\n    }, 250); // Value of `var(--common-animation-time)`\n  }\n\n  /** showNotify\n   * @param {'info' | 'error' | 'warn' | 'success'} mode - Message type ('info' is default)\n   * @param {string|Error} text - Message content\n   */\n  showNotify(mode: TMode, text: string | Error) {\n    this.ensureInit();\n    if (!text) {\n      // If only one parameters passed assume it as message with default type\n      text = mode;\n      mode = 'info';\n    }\n    let content: string;\n    if (text instanceof Error) {\n      // Convert error object to the plain text...\n      content = CommonHelpers.getErrorText(text);\n    } else {\n      content = String(text);\n    }\n    // Create node...\n    const node = document.createElement('div');\n    node.classList.add('notify');\n    node.classList.add('notify-' + mode);\n    // Add icon...\n    const nodeIcon = document.createElement('span');\n    nodeIcon.classList.add('icon');\n    nodeIcon.classList.add(iconClassNamePrefix);\n    nodeIcon.classList.add(icons[mode]);\n    node.appendChild(nodeIcon);\n    // Add text...\n    const nodeText = document.createElement('div');\n    nodeText.classList.add('text');\n    nodeText.innerHTML = content;\n    node.appendChild(nodeText);\n    this.notifyRoot.appendChild(node);\n    // Play appearing animation...\n    window.requestAnimationFrame(() => {\n      setTimeout(() => {\n        node.classList.add('active');\n      }, 10);\n    });\n    // Remove node after delay...\n    const notifyData: TNotifyData = { node, handler: undefined };\n    const removeNotifyHandler = this.removeNotify.bind(this, notifyData);\n    notifyData.handler = setTimeout(removeNotifyHandler, this.timeoutDelay);\n    // Stop & restore timer on mouse in and out events...\n    node.addEventListener('mouseenter', () => {\n      // Clear timer...\n      clearTimeout(notifyData.handler);\n    });\n    node.addEventListener('mouseleave', () => {\n      // Resume timer...\n      notifyData.handler = setTimeout(removeNotifyHandler, this.timeoutDelay);\n    });\n    // Click handler...\n    node.addEventListener('click', removeNotifyHandler);\n  }\n\n  // Some shorthands...\n\n  /** @param {string|Error} text - Message content */\n  showInfo(text: string | Error) {\n    this.showNotify('info', text);\n  }\n\n  /** @param {string|Error} text - Message content */\n  showSuccess(text: string | Error) {\n    this.showNotify('success', text);\n  }\n\n  /** @param {string|Error} text - Message content */\n  showWarn(text: string | Error) {\n    this.showNotify('warn', text);\n  }\n\n  /** @param {string|Error} text - Message content */\n  showError(text: string | Error) {\n    this.showNotify('error', text);\n  }\n\n  // Demo...\n\n  showDemo() {\n    // DEBUG: Show sample notifiers...\n    this.showInfo('Info');\n    this.showSuccess('Success');\n    this.showWarn('Warn');\n    this.showError('Error');\n  }\n\n  // Initialization...\n\n  /** Ensure the modal has initiazlized */\n  ensureInit() {\n    this.init();\n  }\n\n  createDomNode() {\n    // TODO: To use bootstrap toasts?\n    const rootNode = document.body;\n    const notifyRoot = document.createElement('div');\n    notifyRoot.classList.add('notify-root');\n    notifyRoot.setAttribute('id', 'notify-root');\n    rootNode.appendChild(notifyRoot);\n    this.notifyRoot = notifyRoot;\n  }\n\n  /** Initialize nodule. */\n  init() {\n    if (!this.inited) {\n      this.createDomNode();\n      this.inited = true;\n    }\n  }\n}\n\n// Create and export singletone\nexport const commonNotify = new CommonNotify();\n\n// commonNotify.init();\n","import { quoteHtmlAttr } from '../helpers/CommonHelpers';\n\nexport function getJsText(id: string) {\n  const textNode = document.body.querySelector('#js-texts #' + id);\n  if (!textNode) {\n    // eslint-disable-next-line no-console\n    console.warn('[getJsText] Can not find js text node for id:', id);\n  }\n  const text = textNode?.innerHTML || id;\n  return quoteHtmlAttr(text).trim();\n}\n","import { getCookie } from '../helpers/CommonHelpers';\nimport * as CommonHelpers from '../helpers/CommonHelpers';\nimport { getJsText } from './getJsText';\n\nexport function sendApiRequest(\n  url: string,\n  method: string = 'GET',\n  requestData: unknown = undefined,\n) {\n  const csrftoken = getCookie('csrftoken');\n  // const sessionId = getCookie('sessionid');\n  // const url = `/api/v1/tracks/${trackId}/toggle-favorite/`;\n  const headers = {\n    Accept: 'application/json',\n    'Content-Type': 'application/json',\n    'X-CSRFToken': csrftoken,\n    // Credentials: 'include',\n    // Cookie: csrftoken && `csrftoken=${csrftoken}`,\n    // 'X-Session-Token': sessionId, // X-Session-Token\n    // 'Accept-Language': 'ru', // django_language=ru; content-language: ru;\n  };\n  /* console.log('[sendApiRequest] start', {\n   *   url,\n   *   method,\n   *   requestData,\n   *   headers,\n   * });\n   */\n  return fetch(url, {\n    method,\n    headers,\n    credentials: 'include',\n    body: requestData && JSON.stringify(requestData),\n  })\n    .then(async (res) => {\n      const { ok, status, statusText } = res;\n      // TODO: Check is it json?\n      let data: unknown & { detail?: string };\n      try {\n        data = await res.json();\n      } catch (\n        _e // eslint-disable-line @typescript-eslint/no-unused-vars\n      ) {\n        // NOOP\n      }\n      if (!ok || status !== 200) {\n        const errMsg = [getJsText('fetchError') + ' ' + status, data?.detail || statusText]\n          .filter(Boolean)\n          .join(': ');\n        // eslint-disable-next-line no-console\n        console.error('[sendApiRequest]', errMsg, {\n          ok,\n          data,\n          statusText,\n          status,\n          res,\n          url,\n          requestData,\n          method,\n          headers,\n        });\n        debugger; // eslint-disable-line no-debugger\n        throw new Error(errMsg);\n      }\n      /* console.log('[sendApiRequest] Got json', {\n       *   data,\n       *   url,\n       *   requestData,\n       *   method,\n       *   headers,\n       * });\n       */\n      return data as unknown;\n    })\n    .catch((err) => {\n      const errMsg = [getJsText('failedApiRequest'), CommonHelpers.getErrorText(err)]\n        .filter(Boolean)\n        .join(': ');\n      // eslint-disable-next-line no-console\n      console.error('[sendApiRequest]', errMsg, {\n        err,\n        url,\n        requestData,\n        method,\n        headers,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw new Error(errMsg);\n    });\n}\n","import { TrackInfo, trackInfoFromJsonStr, trackInfoToJsonStr } from './TrackInfo';\n\nclass LocalTrackInfoDb {\n  // End-user api\n\n  updatePlayedCount(id: number, playedCount?: number, now?: number) {\n    try {\n      const _now = now || Date.now();\n      const trackInfo = this.getOrCreate(id);\n      if (isNaN(playedCount)) {\n        trackInfo.playedCount = trackInfo.playedCount ? trackInfo.playedCount + 1 : 1;\n      } else {\n        trackInfo.playedCount = playedCount;\n      }\n      trackInfo.lastPlayed = _now;\n      trackInfo.lastUpdated = _now;\n      this.insert(trackInfo);\n      // this.updateEvents.broadcast(TracksInfoDbUpdate(trackInfo));\n      return trackInfo;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error('[LocalTrackInfoDb:incrementPlayedCount]', err.message, {\n        err,\n        id,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw err;\n    }\n  }\n\n  updatePosition(id: number, position: number, now?: number) {\n    try {\n      const _now = now || Date.now();\n      const trackInfo = this.getOrCreate(id);\n      trackInfo.position = position;\n      trackInfo.lastPlayed = _now; // ???\n      trackInfo.lastUpdated = _now;\n      this.insert(trackInfo);\n      // this.updateEvents.broadcast(TracksInfoDbUpdate(trackInfo));\n      return trackInfo;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error('[LocalTrackInfoDb:updatePosition]', err.message, {\n        err,\n        id,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw err;\n    }\n  }\n\n  updateFavorite(id: number, favorite: boolean, now?: number) {\n    try {\n      const _now = now || Date.now();\n      const trackInfo = this.getOrCreate(id);\n      trackInfo.favorite = favorite;\n      trackInfo.lastUpdated = _now;\n      this.insert(trackInfo);\n      this._toggleInFavoritesIndex(id, favorite);\n      // this.updateEvents.broadcast(TracksInfoDbUpdate(trackInfo));\n      return trackInfo;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error('[LocalTrackInfoDb:setFavorite]', err.message, {\n        err,\n        id,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw err;\n    }\n  }\n\n  updateFavoritesByTrackIds(ids: number[], now?: number) {\n    const _now = now || Date.now();\n    const index = this._getIndex();\n    index.forEach((id) => {\n      const isFavorite = ids.includes(id);\n      const trackInfo = this.getOrCreate(id);\n      if (trackInfo.favorite !== isFavorite) {\n        trackInfo.favorite = isFavorite;\n        trackInfo.lastUpdated = _now;\n        this.insert(trackInfo);\n      }\n    });\n    this._setFavoritesIndex(ids);\n  }\n\n  save(trackInfo: TrackInfo, now?: number) {\n    try {\n      const _now = now || Date.now();\n      trackInfo.lastPlayed = _now; // ???\n      trackInfo.lastUpdated = _now;\n      this.insert(trackInfo);\n      // this.updateEvents.broadcast(TracksInfoDbUpdate(trackInfo));\n      // const testTrackInfo = await this.getById(id);\n      return trackInfo;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error('[LocalTrackInfoDb:save]', err.message, {\n        err,\n        trackInfo,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw err;\n    }\n  }\n\n  // Low-level api\n\n  createNewRecord(id: number) {\n    const now = Date.now();\n    const trackInfo: TrackInfo = {\n      id: id, // track.id\n      favorite: false,\n      playedCount: 0, // track.played_count (but only for current user!).\n      position: 0, // position\n      lastUpdated: now, // DateTime.now()\n      lastPlayed: 0, // DateTime.now()\n    };\n    return trackInfo;\n  }\n\n  getOrCreate(id: number) {\n    return this.getById(id) || this.createNewRecord(id);\n  }\n\n  /// Create or update the record. (Returns inserted/updated record id.)\n  insert(trackInfo: TrackInfo) {\n    const { id } = trackInfo;\n    window.localStorage.setItem('trackInfo-' + id, trackInfoToJsonStr(trackInfo));\n    this._addToIndex(id);\n  }\n\n  getFavorites() {\n    return this.getAll().filter((it) => it.favorite);\n  }\n\n  getById(id: number) {\n    const str = window.localStorage.getItem('trackInfo-' + id);\n    if (!str) {\n      return undefined;\n    }\n    return trackInfoFromJsonStr(str);\n  }\n\n  _getFavoritesIndex() {\n    try {\n      const data = window.localStorage.getItem('trackInfoFavoritesIndex');\n      return (data ? JSON.parse(data) : []) as number[];\n    } catch (\n      _ // eslint-disable-line @typescript-eslint/no-unused-vars\n    ) {\n      return [] as number[];\n    }\n  }\n\n  _setFavoritesIndex(favoritesIndex: number[]) {\n    window.localStorage.setItem('trackInfoFavoritesIndex', JSON.stringify(favoritesIndex));\n  }\n\n  _addToFavoritesIndex(id: number) {\n    const favoritesIndex = this._getFavoritesIndex();\n    if (!favoritesIndex.includes(id)) {\n      favoritesIndex.push(id);\n      this._setFavoritesIndex(favoritesIndex);\n    }\n  }\n\n  _removeFromFavoritesIndex(id: number) {\n    const favoritesIndex = this._getFavoritesIndex();\n    if (favoritesIndex.includes(id)) {\n      this._setFavoritesIndex(favoritesIndex.filter((checkId) => id !== checkId));\n    }\n  }\n\n  _toggleInFavoritesIndex(id: number, value?: boolean) {\n    if (value) {\n      this._addToFavoritesIndex(id);\n    } else {\n      this._removeFromFavoritesIndex(id);\n    }\n  }\n\n  _getIndex() {\n    try {\n      const data = window.localStorage.getItem('trackInfoIndex');\n      return (data ? JSON.parse(data) : []) as number[];\n    } catch (\n      _ // eslint-disable-line @typescript-eslint/no-unused-vars\n    ) {\n      return [] as number[];\n    }\n  }\n\n  _setIndex(index: number[]) {\n    window.localStorage.setItem('trackInfoIndex', JSON.stringify(index));\n  }\n\n  _addToIndex(id: number) {\n    const index = this._getIndex();\n    if (!index.includes(id)) {\n      index.push(id);\n      this._setIndex(index);\n    }\n  }\n\n  _removeFromIndex(id: number) {\n    const index = this._getIndex();\n    if (index.includes(id)) {\n      this._setIndex(index.filter((checkId) => id !== checkId));\n    }\n  }\n\n  _toggleInIndex(id: number, value?: boolean) {\n    if (value) {\n      this._addToIndex(id);\n    } else {\n      this._removeFromIndex(id);\n    }\n  }\n\n  getAll() {\n    const index = this._getIndex();\n    const list: TrackInfo[] = index\n      .map((id) => {\n        return this.getById(id);\n      })\n      .filter(Boolean);\n    return list;\n  }\n\n  delete(id: number) {\n    window.localStorage.removeItem('trackInfo-' + id);\n    this._removeFromIndex(id);\n  }\n\n  clearAll() {\n    const index = this._getIndex();\n    index.forEach((id) => {\n      window.localStorage.removeItem('trackInfo-' + id);\n    });\n    this._setIndex([]);\n  }\n}\n\n// Create a singleton\nexport const localTrackInfoDb = new LocalTrackInfoDb();\n","export interface TrackInfo {\n  id: number; // track.id\n  favorite: boolean;\n  playedCount: number; // track.played_count (but only for current user!).\n  position: number; // position?.inMilliseconds ?? 0\n  lastUpdated: number; // DateTime.now().millisecondsSinceEpoch <-> DateTime.fromMillisecondsSinceEpoch(ms)\n  lastPlayed: number; // DateTime.now().millisecondsSinceEpoch <-> DateTime.fromMillisecondsSinceEpoch(ms)\n}\n\nexport function trackInfoFromJsonStr(str: string) {\n  if (!str) {\n    return undefined;\n  }\n  const list: (boolean | number)[] = JSON.parse(str);\n  const [id, favorite, playedCount, position, lastUpdated, lastPlayed] = list;\n  const trackInfo: TrackInfo = {\n    id,\n    favorite: Boolean(favorite),\n    playedCount,\n    position,\n    lastUpdated,\n    lastPlayed,\n  } as TrackInfo;\n  return trackInfo;\n}\n\nexport function trackInfoToJsonStr(trackInfo: TrackInfo) {\n  const { id, favorite, playedCount, position, lastUpdated, lastPlayed } = trackInfo;\n  const list = [id, Number(favorite), playedCount, position, lastUpdated, lastPlayed];\n  return JSON.stringify(list);\n}\n","export interface ActivePlayerData {\n  id: number;\n  title: string;\n  imageUrl: string;\n  mediaUrl: string;\n  duration: number;\n  // position: number;\n  // status?: string;\n}\n\nconst storageActivePlayerDataId = 'ActivePlayerData';\n\nfunction convertActivePlayerDataToJsonStr(data: ActivePlayerData) {\n  return JSON.stringify(data);\n}\n\nfunction convertActivePlayerDataFromJsonStr(str: string) {\n  return str ? (JSON.parse(str) as ActivePlayerData) : undefined;\n}\n\nexport function saveActivePlayerData(data?: ActivePlayerData) {\n  const str = data ? convertActivePlayerDataToJsonStr(data) : '';\n  window.localStorage.setItem(storageActivePlayerDataId, str);\n}\n\nexport function loadActivePlayerData() {\n  const str = window.localStorage.getItem(storageActivePlayerDataId);\n  return convertActivePlayerDataFromJsonStr(str);\n}\n","export interface FloatingPlayerState {\n  lastTimestamp?: number;\n  visible?: boolean;\n  loaded?: boolean;\n  // playing?: boolean;\n  status?: 'playing' | 'paused' | 'waiting' | undefined;\n  position?: number;\n  progress?: number;\n  error?: string;\n}\n\nconst storageFloatingPlayerStateId = 'FloatingPlayerState';\n\nfunction convertFloatingPlayerStateToJsonStr(data: FloatingPlayerState) {\n  return JSON.stringify(data);\n}\n\nfunction convertFloatingPlayerStateFromJsonStr(str: string) {\n  return (str ? JSON.parse(str) : {}) as FloatingPlayerState;\n}\n\nexport function saveFloatingPlayerState(data: FloatingPlayerState) {\n  const saveData = { ...data, lastTimestamp: Date.now() };\n  delete saveData.error;\n  delete saveData.loaded;\n  // status?\n  const str = convertFloatingPlayerStateToJsonStr(saveData);\n  window.localStorage.setItem(storageFloatingPlayerStateId, str);\n}\n\nexport function loadFloatingPlayerState() {\n  const str = window.localStorage.getItem(storageFloatingPlayerStateId);\n  return convertFloatingPlayerStateFromJsonStr(str);\n}\n","import { getJsText } from '../../helpers/getJsText';\n\ninterface THiddenPlayerOptions {\n  type?: string;\n  src?: string;\n}\n\nexport class HiddenPlayer {\n  hiddenPlayerNode?: HTMLElement;\n  parentDomNode?: HTMLElement;\n\n  audioNode?: HTMLAudioElement;\n  sourceNode?: HTMLSourceElement;\n\n  setParentDomNode(parentDomNode: HTMLElement) {\n    this.parentDomNode = parentDomNode;\n  }\n\n  requireParentDomNode() {\n    return this.parentDomNode || document.body;\n  }\n\n  ensureHiddenPlayer(/* opts: THiddenPlayerOptions = {} */) {\n    if (!this.hiddenPlayerNode) {\n      this.hiddenPlayerNode = document.createElement('div');\n      this.hiddenPlayerNode.classList.add('hidden-player');\n      const audio = document.createElement('audio');\n      // audio.addEventListener('loadeddata', this.hiddenPlayerCanPlay);\n      this.hiddenPlayerNode.appendChild(audio);\n      const parentDomNode = this.requireParentDomNode();\n      parentDomNode.appendChild(this.hiddenPlayerNode);\n    }\n    return this.hiddenPlayerNode;\n  }\n\n  hasAudio() {\n    return !!this.audioNode;\n  }\n\n  hasSource() {\n    return !!this.sourceNode;\n  }\n\n  ensureHiddenPlayerAudio() {\n    if (!this.audioNode) {\n      const parentDomNode = this.requireParentDomNode();\n      this.audioNode = document.createElement('audio');\n      this.audioNode.classList.add('hidden-player');\n      this.audioNode.setAttribute('preload', 'auto');\n      // audio.addEventListener('loadeddata', this.hiddenPlayerCanPlay);\n      parentDomNode.appendChild(this.audioNode);\n    }\n    return this.audioNode;\n  }\n\n  createHiddenPlayerSource(opts: THiddenPlayerOptions = {}) {\n    this.removeHiddenPlayerSource();\n    const audio = this.ensureHiddenPlayerAudio();\n    this.sourceNode = document.createElement('source');\n    this.sourceNode.setAttribute('type', opts.type || 'audio/mpeg');\n    if (opts.src) {\n      this.sourceNode.setAttribute('src', opts.src);\n    }\n    // @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/loadeddata_event\n    // audio.addEventListener('canplay', this.handleCanPlay.bind(this));\n    // audio.addEventListener('playing', this.handlePlay.bind(this));\n    // audio.addEventListener('timeupdate', this.handleTimeUpdate.bind(this));\n    // audio.addEventListener('ended', this.handleEnded.bind(this));\n    // this.sourceNode.addEventListener('error', this.handleError.bind(this));\n    audio.appendChild(this.sourceNode);\n    return this.sourceNode;\n  }\n\n  removeHiddenPlayerAudio() {\n    if (this.audioNode) {\n      this.audioNode.pause();\n      this.audioNode.remove();\n      this.audioNode = undefined;\n      this.sourceNode = undefined;\n    }\n  }\n\n  removeHiddenPlayerSource() {\n    const audio = this.ensureHiddenPlayerAudio();\n    const prevSources = Array.from(audio.getElementsByTagName('source'));\n    for (const node of prevSources) {\n      node.remove();\n    }\n    this.sourceNode = undefined;\n  }\n}\n","import { formatDuration, quoteHtmlAttr } from '../helpers/CommonHelpers';\nimport { commonNotify } from '../CommonNotify/CommonNotifySingleton';\nimport { sendApiRequest } from '../helpers/sendApiRequest';\nimport { getJsText } from '../helpers/getJsText';\n\nimport { localTrackInfoDb } from './localTrackInfoDb';\nimport { floatingPlayer } from '../entities/FloatingPlayer/floatingPlayer';\nimport {\n  FloatingPlayerIncrementData,\n  FloatingPlayerUpdateData,\n} from '../entities/FloatingPlayer/FloatingPlayerCallbacks';\n\n// const sharedPlayerContainer = document.body;\n\nlet allPlayers: NodeListOf<HTMLElement>;\n// let sharedPlayerNode: HTMLElement | undefined = undefined;\nlet currentTrackPlayer: HTMLElement | undefined = undefined;\n\n// Values for dataset statuses\nconst TRUE = 'true';\n\nfunction calculateAndUpdateTrackPosition(\n  trackNode: HTMLElement,\n  position: number,\n  isCurrent?: boolean,\n) {\n  const timeNode = trackNode.querySelector('.time');\n  const { dataset } = trackNode;\n  const { trackId, trackDuration } = dataset;\n  const timeMs = Math.floor(position * 1000);\n  const timeFormatted = formatDuration(timeMs);\n  const id = Number(trackId);\n  const duration = parseFloat(trackDuration.replace(',', '.'));\n  if (!duration) {\n    const error = new Error(`No duration provided for a track: ${id}`);\n    // eslint-disable-next-line no-console\n    console.error('[tracksPlayer:updateTrackPosition]', error.message, {\n      error,\n    });\n    debugger; // eslint-disable-line no-debugger\n  }\n  const ratio = position / duration;\n  const progress = Math.round(ratio * 100);\n  dataset.position = String(position);\n  dataset.progress = String(progress);\n  trackNode.style.setProperty('--progress', String(progress));\n  if (timeNode) {\n    timeNode.innerHTML = timeFormatted;\n  }\n  localTrackInfoDb.updatePosition(id, position);\n  if (isCurrent) {\n    // TODO: Update the floating player if isCurrent\n  }\n}\n\nfunction floatingPlayerUpdate(data: FloatingPlayerUpdateData) {\n  const { floatingPlayerState, activePlayerData } = data;\n  const { id } = activePlayerData;\n  let trackNode = currentTrackPlayer;\n  if (!trackNode || Number(trackNode.dataset.trackId) !== id) {\n    trackNode = getTrackNode(id);\n  }\n  if (!trackNode) {\n    return;\n  }\n  const isCurrent = trackNode === currentTrackPlayer;\n  const { position, progress, status } = floatingPlayerState;\n  const { dataset } = currentTrackPlayer;\n  const timeNode = currentTrackPlayer.querySelector('.time');\n  const timeMs = Math.floor(position * 1000);\n  const timeFormatted = formatDuration(timeMs);\n  if (status) {\n    dataset.status = status;\n  } else {\n    delete dataset.status;\n  }\n  dataset.position = String(position);\n  dataset.progress = String(progress);\n  calculateAndUpdateTrackPosition(trackNode, position, isCurrent);\n  currentTrackPlayer.style.setProperty('--progress', String(progress));\n  if (timeNode) {\n    timeNode.innerHTML = timeFormatted;\n  }\n  if (isCurrent) {\n    // TODO: Update the floating player if isCurrent\n  }\n}\n\nfunction floatingPlayerPlay(data: FloatingPlayerUpdateData) {\n  const {\n    // floatingPlayerState,\n    activePlayerData,\n  } = data;\n  if (!currentTrackPlayer) {\n    throw new Error('No current track player node!');\n  }\n  const { dataset } = currentTrackPlayer;\n  const id = Number(dataset.trackId);\n  if (id !== activePlayerData.id) {\n    throw new Error('Wrong active track id!');\n  }\n  dataset.status = 'playing';\n  // floatingPlayer.showFloatingPlayer(currentTrackPlayer);\n}\n\nfunction floatingPlayerStop(data: FloatingPlayerUpdateData) {\n  const {\n    // floatingPlayerState,\n    activePlayerData,\n  } = data;\n  if (!currentTrackPlayer) {\n    throw new Error('No current track player node!');\n  }\n  const { dataset } = currentTrackPlayer;\n  const id = Number(dataset.trackId);\n  if (id !== activePlayerData.id) {\n    throw new Error('Wrong active track id!');\n  }\n  if (dataset) {\n    delete dataset.status;\n  }\n  // incrementPlayedCount();\n}\n\nfunction getTrackNode(id: number) {\n  const players = Array.from(allPlayers);\n  const trackNode = players.find((it) => Number(it.dataset.trackId) === id);\n  return trackNode;\n}\n\nfunction stopPreviousPlayer() {\n  if (currentTrackPlayer) {\n    currentTrackPlayer.classList.toggle('current', false);\n    const { dataset } = currentTrackPlayer;\n    delete dataset.status;\n    delete dataset.loaded;\n    delete dataset.error;\n  }\n}\n\nfunction updateTrackPlayedCount(trackNode: HTMLElement, playedCount?: number, isCurrent?: boolean) {\n  const { dataset } = trackNode;\n  const { trackId } = dataset;\n  const id = Number(trackId);\n  if (!id) {\n    throw new Error('No current track id!');\n  }\n  const updatedTrackInfo = localTrackInfoDb.updatePlayedCount(id, playedCount);\n  const { playedCount: updatedPlayedCount } = updatedTrackInfo;\n  const strValue = quoteHtmlAttr(String(updatedPlayedCount));\n  const valueNode = trackNode.querySelector('#played_count') as HTMLElement;\n  // Update counter in the document...\n  if (valueNode) {\n    valueNode.innerText = strValue;\n    // ???\n    const parent = valueNode.closest('.track-played-count[data-played-count]') as HTMLElement;\n    if (parent) {\n      parent.dataset.playedCount = strValue;\n    }\n  }\n  if (isCurrent) {\n    // TODO: Update value in the floating player\n  }\n}\n\nfunction updateIncrementCallback(data: FloatingPlayerIncrementData) {\n  const {\n    count,\n    // floatingPlayerState,\n    activePlayerData,\n  } = data;\n  const trackNode = getTrackNode(activePlayerData.id);\n  const isCurrent = trackNode === currentTrackPlayer;\n  if (trackNode) {\n    updateTrackPlayedCount(trackNode, count, isCurrent);\n  }\n}\n\n/** Play button click handler */\nfunction trackPlayHandler(ev: MouseEvent) {\n  const controlNode = ev.currentTarget as HTMLElement;\n  const trackNode = controlNode.closest('.track-player') as HTMLElement;\n  // Reset previous player\n  if (currentTrackPlayer && currentTrackPlayer !== trackNode) {\n    stopPreviousPlayer();\n  }\n  const { dataset } = trackNode;\n  const id = Number(dataset.trackId);\n\n  const playingId = floatingPlayer.getActiveTrackId();\n  const isFloatingPlaying = floatingPlayer.isPlaying();\n  if (isFloatingPlaying) {\n    // Pause playback\n    floatingPlayer.pauseCurrentPlayer();\n    if (playingId === id) {\n      // Return -- just pause current track\n      return;\n    }\n  }\n\n  // Clear all tracks active status?\n  trackNode.classList.toggle('current', true);\n  currentTrackPlayer = trackNode;\n\n  const position = parseFloat((dataset.position || '0').replace(',', '.'));\n  floatingPlayer.setActiveTrack(trackNode, position);\n\n  floatingPlayer.playCurrentPlayer();\n\n  // Show floating player if has been hidden\n  if (!isFloatingPlaying) {\n    floatingPlayer.showFloatingPlayer();\n  }\n}\n\nfunction sendToggleFavoriteRequest(trackId: number | string, value: boolean) {\n  const url = `/api/v1/tracks/${trackId}/toggle-favorite/`;\n  return sendApiRequest(url, 'POST', { value });\n}\n\nfunction updateTrackFavorite(trackNode: HTMLElement, isFavorite: boolean) {\n  const { dataset } = trackNode;\n  const { favorite } = dataset;\n  const isCurrentFavorite = Boolean(favorite);\n  if (isFavorite !== isCurrentFavorite) {\n    if (isFavorite) {\n      dataset.favorite = TRUE;\n    } else {\n      delete dataset.favorite;\n    }\n  }\n}\n\nfunction updateFavoritesByTrackIds(ids: number[]) {\n  localTrackInfoDb.updateFavoritesByTrackIds(ids);\n  allPlayers.forEach((trackNode) => {\n    const { dataset } = trackNode;\n    const { trackId } = dataset;\n    const id = Number(trackId);\n    const isFavorite = ids.includes(id);\n    updateTrackFavorite(trackNode, isFavorite);\n  });\n}\n\nfunction toggleFavorite(ev: Event) {\n  const node = ev.currentTarget as HTMLElement;\n  const trackNode = node.closest<HTMLElement>('.track-player');\n  const { dataset } = trackNode;\n  const { trackId, favorite } = dataset;\n  const id = Number(trackId);\n  if (!id) {\n    throw new Error('No current track id!');\n  }\n  const nextFavorite = !favorite;\n  localTrackInfoDb.updateFavorite(id, nextFavorite);\n  if (nextFavorite) {\n    dataset.favorite = TRUE;\n  } else {\n    delete dataset.favorite;\n  }\n  if (window.isAuthenticated) {\n    sendToggleFavoriteRequest(trackId, nextFavorite)\n      .then((results: { favorite_track_ids: number[] }) => {\n        const { favorite_track_ids } = results;\n        /* console.log('[trackControls:toggleFavorite]', {\n         *   favorite_track_ids,\n         * });\n         */\n        updateFavoritesByTrackIds(favorite_track_ids);\n        const msgId = nextFavorite ? 'trackAddedToFavorites' : 'trackRemovedFromFavorites';\n        commonNotify.showSuccess(getJsText(msgId));\n      })\n      .catch((err) => {\n        // eslint-disable-next-line no-console\n        console.error('[tracksPlayer:toggleFavorite:sendToggleFavoriteRequest] error', {\n          err,\n        });\n        debugger; // eslint-disable-line no-debugger\n        commonNotify.showError(err);\n      });\n  }\n}\n\nfunction initTrackPlayerNode(trackNode: HTMLElement) {\n  const activePlayerData = floatingPlayer.activePlayerData;\n  const { dataset } = trackNode;\n  const {\n    inited,\n    trackId, // \"1\"\n    trackMediaUrl, // \"/media/samples/gr-400x225.jpg\"\n  } = dataset;\n  const id = Number(trackId || '');\n  if (!id || inited || !trackMediaUrl) {\n    return;\n  }\n  const trackInfo = localTrackInfoDb.getById(id);\n  if (activePlayerData && activePlayerData.id == id) {\n    currentTrackPlayer = trackNode;\n    trackNode.classList.toggle('current', true);\n    // dataset.status = floatingPlayer.state.status;\n    floatingPlayerUpdate({ floatingPlayerState: floatingPlayer.state, activePlayerData });\n  } else if (trackInfo) {\n    const position = trackInfo.position;\n    if (position) {\n      calculateAndUpdateTrackPosition(trackNode, position, false);\n    }\n  }\n  if (trackInfo) {\n    if (!window.isAuthenticated) {\n      if (trackInfo?.favorite) {\n        updateTrackFavorite(trackNode, trackInfo.favorite);\n      }\n    }\n  }\n  const controls = trackNode.querySelectorAll<HTMLElement>('.track-control');\n  controls.forEach((node) => {\n    const { dataset } = node;\n    const { inited, controlId } = dataset;\n    if (inited) {\n      return;\n    }\n    if (controlId === 'toggleFavorite') {\n      node.addEventListener('click', toggleFavorite);\n    }\n    if (controlId === 'play') {\n      node.addEventListener('click', trackPlayHandler);\n    }\n    dataset.inited = TRUE;\n  });\n  dataset.inited = TRUE;\n}\n\nexport function initTracksPlayerWrapper(domNode: HTMLElement = document.body) {\n  allPlayers = domNode.querySelectorAll<HTMLElement>('.track-player[data-track-media-url]');\n  allPlayers.forEach(initTrackPlayerNode);\n  floatingPlayer.callbacks.addPlayStartCallback(floatingPlayerPlay);\n  floatingPlayer.callbacks.addPlayStopCallback(floatingPlayerStop);\n  floatingPlayer.callbacks.addUpdateCallback(floatingPlayerUpdate);\n  floatingPlayer.callbacks.addIncrementCallback(updateIncrementCallback);\n  // TODO: Add toggle favorite callback\n}\n","import { ActivePlayerData } from '../ActivePlayerData/ActivePlayerData';\nimport { FloatingPlayerState } from './FloatingPlayerState';\n\nexport interface FloatingPlayerUpdateData {\n  floatingPlayerState: FloatingPlayerState;\n  activePlayerData: ActivePlayerData;\n}\nexport interface FloatingPlayerIncrementData {\n  count?: number;\n  // floatingPlayerState: FloatingPlayerState;\n  activePlayerData: ActivePlayerData;\n}\ntype UpdateCallback = (data: FloatingPlayerUpdateData) => void;\ntype IncrementCallback = (data: FloatingPlayerIncrementData) => void;\ntype ErrorCallback = (error: Error | string) => void;\n\n// type HandlerId = 'play' | 'stop' | 'time';\nexport class FloatingPlayerCallbacks {\n  onPlayStartCallbacks: UpdateCallback[] = [];\n  onPlayStopCallbacks: UpdateCallback[] = [];\n  onUpdateCallbacks: UpdateCallback[] = [];\n  onIncrementCallbacks: IncrementCallback[] = [];\n  onErrorCallbacks: ErrorCallback[] = [];\n\n  // handlers: Record<HandlerId, ErrorCallback[]> = {};\n\n  addPlayStartCallback(cb: UpdateCallback) {\n    if (cb && !this.onPlayStartCallbacks.includes(cb)) {\n      this.onPlayStartCallbacks.push(cb);\n    }\n  }\n\n  addPlayStopCallback(cb: UpdateCallback) {\n    if (cb && !this.onPlayStopCallbacks.includes(cb)) {\n      this.onPlayStopCallbacks.push(cb);\n    }\n  }\n\n  addUpdateCallback(cb: UpdateCallback) {\n    if (cb && !this.onUpdateCallbacks.includes(cb)) {\n      this.onUpdateCallbacks.push(cb);\n    }\n  }\n\n  addIncrementCallback(cb: IncrementCallback) {\n    if (cb && !this.onIncrementCallbacks.includes(cb)) {\n      this.onIncrementCallbacks.push(cb);\n    }\n  }\n\n  addErrorCallback(cb: ErrorCallback) {\n    if (cb && !this.onErrorCallbacks.includes(cb)) {\n      this.onErrorCallbacks.push(cb);\n    }\n  }\n\n  // Invokers\n\n  invokePlayStart(data: FloatingPlayerUpdateData) {\n    if (data.activePlayerData) {\n      this.onPlayStartCallbacks.forEach((cb) => {\n        cb(data);\n      });\n    }\n  }\n\n  invokePlayStop(data: FloatingPlayerUpdateData) {\n    if (data.activePlayerData) {\n      this.onPlayStopCallbacks.forEach((cb) => {\n        cb(data);\n      });\n    }\n  }\n\n  invokeUpdate(data: FloatingPlayerUpdateData) {\n    if (data.activePlayerData) {\n      this.onUpdateCallbacks.forEach((cb) => {\n        cb(data);\n      });\n    }\n  }\n\n  invokeIncrement(data: FloatingPlayerIncrementData) {\n    if (data.activePlayerData) {\n      this.onIncrementCallbacks.forEach((cb) => {\n        cb(data);\n      });\n    }\n  }\n  invokeError(error: Error | string) {\n    if (error) {\n      this.onErrorCallbacks.forEach((cb) => {\n        cb(error);\n      });\n    }\n  }\n}\n","import { getJsText } from '../../helpers/getJsText';\nimport { commonNotify } from '../../CommonNotify/CommonNotifySingleton';\nimport { formatDuration, getErrorText } from '../../helpers/CommonHelpers';\nimport { localTrackInfoDb } from '../../track-blocks/localTrackInfoDb';\n\nimport {\n  ActivePlayerData,\n  loadActivePlayerData,\n  saveActivePlayerData,\n} from '../ActivePlayerData/ActivePlayerData';\nimport { getActivePlayerDataFromTrackNode } from '../ActivePlayerData/getActivePlayerDataFromTrackNode';\nimport { sendApiRequest } from '../../helpers/sendApiRequest';\nimport {\n  FloatingPlayerState,\n  loadFloatingPlayerState,\n  saveFloatingPlayerState,\n} from './FloatingPlayerState';\n\nimport { HiddenPlayer } from './HiddenPlayer';\nimport { FloatingPlayerCallbacks } from './FloatingPlayerCallbacks';\n\nconst TRUE = 'true';\n\nexport class FloatingPlayer {\n  inited = false;\n  callbacks = new FloatingPlayerCallbacks();\n  audio?: HTMLAudioElement;\n  hiddenPlayer: HiddenPlayer = new HiddenPlayer();\n  activePlayerData?: ActivePlayerData;\n  state: FloatingPlayerState = {};\n  domNode?: HTMLElement;\n  incrementing?: boolean;\n\n  constructor() {\n    this.loadActivePlayerData();\n    this.loadFloatingPlayerState();\n    this.initTrackDomNode();\n    this.updateAll();\n    // Check if it was recently playing...\n    // const _now = Date.now();\n    if (\n      this.activePlayerData &&\n      this.state.status === 'playing' &&\n      this.state.lastTimestamp\n      // && this.state.lastTimestamp > now - 5000\n    ) {\n      // TODO: Then resume playback...\n      console.log('[FloatingPlayerClass:constructor] Start play', {\n        activePlayerData: this.activePlayerData,\n        state: this.state,\n      });\n      // TODO: Care about: `Uncaught (in promise) NotAllowedError: play() failed because the user didn't interact with the document first. https://goo.gl/xX8pDD`\n      // this.playCurrentPlayer();\n\n      // DEBUG: Temporarily remove the playing status\n      delete this.state.status;\n    } else {\n      // Reset the status\n      delete this.state.status;\n    }\n  }\n\n  requireAudio() {\n    if (!this.audio) {\n      this.audio = this.hiddenPlayer.ensureHiddenPlayerAudio();\n      this.audio.addEventListener('canplay', this.handleAudioCanPlay.bind(this));\n      this.audio.addEventListener('playing', this.handleAudioPlay.bind(this));\n      this.audio.addEventListener('timeupdate', this.handleAudioTimeUpdate.bind(this));\n      this.audio.addEventListener('ended', this.handleAudioEnded.bind(this));\n      // source.addEventListener('error', this.handleAudioSourceError.bind(this));\n    }\n    return this.audio;\n  }\n\n  removeAudio() {\n    this.hiddenPlayer.removeHiddenPlayerAudio();\n    this.audio = undefined;\n  }\n\n  hasAudio() {\n    return !!this.audio;\n  }\n\n  hasAudioSource() {\n    return this.hiddenPlayer.hasSource();\n  }\n\n  requireDomNode() {\n    if (!this.domNode) {\n      this.domNode = document.querySelector<HTMLElement>('.floating-player');\n      this.hiddenPlayer.setParentDomNode(this.domNode);\n    }\n    // TODO: Ensure created dom node?\n    if (!this.domNode) {\n      const error = new Error('No floating player node found');\n      // eslint-disable-next-line no-console\n      console.error('[FloatingPlayerClass:requireDomNode]', error.message, {\n        error,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw error;\n    }\n    return this.domNode;\n  }\n\n  requireActivePlayerData() {\n    // TODO: Ensure data?\n    if (!this.activePlayerData) {\n      const error = new Error('No active player data set');\n      // eslint-disable-next-line no-console\n      console.error('[FloatingPlayerClass:requireActivePlayerData]', error.message, {\n        error,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw error;\n    }\n    return this.activePlayerData;\n  }\n\n  // Sync persistent data...\n\n  loadActivePlayerData() {\n    this.activePlayerData = loadActivePlayerData();\n  }\n\n  saveActivePlayerData() {\n    saveActivePlayerData(this.activePlayerData);\n  }\n\n  loadFloatingPlayerState() {\n    this.state = loadFloatingPlayerState();\n  }\n\n  saveFloatingPlayerState() {\n    saveFloatingPlayerState(this.state);\n  }\n\n  // Dom node...\n\n  showFloatingPlayer() {\n    this.state.visible = true;\n    this.updateStateInDom();\n    this.saveFloatingPlayerState();\n  }\n\n  hideFloatingPlayer() {\n    this.state.visible = false;\n    this.updateStateInDom();\n    this.saveFloatingPlayerState();\n  }\n\n  // Updaters...\n\n  updateActivePlayerDataInDom() {\n    const domNode = this.requireDomNode();\n    const activePlayerData = this.requireActivePlayerData();\n    const titleNode = domNode.querySelector<HTMLElement>('.title');\n    titleNode.innerText = activePlayerData.title;\n    const imageNode = domNode.querySelector<HTMLElement>('.image');\n    imageNode.style.backgroundImage = 'url(' + activePlayerData.imageUrl + ')';\n  }\n\n  updateStateInDom() {\n    const domNode = this.requireDomNode();\n    const { dataset } = domNode;\n    if (this.state.status) {\n      dataset.status = this.state.status;\n    } else {\n      delete dataset.status;\n    }\n    document.body.classList.toggle('withPlayer', !!this.state.visible);\n  }\n\n  updatePositionInDom() {\n    const domNode = this.requireDomNode();\n    const { dataset } = domNode;\n    dataset.position = String(this.state.position || 0);\n    dataset.progress = String(this.state.progress || 0);\n    domNode.style.setProperty('--progress', String(this.state.progress || 0));\n  }\n\n  calculateProgress() {\n    const activePlayerData = this.requireActivePlayerData();\n    const { position } = this.state;\n    const { id, duration } = activePlayerData;\n    if (!duration) {\n      const error = new Error(`No duration provided for a track: ${id}`);\n      // eslint-disable-next-line no-console\n      console.error('[FloatingPlayerClass:calculateProgress]', error.message, {\n        error,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw error;\n    }\n    const ratio = position / duration;\n    const progress = Math.round(ratio * 100);\n    return progress;\n  }\n\n  updateTrackPosition() {\n    const domNode = this.requireDomNode();\n    const timeNode = domNode.querySelector('.time');\n    const activePlayerData = this.requireActivePlayerData();\n    const { position } = this.state;\n    const { id } = activePlayerData;\n    const progress = this.calculateProgress();\n    /* console.log('[FloatingPlayerClass:updateTrackPosition]', {\n     *   id,\n     *   position,\n     *   progress,\n     *   ratio,\n     *   duration,\n     *   timeNode,\n     *   dataset,\n     *   domNode,\n     * });\n     */\n    this.state.progress = progress;\n    this.updatePositionInDom();\n    if (timeNode) {\n      timeNode.innerHTML = formatDuration(Math.floor(position * 1000));\n    }\n    localTrackInfoDb.updatePosition(id, position);\n  }\n\n  // TODO: Update position\n  // TODO: Update status\n\n  updateAll() {\n    this.updateStateInDom();\n    this.updatePositionInDom();\n    if (this.activePlayerData) {\n      this.updateActivePlayerDataInDom();\n    }\n  }\n\n  // Audio handlers...\n\n  handleAudioTimeUpdate(ev: Event) {\n    const currAudio = this.audio;\n    const audio = ev.currentTarget as HTMLAudioElement;\n    if (audio !== currAudio) {\n      return;\n    }\n    const activePlayerData = this.requireActivePlayerData();\n    const {\n      currentTime,\n      // readyState,\n    } = audio;\n    /* // DEBUG\n     * const source = audio.getElementsByTagName('SOURCE')[0] as HTMLSourceElement;\n     * console.log('[FloatingPlayerClass:handleAudioTimeUpdate]', {\n     *   currentTime,\n     *   readyState,\n     *   id: activePlayerData.id,\n     *   activePlayerData,\n     *   src: source.src,\n     *   source,\n     *   thisAudio: currAudio === audio,\n     *   currAudio,\n     *   audio,\n     * });\n     */\n    // TODO: Check loaded status?\n    if (this.state.position != currentTime) {\n      this.state.position = currentTime;\n      this.saveFloatingPlayerState();\n      this.updateTrackPosition();\n      this.callbacks.invokeUpdate({ floatingPlayerState: this.state, activePlayerData });\n      localTrackInfoDb.updatePosition(activePlayerData.id, currentTime);\n    }\n  }\n\n  handleAudioCanPlay(_ev: Event) {\n    if (!this.state.loaded) {\n      /* // DEBUG\n       * const audio = ev.currentTarget as HTMLAudioElement;\n       * const source = audio.getElementsByTagName('SOURCE')[0] as HTMLSourceElement;\n       * const src = source?.src;\n       * console.log('[FloatingPlayerClass:sharedPlayerCanPlay]', {\n       *   src,\n       *   source,\n       *   audio,\n       *   ev,\n       * });\n       */\n      this.state.loaded = true;\n      delete this.state.error;\n    }\n  }\n\n  handleAudioPlay(_ev: Event) {\n    // console.log('[FloatingPlayerClass:handleAudioPlay]');\n    this.state.status = 'playing';\n    this.updateStateInDom();\n    this.saveFloatingPlayerState();\n    this.callbacks.invokePlayStart({\n      floatingPlayerState: this.state,\n      activePlayerData: this.activePlayerData,\n    });\n  }\n\n  handleAudioEnded(_ev: Event) {\n    this.incrementPlayedCount();\n    // console.log('[FloatingPlayerClass:handleAudioEnded]');\n    this.state.status = 'paused'; // stopped, ready?\n    this.updateStateInDom();\n    this.saveFloatingPlayerState();\n    this.callbacks.invokePlayStop({\n      floatingPlayerState: this.state,\n      activePlayerData: this.activePlayerData,\n    });\n  }\n\n  handleAudioSourceError(ev: Event) {\n    const srcElement = ev.currentTarget as HTMLSourceElement;\n    const { src, type } = srcElement;\n    const errMsg = getJsText('errorLoadingAudioFile') + ' ' + src;\n    const error = new Error(errMsg);\n    // eslint-disable-next-line no-console\n    console.error('[FloatingPlayerClass:handleAudioSourceError]', errMsg, {\n      error,\n      src,\n      type,\n      ev,\n    });\n    debugger; // eslint-disable-line no-debugger\n    commonNotify.showError(errMsg);\n    this.state.error = getErrorText(error);\n    this.callbacks.invokeError(error);\n  }\n\n  /// Active player data\n\n  getActiveTrackId(): number | undefined {\n    return this.activePlayerData ? this.activePlayerData.id : undefined;\n  }\n\n  // Core handlers...\n\n  loadAudio() {\n    const activePlayerData = this.requireActivePlayerData();\n    /* console.log('[FloatingPlayerClass:loadAudio]', {\n     *   mediaUrl: activePlayerData.mediaUrl,\n     *   id: activePlayerData.id,\n     * });\n     */\n    this.state.loaded = false;\n    const source = this.hiddenPlayer.createHiddenPlayerSource({ src: activePlayerData.mediaUrl });\n    source.addEventListener('error', this.handleAudioSourceError.bind(this));\n  }\n\n  isAudioPlaying() {\n    const audio = this.audio;\n    return (\n      !!audio && audio.currentTime > 0 && !audio.paused && !audio.ended && audio.readyState > 2\n    );\n  }\n\n  isPlaying() {\n    return this.state.status === 'playing';\n  }\n\n  pauseCurrentPlayer() {\n    if (this.isAudioPlaying()) {\n      const audio = this.requireAudio();\n      audio.pause();\n    }\n    if (this.isPlaying()) {\n      this.state.status = 'paused';\n      this.updateStateInDom();\n      this.saveFloatingPlayerState();\n    }\n  }\n\n  playCurrentPlayer() {\n    const audio = this.requireAudio();\n    const activePlayerData = this.requireActivePlayerData();\n    if (this.isAudioPlaying()) {\n      return;\n    }\n    if (audio.ended || this.state.position > activePlayerData.duration - 0.1) {\n      // Start from the begining\n      this.state.position = 0;\n    }\n    this.updateTrackPosition();\n    this.callbacks.invokeUpdate({\n      floatingPlayerState: this.state,\n      activePlayerData: this.activePlayerData,\n    });\n\n    audio.currentTime = this.state.position || 0;\n    audio.play();\n  }\n\n  /** Play button click handler */\n  trackPlayHandler(_ev: MouseEvent) {\n    const isPlaying = this.isPlaying();\n    if (isPlaying) {\n      this.pauseCurrentPlayer();\n    } else {\n      this.playCurrentPlayer();\n    }\n  }\n\n  // Active player track data...\n\n  ensureAudioLoaded() {\n    if (!this.state.loaded || !this.hasAudio() || !this.hasAudioSource) {\n      this.loadAudio();\n    }\n  }\n\n  setActivePlayerData(activePlayerData: ActivePlayerData, position?: number) {\n    if (this.activePlayerData?.id !== activePlayerData.id) {\n      if (this.activePlayerData && this.isPlaying) {\n        this.pauseCurrentPlayer();\n      }\n      this.state.loaded = false;\n      if (position != null) {\n        this.state.position = position;\n      }\n      this.removeAudio();\n      // console.log('[FloatingPlayerClass:setActivePlayerData]', activePlayerData);\n      this.activePlayerData = activePlayerData;\n    }\n    this.saveActivePlayerData();\n    this.updateActivePlayerDataInDom();\n    this.ensureAudioLoaded();\n  }\n\n  setActiveTrack(trackNode: HTMLElement, position?: number) {\n    const activePlayerData = getActivePlayerDataFromTrackNode(trackNode);\n    this.setActivePlayerData(activePlayerData, position);\n  }\n\n  setPosition(position?: number) {\n    this.state.position = position;\n    // ???\n  }\n\n  clearActiveData() {\n    this.activePlayerData = undefined;\n    this.hideFloatingPlayer();\n    this.removeAudio();\n  }\n\n  // Update related data\n\n  sendIncrementPlayedCount(id: number) {\n    const url = `/api/v1/tracks/${id}/increment-played-count/`;\n    return sendApiRequest(url, 'POST');\n  }\n\n  incrementPlayedCount() {\n    const activePlayerData = this.requireActivePlayerData();\n    if (this.incrementing) {\n      return;\n    }\n    this.incrementing = true;\n    return this.sendIncrementPlayedCount(activePlayerData.id)\n      .then(({ played_count }: { played_count?: number }) => {\n        if (played_count != null) {\n          // Re-update local data with server data...\n          this.callbacks.invokeIncrement({ count: played_count, activePlayerData });\n        }\n        // TODO: Update other instances of this track on the page (eg, in player, or in other track listings)?\n      })\n      .catch((err) => {\n        // eslint-disable-next-line no-console\n        console.error('[FloatingPlayerClass:incrementPlayedCount:sendIncrementPlayedCount] error', {\n          err,\n        });\n        debugger; // eslint-disable-line no-debugger\n        commonNotify.showError(err);\n        // Increment locally (?)\n        this.callbacks.invokeIncrement({ activePlayerData });\n        throw err;\n      })\n      .finally(() => {\n        this.incrementing = false;\n      });\n  }\n\n  // Initilization...\n\n  initTrackDomNode() {\n    const domNode = this.requireDomNode();\n    const controls = domNode.querySelectorAll<HTMLElement>('.track-control');\n    controls.forEach((node) => {\n      const { dataset } = node;\n      const { inited, controlId } = dataset;\n      if (inited) {\n        return;\n      }\n      // if (controlId === 'toggleFavorite') {\n      //   node.addEventListener('click', toggleFavorite);\n      // }\n      if (controlId === 'play') {\n        node.addEventListener('click', this.trackPlayHandler.bind(this));\n      }\n      dataset.inited = TRUE;\n    });\n    this.inited = true;\n  }\n}\n","import { ActivePlayerData } from './ActivePlayerData';\n\nexport function getActivePlayerDataFromTrackNode(trackNode: HTMLElement) {\n  const { dataset } = trackNode;\n  const id = Number(dataset.trackId);\n  // const status = dataset.status;\n  const duration = parseFloat((dataset.trackDuration || '0').replace(',', '.'));\n  // const position = parseFloat((dataset.position || '0').replace(',', '.'));\n  const mediaUrl = dataset.trackMediaUrl;\n  const imageNode = trackNode.querySelector<HTMLImageElement>('img.card-img');\n  const imageUrl = imageNode?.getAttribute('src');\n  const titleNode = trackNode.querySelector<HTMLElement>('.post-title');\n  const title = titleNode?.innerHTML;\n  const activePlayerData: ActivePlayerData = {\n    id,\n    title,\n    imageUrl,\n    mediaUrl,\n    duration,\n  };\n  return activePlayerData;\n}\n","import { FloatingPlayer } from './FloatingPlayerClass';\n\n// Singleton\nexport const floatingPlayer = new FloatingPlayer();\n\nexport function initFloatingPlayer() {\n  // console.log('[floatingPlayer:initFloatingPlayer]');\n}\n"],"names":["getErrorText","error","Array","isArray","map","this","bind","join","Error","message","String","quoteHtmlAttr","str","preserveCR","crValue","replace","formatDuration","time","sec","min","hrs","items","Math","floor","val","idx","padStart","shift","filter","Boolean","icons","success","warn","info","commonNotify","notifyRoot","undefined","timeoutDelay","inited","removeNotify","notifyData","node","handler","classList","remove","clearTimeout","setTimeout","removeChild","_e","showNotify","mode","text","content","ensureInit","document","createElement","add","nodeIcon","appendChild","nodeText","innerHTML","window","requestAnimationFrame","removeNotifyHandler","addEventListener","showInfo","showSuccess","showWarn","showError","showDemo","init","createDomNode","rootNode","body","setAttribute","getJsText","id","textNode","querySelector","console","trim","sendApiRequest","url","method","requestData","headers","Accept","cookieId","cookiesList","cookie","split","i","length","s","decodeURIComponent","getCookie","fetch","credentials","JSON","stringify","then","res","ok","status","statusText","json","data","errMsg","detail","catch","err","localTrackInfoDb","updatePlayedCount","playedCount","now","_now","Date","trackInfo","getOrCreate","isNaN","lastPlayed","lastUpdated","insert","updatePosition","position","updateFavorite","favorite","_toggleInFavoritesIndex","updateFavoritesByTrackIds","ids","_getIndex","forEach","isFavorite","includes","_setFavoritesIndex","save","createNewRecord","getById","localStorage","setItem","list","Number","trackInfoToJsonStr","_addToIndex","getFavorites","getAll","it","getItem","parse","trackInfoFromJsonStr","_getFavoritesIndex","_","favoritesIndex","_addToFavoritesIndex","push","_removeFromFavoritesIndex","checkId","value","_setIndex","index","_removeFromIndex","_toggleInIndex","delete","removeItem","clearAll","storageActivePlayerDataId","saveActivePlayerData","convertActivePlayerDataToJsonStr","loadActivePlayerData","convertActivePlayerDataFromJsonStr","storageFloatingPlayerStateId","saveFloatingPlayerState","saveData","lastTimestamp","loaded","convertFloatingPlayerStateToJsonStr","loadFloatingPlayerState","convertFloatingPlayerStateFromJsonStr","allPlayers","domNode","setParentDomNode","parentDomNode","requireParentDomNode","ensureHiddenPlayer","hiddenPlayerNode","audio","hasAudio","audioNode","hasSource","sourceNode","ensureHiddenPlayerAudio","createHiddenPlayerSource","opts","removeHiddenPlayerSource","type","src","removeHiddenPlayerAudio","pause","from","getElementsByTagName","onPlayStartCallbacks","onPlayStopCallbacks","onUpdateCallbacks","onIncrementCallbacks","onErrorCallbacks","addPlayStartCallback","cb","addPlayStopCallback","addUpdateCallback","addIncrementCallback","addErrorCallback","invokePlayStart","activePlayerData","invokePlayStop","invokeUpdate","invokeIncrement","invokeError","callbacks","FloatingPlayerCallbacks","hiddenPlayer","HiddenPlayer","state","initTrackDomNode","updateAll","log","requireAudio","handleAudioCanPlay","handleAudioPlay","handleAudioTimeUpdate","handleAudioEnded","removeAudio","hasAudioSource","requireDomNode","requireActivePlayerData","showFloatingPlayer","visible","updateStateInDom","hideFloatingPlayer","updateActivePlayerDataInDom","innerText","title","style","backgroundImage","imageUrl","dataset","toggle","updatePositionInDom","progress","setProperty","calculateProgress","duration","ratio","round","updateTrackPosition","timeNode","ev","currAudio","currentTarget","currentTime","floatingPlayerState","_ev","incrementPlayedCount","handleAudioSourceError","srcElement","getActiveTrackId","loadAudio","mediaUrl","isAudioPlaying","paused","ended","readyState","isPlaying","pauseCurrentPlayer","playCurrentPlayer","play","trackPlayHandler","ensureAudioLoaded","setActivePlayerData","setActiveTrack","trackNode","trackId","parseFloat","trackDuration","trackMediaUrl","imageNode","getAttribute","titleNode","getActivePlayerDataFromTrackNode","setPosition","clearActiveData","sendIncrementPlayedCount","incrementing","played_count","count","finally","querySelectorAll","controlId","floatingPlayer","FloatingPlayer","currentTrackPlayer","calculateAndUpdateTrackPosition","isCurrent","timeFormatted","floatingPlayerUpdate","getTrackNode","floatingPlayerPlay","floatingPlayerStop","find","updateIncrementCallback","updatedPlayedCount","strValue","valueNode","closest","updateTrackPlayedCount","stopPreviousPlayer","playingId","isFloatingPlaying","updateTrackFavorite","toggleFavorite","nextFavorite","isAuthenticated","sendToggleFavoriteRequest","results","favorite_track_ids","msgId","initTrackPlayerNode"],"sourceRoot":""}