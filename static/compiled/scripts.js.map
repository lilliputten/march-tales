{"version":3,"file":"scripts.js","mappings":"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","sources":["webpack://march-tales/./src/assets/checkProjectVersion.ts","webpack://march-tales/./src/assets/helpers/CommonHelpers.js","webpack://march-tales/./src/assets/helpers/floatToStr.ts","webpack://march-tales/./src/assets/track-blocks/localTrackInfoDb.ts","webpack://march-tales/./src/assets/track-blocks/TrackInfo.ts","webpack://march-tales/./src/assets/helpers/getJsText.ts","webpack://march-tales/./src/assets/CommonNotify/CommonNotifySingleton.ts","webpack://march-tales/./src/assets/entities/ActivePlayerData/ActivePlayerData.ts","webpack://march-tales/./src/assets/helpers/sendApiRequest.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/FloatingPlayerState.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/HiddenPlayer.ts","webpack://march-tales/./src/assets/track-blocks/tracksPlayer.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/FloatingPlayerCallbacks.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/FloatingPlayerClass.ts","webpack://march-tales/./src/assets/entities/ActivePlayerData/getActivePlayerDataFromTrackNode.ts","webpack://march-tales/./src/assets/entities/FloatingPlayer/floatingPlayer.ts","webpack://march-tales/./src/assets/index.ts"],"sourcesContent":["/** Get major and minor versions in form '1.2' from a string 'march-tales v.1.2.20 / 2025.02.20 15:22:00 +0300' */\nfunction getMinorVersionFromProjectInfo(info?: string | null) {\n  if (!info) {\n    return undefined;\n  }\n  try {\n    const match = info.match(/^\\S+ v\\.(\\d+\\.\\d+)/);\n    if (match) {\n      const v = match[1];\n      return v;\n    }\n  } catch (\n    _e // eslint-disable-line @typescript-eslint/no-unused-vars\n  ) {\n    // NOOP\n    return undefined;\n  }\n}\n\nexport function checkProjectVersion() {\n  const oldInfo = window.localStorage.getItem('projectInfo');\n  const newInfo = window.projectInfo;\n  if (newInfo && newInfo !== oldInfo) {\n    const oldVersion = getMinorVersionFromProjectInfo(oldInfo);\n    const newVersion = getMinorVersionFromProjectInfo(newInfo);\n    if (oldVersion !== newVersion) {\n      // TODO: To clear some stored data etc?\n      // eslint-disable-next-line no-console\n      console.warn('[checkProjectVersion] Project version has changed', {\n        oldInfo,\n        newInfo,\n        oldVersion,\n        newVersion,\n      });\n      debugger; // eslint-disable-line no-debugger\n    }\n    window.localStorage.setItem('projectInfo', newInfo);\n  }\n}\n","// @ts-check\n\nexport function NOOP() {}\n\n/** Compare two arrays with scalar (number, string, boolean) values\n * @param {(number | string | boolean)[]} a1\n * @param {(number | string | boolean)[]} a2\n * @return {boolean}\n */\nexport function compareArrays(a1, a2) {\n  if (!a1 || !a1) {\n    return a1 === a2;\n  }\n  if (a1.length !== a2.length) {\n    return false;\n  }\n  // Compare all the items...\n  for (let i = 0; i < a1.length; i++) {\n    if (a1[i] !== a2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/** getErrorText - Return plain text for error.\n * @param {string|Error|string[]|Error[]} error - Error or errors list.\n * @return {string}\n */\nexport function getErrorText(error) {\n  if (!error) {\n    return '';\n  }\n  if (Array.isArray(error)) {\n    return error.map(this.getErrorText.bind(this)).join('\\n');\n  }\n  if (error instanceof Error) {\n    error = error.message;\n  } else if (typeof error !== 'string') {\n    // TODO?\n    error = String(error);\n  }\n  return error;\n}\n\n/** quoteHtmlAttr -- quote all invalid characters for html\n * @param {string} str\n * @param {boolean} [preserveCR]\n */\nexport function quoteHtmlAttr(str, preserveCR) {\n  const crValue = preserveCR ? '&#13;' : '\\n';\n  return (\n    String(str) // Forces the conversion to string\n      .replace(/&/g, '&amp;') // This MUST be the 1st replacement\n      .replace(/'/g, '&apos;') // The 4 other predefined entities, required\n      .replace(/\"/g, '&quot;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      // You may add other replacements here for HTML only (but it's not\n      // necessary). Or for XML, only if the named entities are defined in its\n      // DTD.\n      .replace(/\\r\\n/g, crValue) // Must be before the next replacement\n      .replace(/[\\r\\n]/g, crValue)\n  );\n}\n\n/** htmlToElement -- Create dom node instance from html string\n * @param {string} html - Html representing a single element\n * @return {HTMLElement}\n */\nexport function htmlToElement(html) {\n  const template = document.createElement('template');\n  if (Array.isArray(html)) {\n    html = html.join('');\n  }\n  html = html.trim(); // Never return a text node of whitespace as the result\n  template.innerHTML = html;\n  const content = template.content;\n  return /** @type HTMLElement */ (content.firstChild);\n}\n\n/** htmlToElements -- Convert text html representation to HTMLCollection object\n * @param {string|string[]} html\n * @return {HTMLCollection}\n */\nexport function htmlToElements(html) {\n  const template = document.createElement('template');\n  if (Array.isArray(html)) {\n    html = html.join('');\n  }\n  html = html.trim(); // Never return a text node of whitespace as the result\n  template.innerHTML = html;\n  const content = template.content;\n  return content.children;\n}\n\n/** updateNodeContent -- Replace all inner dom node content.\n * @param {Element} node\n * @param {THtmlContent} content\n */\nexport function updateNodeContent(node, content) {\n  if (!node) {\n    throw new Error('Undefined node to update content');\n  }\n  if (typeof content === 'string') {\n    // Replace with string content...\n    node.innerHTML = content;\n  } else if (Array.isArray(content)) {\n    // Replace multiple elements...\n    node.replaceChildren.apply(node, content);\n  } else {\n    // Replace single element...\n    node.replaceChildren(content);\n  }\n}\n\n/** decodeQuery\n * @param {string | string[]} qs\n * @param {string} [sep]\n * @param {string} [eq]\n * @param {any} [options]\n * @returns {{}}\n */\nexport function decodeQuery(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  /** @type {Record<string, unknown> | unknown[]} */\n  const obj = {};\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n  const regexp = /\\+/g;\n  qs = qs.split(sep);\n  let maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n  let len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n  for (let i = 0; i < len; ++i) {\n    const x = qs[i].replace(regexp, '%20'),\n      idx = x.indexOf(eq);\n    let kstr, vstr;\n    if (idx >= 0) {\n      kstr = x.substring(0, idx);\n      vstr = x.substring(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n    const k = decodeURIComponent(kstr);\n    const v = decodeURIComponent(vstr);\n    const it = obj[k];\n    if (!Object.prototype.hasOwnProperty.call(obj, k)) {\n      obj[k] = v;\n    } else if (Array.isArray(it)) {\n      it.push(v);\n    } else {\n      obj[k] = [it, v];\n    }\n  }\n  return obj;\n}\n\n/** parseQuery -- Parse url query string (in form `?xx=yy&...` or `xx=yy&...`)\n * @param {string} search  - Query string\n * @return {Record<string, string>} query - Query object\n */\nexport function parseQuery(search) {\n  if (!search) {\n    return {};\n  }\n  if (search.indexOf('?') === 0) {\n    search = search.substring(1);\n  }\n  return decodeQuery(search);\n}\n\n/** makeQuery\n * @param {Record<string, string | number | boolean> | {}} params\n * @param {{ addQuestionSymbol?: boolean; useEmptyStrings?: boolean; useUndefinedValues?: boolean }} opts\n * @returns {string}\n */\nexport function makeQuery(params, opts = {}) {\n  let url = Object.entries(params)\n    .map(([id, val]) => {\n      const valStr = String(val);\n      if (val == undefined && !opts.useUndefinedValues) {\n        return undefined;\n      }\n      if (valStr === '' && !opts.useEmptyStrings) {\n        return undefined;\n      }\n      return encodeURI(id) + '=' + encodeURI(String(val == undefined ? '' : val));\n    })\n    .filter(Boolean)\n    .join('&');\n  if (opts.addQuestionSymbol && url) {\n    url = '?' + url;\n  }\n  return url;\n}\n\n/** Dynamically load external script\n * @param {string} url\n * @return {Promise<Event>}\n */\nexport function addScript(url) {\n  return new Promise((resolve, reject) => {\n    // document.write('<script src=\"' + url + '\"></script>');\n    const script = document.createElement('script');\n    script.setAttribute('src', url);\n    script.addEventListener('load', resolve);\n    script.addEventListener('error', (event) => {\n      const {\n        target,\n        // srcElement,\n      } = event;\n      // @ts-ignore\n      const { href, baseURI } = target;\n      const error = new Error(`Cannot load script resurce by url '${url}'`);\n      // eslint-disable-next-line no-console\n      console.error('[CommonHelpers:addScript]', {\n        error,\n        url,\n        href,\n        baseURI,\n        target,\n        event,\n      });\n      // eslint-disable-next-line no-debugger\n      debugger;\n      reject(error);\n    });\n    document.head.appendChild(script);\n  });\n}\n\n/** Dynamically load external css\n * @param {string} url\n * @return {Promise<unknown>}\n */\nexport function addCssStyle(url) {\n  return new Promise((resolve, reject) => {\n    // Try to find exists node...\n    const testNode = document.head.querySelector(\n      'link[href=\"' + url + '\"], link[data-url=\"' + url + '\"]',\n    );\n    if (testNode) {\n      // Style already found!\n      return resolve({ type: 'already-loaded', target: testNode });\n    }\n    // reject(new Error('test')); // DEBUG: Test errors catching\n    const node = document.createElement('link');\n    node.setAttribute('href', url);\n    node.setAttribute('type', 'text/css');\n    node.setAttribute('rel', 'stylesheet');\n    node.setAttribute('data-url', url);\n    node.addEventListener('load', resolve);\n    node.addEventListener('error', (event) => {\n      const {\n        target,\n        // srcElement,\n      } = event;\n      // @ts-ignore\n      const { href, baseURI } = target;\n      const error = new Error(`Cannot load css resurce by url '${url}'`);\n      // eslint-disable-next-line no-console\n      console.error('[CommonHelpers:addCssStyle]', {\n        error,\n        url,\n        href,\n        baseURI,\n        target,\n        event,\n      });\n      // eslint-disable-next-line no-debugger\n      debugger;\n      reject(error);\n    });\n    document.head.appendChild(node);\n  });\n}\n\n/**\n * @param {HTMLSelectElement} node\n * @param {(string|number)[]} values\n */\nexport function setMultipleSelectValues(node, values) {\n  const strValues = values.map(String);\n  const options = Array.from(node.options);\n  options.forEach((item) => {\n    const { value, selected } = item;\n    const isSelected = strValues.includes(value);\n    if (isSelected !== selected) {\n      item.selected = isSelected;\n    }\n  });\n}\n\n/** processMultipleRequestErrors\n * @param {Response[]} resList\n * @return {Error[]}\n */\nexport function processMultipleRequestErrors(resList) {\n  return /** @type {Error[]} */ (\n    resList\n      .map((res) => {\n        if (!res.ok) {\n          return new Error(`Can't load url '${res.url}': ${res.statusText}, ${res.status}`);\n        }\n      })\n      .filter(Boolean)\n  );\n}\n\n/**\n * @param {number} n\n * @param {TNormalizedFloatStrOptions} [opts={}]\n * @returns {string}\n */\nexport function normalizedFloatStr(n, opts = {}) {\n  const {\n    // prettier-ignore\n    fixedPoint = 2,\n    stripFixedZeros = true,\n  } = opts;\n  let str = n.toFixed(fixedPoint);\n  if (stripFixedZeros) {\n    str = str.replace(/\\.*0+$/, '');\n  }\n  return str;\n}\n/**\n * @param {number} size\n * @param {TGetApproxSizeOptions} [opts={}]\n * @returns {[number | string, string]}\n */\nexport function getApproxSize(size, opts = {}) {\n  const { normalize } = opts;\n  const levels = [\n    'B', // Bytes\n    'K', // Kilobytes\n    'M', // Megabytes\n    'G', // Gigabites\n  ];\n  const lastLevel = levels.length - 1;\n  const range = 1024;\n  let level = 0;\n  while (level < lastLevel) {\n    if (size < range) {\n      break;\n    }\n    size /= range;\n    level++;\n  }\n  const currLevelStr = levels[level];\n  /** Result: final number or normalized representation (depends on option's `normalize`)\n   * @type {number | string}\n   */\n  let result = size;\n  if (normalize) {\n    const normalizeOpts = typeof normalize === 'object' ? normalize : undefined;\n    result = normalizedFloatStr(size, normalizeOpts);\n  }\n  return [result, currLevelStr];\n}\n\n/** @param {number} time - Time duration, ms\n * @return {string}\n */\nexport function formatDuration(time) {\n  const sec = time / 1000;\n  const min = sec / 60;\n  const hrs = min / 60;\n  const days = hrs / 24;\n  const srcItems = [\n    // prettier-ignore\n    days,\n    hrs % 24,\n    min % 60,\n    sec % 60,\n  ];\n  const items = srcItems.map(Math.floor).map((val, idx) => {\n    // Not mins and secs and empty...\n    if (idx < 2 && !val) {\n      return undefined;\n    }\n    // Hours, mins, secs...\n    if (idx >= 1) {\n      return String(val).padStart(2, '0');\n    }\n    // Days...\n    if (!idx) {\n      return String(val) + 'd';\n    }\n  });\n  /* console.log('[CommonHelpers:formatDuration]', {\n   *   sec,\n   *   min,\n   *   hrs,\n   *   days,\n   *   items,\n   *   srcItems,\n   *   time,\n   * });\n   */\n  const daysStr = items.shift();\n  return [\n    // prettier-ignore\n    daysStr,\n    items.filter(Boolean).join(':'),\n  ]\n    .filter(Boolean)\n    .join(' ');\n}\n\n/** @param {string} str */\nexport function getAsyncHash(str) {\n  const encoder = new TextEncoder();\n  const buf = encoder.encode(str);\n  return crypto.subtle.digest('SHA-256', buf).then((aryBuf) => {\n    const ary = new Uint8Array(aryBuf);\n    const res = Array.from(ary)\n      .map((x) => x.toString(16).padStart(2, '0'))\n      .join('');\n    return res;\n  });\n}\n\n/** @param {string} cookieId */\nexport function getCookie(cookieId) {\n  const cookiesStr = document.cookie;\n  const cookiesList = cookiesStr.split(';'); // .map((s) => s.trim().split('='));\n  for (let i = 0; i < cookiesList.length; i++) {\n    const s = cookiesList[i];\n    const [id, val] = s.trim().split('=').map(decodeURIComponent);\n    if (id === cookieId) {\n      return val;\n    }\n  }\n  return undefined;\n}\n\n/**\n * @param {string} id\n * @param {string} val\n * @param {number} maxAgeSecs -- Seconds of expire period\n */\nexport function setCookie(id, val, maxAgeSecs) {\n  const cookieVal = [id, val || ''].map(encodeURIComponent).join('=');\n  const parts = [\n    // prettier-ignore\n    cookieVal,\n  ];\n  if (maxAgeSecs) {\n    parts.push('max-age=' + maxAgeSecs);\n  }\n  const fullCookie = parts.filter(Boolean).join(';');\n  document.cookie = fullCookie;\n}\n","export function floatToStr(num: number | undefined) {\n  if (!num) {\n    return '0';\n  }\n  if (typeof num === 'string') {\n    if (isNaN(num)) {\n      return '0';\n    }\n    num = Number(num);\n  }\n  return num\n    .toFixed(3)\n    .replace(/(\\.\\d+)0+$/, '$1')\n    .replace(/\\.0+$/, '');\n}\n","import { TrackInfo, trackInfoFromJsonStr, trackInfoToJsonStr } from './TrackInfo';\n\nclass LocalTrackInfoDb {\n  // End-user api\n\n  updatePlayedCount(id: number, playedCount?: number, now?: number) {\n    try {\n      const _now = now || Date.now();\n      const trackInfo = this.getOrCreate(id);\n      if (playedCount == undefined || isNaN(playedCount)) {\n        trackInfo.playedCount = trackInfo.playedCount ? trackInfo.playedCount + 1 : 1;\n      } else {\n        trackInfo.playedCount = playedCount;\n      }\n      trackInfo.lastPlayed = _now;\n      trackInfo.lastUpdated = _now;\n      this.insert(trackInfo);\n      // this.updateEvents.broadcast(TracksInfoDbUpdate(trackInfo));\n      return trackInfo;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error('[LocalTrackInfoDb:incrementPlayedCount]', err.message, {\n        err,\n        id,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw err;\n    }\n  }\n\n  updatePosition(id: number, position: number, now?: number) {\n    try {\n      const _now = now || Date.now();\n      const trackInfo = this.getOrCreate(id);\n      trackInfo.position = position;\n      trackInfo.lastPlayed = _now; // ???\n      trackInfo.lastUpdated = _now;\n      this.insert(trackInfo);\n      // this.updateEvents.broadcast(TracksInfoDbUpdate(trackInfo));\n      return trackInfo;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error('[LocalTrackInfoDb:updatePosition]', err.message, {\n        err,\n        id,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw err;\n    }\n  }\n\n  updateFavorite(id: number, favorite: boolean, now?: number) {\n    try {\n      const _now = now || Date.now();\n      const trackInfo = this.getOrCreate(id);\n      trackInfo.favorite = favorite;\n      trackInfo.lastUpdated = _now;\n      this.insert(trackInfo);\n      this._toggleInFavoritesIndex(id, favorite);\n      // this.updateEvents.broadcast(TracksInfoDbUpdate(trackInfo));\n      return trackInfo;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error('[LocalTrackInfoDb:setFavorite]', err.message, {\n        err,\n        id,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw err;\n    }\n  }\n\n  updateFavoritesByTrackIds(ids: number[], now?: number) {\n    const _now = now || Date.now();\n    const index = this._getIndex();\n    index.forEach((id) => {\n      const isFavorite = ids.includes(id);\n      const trackInfo = this.getOrCreate(id);\n      if (trackInfo.favorite !== isFavorite) {\n        trackInfo.favorite = isFavorite;\n        trackInfo.lastUpdated = _now;\n        this.insert(trackInfo);\n      }\n    });\n    this._setFavoritesIndex(ids);\n  }\n\n  save(trackInfo: TrackInfo, now?: number) {\n    try {\n      const _now = now || Date.now();\n      trackInfo.lastPlayed = _now; // ???\n      trackInfo.lastUpdated = _now;\n      this.insert(trackInfo);\n      // this.updateEvents.broadcast(TracksInfoDbUpdate(trackInfo));\n      // const testTrackInfo = await this.getById(id);\n      return trackInfo;\n    } catch (err) {\n      // eslint-disable-next-line no-console\n      console.error('[LocalTrackInfoDb:save]', err.message, {\n        err,\n        trackInfo,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw err;\n    }\n  }\n\n  // Low-level api\n\n  createNewRecord(id: number) {\n    const now = Date.now();\n    const trackInfo: TrackInfo = {\n      id: id, // track.id\n      favorite: false,\n      playedCount: 0, // track.played_count (but only for current user!).\n      position: 0, // position\n      lastUpdated: now, // DateTime.now()\n      lastPlayed: 0, // DateTime.now()\n    };\n    return trackInfo;\n  }\n\n  getOrCreate(id: number) {\n    return this.getById(id) || this.createNewRecord(id);\n  }\n\n  /// Create or update the record. (Returns inserted/updated record id.)\n  insert(trackInfo: TrackInfo) {\n    const { id } = trackInfo;\n    window.localStorage.setItem('trackInfo-' + id, trackInfoToJsonStr(trackInfo));\n    this._addToIndex(id);\n  }\n\n  getFavorites() {\n    return this.getAll().filter((it) => it.favorite);\n  }\n\n  getById(id: number): TrackInfo | undefined {\n    const str = window.localStorage.getItem('trackInfo-' + id);\n    if (!str) {\n      return undefined;\n    }\n    return trackInfoFromJsonStr(str);\n  }\n\n  _getFavoritesIndex() {\n    try {\n      const data = window.localStorage.getItem('trackInfoFavoritesIndex');\n      return (data ? JSON.parse(data) : []) as number[];\n    } catch (\n      _ // eslint-disable-line @typescript-eslint/no-unused-vars\n    ) {\n      return [] as number[];\n    }\n  }\n\n  _setFavoritesIndex(favoritesIndex: number[]) {\n    window.localStorage.setItem('trackInfoFavoritesIndex', JSON.stringify(favoritesIndex));\n  }\n\n  _addToFavoritesIndex(id: number) {\n    const favoritesIndex = this._getFavoritesIndex();\n    if (!favoritesIndex.includes(id)) {\n      favoritesIndex.push(id);\n      this._setFavoritesIndex(favoritesIndex);\n    }\n  }\n\n  _removeFromFavoritesIndex(id: number) {\n    const favoritesIndex = this._getFavoritesIndex();\n    if (favoritesIndex.includes(id)) {\n      this._setFavoritesIndex(favoritesIndex.filter((checkId) => id !== checkId));\n    }\n  }\n\n  _toggleInFavoritesIndex(id: number, value?: boolean) {\n    if (value) {\n      this._addToFavoritesIndex(id);\n    } else {\n      this._removeFromFavoritesIndex(id);\n    }\n  }\n\n  _getIndex() {\n    try {\n      const str = window.localStorage.getItem('trackInfoIndex');\n      return (str ? str.split(',').map((v) => (v ? Number(v) : 0)) : []) as number[];\n    } catch (\n      _ // eslint-disable-line @typescript-eslint/no-unused-vars\n    ) {\n      return [] as number[];\n    }\n  }\n\n  _setIndex(index: number[]) {\n    window.localStorage.setItem('trackInfoIndex', index.join(','));\n  }\n\n  _addToIndex(id: number) {\n    const index = this._getIndex();\n    if (!index.includes(id)) {\n      index.push(id);\n      this._setIndex(index);\n    }\n  }\n\n  _removeFromIndex(id: number) {\n    const index = this._getIndex();\n    if (index.includes(id)) {\n      this._setIndex(index.filter((checkId) => id !== checkId));\n    }\n  }\n\n  _toggleInIndex(id: number, value?: boolean) {\n    if (value) {\n      this._addToIndex(id);\n    } else {\n      this._removeFromIndex(id);\n    }\n  }\n\n  getAll() {\n    const index = this._getIndex();\n    const list: TrackInfo[] = index\n      .map((id) => {\n        return this.getById(id);\n      })\n      .filter(Boolean) as TrackInfo[];\n    return list;\n  }\n\n  delete(id: number) {\n    window.localStorage.removeItem('trackInfo-' + id);\n    this._removeFromIndex(id);\n  }\n\n  clearAll() {\n    const index = this._getIndex();\n    index.forEach((id) => {\n      window.localStorage.removeItem('trackInfo-' + id);\n    });\n    this._setIndex([]);\n  }\n}\n\n// Create a singleton\nexport const localTrackInfoDb = new LocalTrackInfoDb();\n","import { floatToStr } from '../helpers/floatToStr';\n\nexport interface TrackInfo {\n  id: number; // track.id\n  favorite: boolean;\n  playedCount: number; // track.played_count (but only for current user!).\n  position: number; // position?.inMilliseconds ?? 0\n  lastUpdated: number; // DateTime.now().millisecondsSinceEpoch <-> DateTime.fromMillisecondsSinceEpoch(ms)\n  lastPlayed: number; // DateTime.now().millisecondsSinceEpoch <-> DateTime.fromMillisecondsSinceEpoch(ms)\n}\n\nexport function trackInfoFromJsonStr(str: string): TrackInfo | undefined {\n  if (!str) {\n    return undefined;\n  }\n  try {\n    const list = str.split(',');\n    const [\n      // Keep the order!\n      id,\n      favorite,\n      playedCount,\n      position,\n      lastUpdated, // Timestamp\n      lastPlayed, // Timestamp\n    ] = list;\n    const data: TrackInfo = {\n      // Keep the order!\n      id: id ? Number(id) : 0,\n      favorite: Boolean(favorite),\n      playedCount: playedCount ? Number(playedCount) : 0,\n      position: position ? Number(position) : 0,\n      lastUpdated: lastUpdated ? Number(lastUpdated) * 1000 : 0, // Timestamp\n      lastPlayed: lastPlayed ? Number(lastPlayed) * 1000 : 0, // Timestamp\n    };\n    return data;\n  } catch (\n    err // eslint-disable-line @typescript-eslint/no-unused-vars\n  ) {\n    // eslint-disable-next-line no-console\n    console.warn('[TrackInfo:trackInfoFromJsonStr] Parse error', {\n      str,\n      err,\n    });\n    return undefined;\n  }\n}\n\nexport function trackInfoToJsonStr(trackInfo: TrackInfo) {\n  const {\n    // Keep the order!\n    id,\n    favorite,\n    playedCount,\n    position,\n    lastUpdated,\n    lastPlayed,\n  } = trackInfo;\n  const list = [\n    // Keep the order!\n    id ? Number(id) : undefined,\n    favorite ? Number(favorite) : undefined,\n    playedCount ? Number(playedCount) : undefined,\n    position ? floatToStr(position) : undefined, // Use fixed decimal presentation for floats\n    lastUpdated ? Math.round(lastUpdated / 1000) : undefined, // Timestamp\n    lastPlayed ? Math.round(lastPlayed / 1000) : undefined, // Timestamp\n  ];\n  return list.join(',').replace(/,+$/, '');\n}\n","import { quoteHtmlAttr } from '../helpers/CommonHelpers';\n\nexport function getJsText(id: string) {\n  const textNode = document.body.querySelector('#js-texts #' + id);\n  if (!textNode) {\n    // eslint-disable-next-line no-console\n    console.warn('[getJsText] Can not find js text node for id:', id);\n  }\n  const text = textNode?.innerHTML || id;\n  return quoteHtmlAttr(text).trim();\n}\n","import * as CommonHelpers from '../helpers/CommonHelpers';\n\n/** Toast types */\ntype TMode = 'info' | 'error' | 'warn' | 'success';\n\n/** Icon shapes (move to constants?) */\nconst icons: Record<TMode, string> = {\n  success: 'bi-check',\n  error: 'bi-exclamation-triangle-fill',\n  warn: 'bi-bell-fill',\n  info: 'bi-info-lg',\n};\n\nconst iconClassNamePrefix = 'bi';\n\ninterface TNotifyData {\n  node: HTMLDivElement;\n  handler?: TSetTimeout;\n}\n\n// Define module...\nclass CommonNotify {\n  notifyRoot?: HTMLDivElement;\n\n  timeoutDelay = 3000;\n\n  inited = false;\n\n  // Methods...\n\n  removeNotify(notifyData: TNotifyData) {\n    const { node, handler } = notifyData;\n    // Play animation...\n    node.classList.remove('active');\n    if (handler) {\n      clearTimeout(handler);\n      notifyData.handler = undefined;\n    }\n    setTimeout(() => {\n      // ...And remove node (TODO: Check if node still exists in dom tree)...\n      try {\n        this.notifyRoot?.removeChild(node);\n      } catch (\n        _e // eslint-disable-line @typescript-eslint/no-unused-vars\n      ) {\n        // NOOP\n      }\n    }, 250); // Value of `var(--common-animation-time)`\n  }\n\n  /** showNotify\n   * @param {'info' | 'error' | 'warn' | 'success'} mode - Message type ('info' is default)\n   * @param {string|Error} text - Message content\n   */\n  showNotify(mode: TMode, text: string | Error) {\n    this.ensureInit();\n    if (!text) {\n      // If only one parameters passed assume it as message with default type\n      text = mode;\n      mode = 'info';\n    }\n    let content: string;\n    if (text instanceof Error) {\n      // Convert error object to the plain text...\n      content = CommonHelpers.getErrorText(text);\n    } else {\n      content = String(text);\n    }\n    // Create node...\n    const node = document.createElement('div');\n    node.classList.add('notify');\n    node.classList.add('notify-' + mode);\n    // Add icon...\n    const nodeIcon = document.createElement('span');\n    nodeIcon.classList.add('icon');\n    nodeIcon.classList.add(iconClassNamePrefix);\n    nodeIcon.classList.add(icons[mode]);\n    node.appendChild(nodeIcon);\n    // Add text...\n    const nodeText = document.createElement('div');\n    nodeText.classList.add('text');\n    nodeText.innerHTML = content;\n    node.appendChild(nodeText);\n    this.notifyRoot?.appendChild(node);\n    // Play appearing animation...\n    window.requestAnimationFrame(() => {\n      setTimeout(() => {\n        node.classList.add('active');\n      }, 10);\n    });\n    // Remove node after delay...\n    const notifyData: TNotifyData = { node, handler: undefined };\n    const removeNotifyHandler = this.removeNotify.bind(this, notifyData);\n    notifyData.handler = setTimeout(removeNotifyHandler, this.timeoutDelay);\n    // Stop & restore timer on mouse in and out events...\n    node.addEventListener('mouseenter', () => {\n      // Clear timer...\n      clearTimeout(notifyData.handler);\n    });\n    node.addEventListener('mouseleave', () => {\n      // Resume timer...\n      notifyData.handler = setTimeout(removeNotifyHandler, this.timeoutDelay);\n    });\n    // Click handler...\n    node.addEventListener('click', removeNotifyHandler);\n  }\n\n  // Some shorthands...\n\n  /** @param {string|Error} text - Message content */\n  showInfo(text: string | Error) {\n    this.showNotify('info', text);\n  }\n\n  /** @param {string|Error} text - Message content */\n  showSuccess(text: string | Error) {\n    this.showNotify('success', text);\n  }\n\n  /** @param {string|Error} text - Message content */\n  showWarn(text: string | Error) {\n    this.showNotify('warn', text);\n  }\n\n  /** @param {string|Error} text - Message content */\n  showError(text: string | Error) {\n    this.showNotify('error', text);\n  }\n\n  // Demo...\n\n  showDemo() {\n    // DEBUG: Show sample notifiers...\n    this.showInfo('Info');\n    this.showSuccess('Success');\n    this.showWarn('Warn');\n    this.showError('Error');\n  }\n\n  // Initialization...\n\n  /** Ensure the modal has initiazlized */\n  ensureInit() {\n    this.init();\n  }\n\n  createDomNode() {\n    // TODO: To use bootstrap toasts?\n    const rootNode = document.body;\n    const notifyRoot = document.createElement('div');\n    notifyRoot.classList.add('notify-root');\n    notifyRoot.setAttribute('id', 'notify-root');\n    rootNode.appendChild(notifyRoot);\n    this.notifyRoot = notifyRoot;\n  }\n\n  /** Initialize nodule. */\n  init() {\n    if (!this.inited) {\n      this.createDomNode();\n      this.inited = true;\n    }\n  }\n}\n\n// Create and export singletone\nexport const commonNotify = new CommonNotify();\n\n// commonNotify.init();\n","export interface ActivePlayerData {\n  id: number;\n  title: string;\n  imageUrl: string;\n  mediaUrl: string;\n  duration: number;\n  favorite: boolean;\n}\n\nconst storageActivePlayerDataId = 'ActivePlayerData';\n\nfunction convertActivePlayerDataFromJsonStr(str?: string | null) {\n  if (!str) {\n    return undefined;\n  }\n  try {\n    const raw = JSON.parse(str);\n    // const list = str.split(',');\n    const {\n      // Keep the order!\n      id,\n      title,\n      imageUrl,\n      mediaUrl,\n      duration,\n      favorite,\n    } = raw;\n    const data: ActivePlayerData = {\n      // Keep the order!\n      id: id ? Number(id) : 0,\n      title: title ? String(title) : '',\n      imageUrl: imageUrl ? String(imageUrl) : '',\n      mediaUrl: mediaUrl ? String(mediaUrl) : '',\n      duration: duration ? Number(duration) : 0,\n      favorite: Boolean(favorite),\n    };\n    return data;\n  } catch (\n    err // eslint-disable-line @typescript-eslint/no-unused-vars\n  ) {\n    // eslint-disable-next-line no-console\n    console.warn('[ActivePlayerData:storageActivePlayerDataId] Parse error', {\n      str,\n      err,\n    });\n    return undefined;\n  }\n}\n\nfunction convertActivePlayerDataToJsonStr(data: ActivePlayerData) {\n  return JSON.stringify(data);\n}\n\nexport function saveActivePlayerData(data?: ActivePlayerData) {\n  const str = data ? convertActivePlayerDataToJsonStr(data) : '';\n  window.localStorage.setItem(storageActivePlayerDataId, str);\n}\n\nexport function loadActivePlayerData() {\n  const str = window.localStorage.getItem(storageActivePlayerDataId);\n  return convertActivePlayerDataFromJsonStr(str);\n}\n","import { getCookie } from '../helpers/CommonHelpers';\nimport * as CommonHelpers from '../helpers/CommonHelpers';\nimport { getJsText } from './getJsText';\n\nexport function sendApiRequest(url: string, method: string = 'GET', requestData?: unknown) {\n  const csrftoken = getCookie('csrftoken');\n  // const sessionId = getCookie('sessionid');\n  // const url = `/api/v1/tracks/${trackId}/toggle-favorite/`;\n  const headers = {\n    Accept: 'application/json',\n    'Content-Type': 'application/json',\n    'X-CSRFToken': csrftoken || '',\n    // Credentials: 'include',\n    // Cookie: csrftoken && `csrftoken=${csrftoken}`,\n    // 'X-Session-Token': sessionId, // X-Session-Token\n    // 'Accept-Language': 'ru', // django_language=ru; content-language: ru;\n  };\n  return fetch(url, {\n    method,\n    headers,\n    credentials: 'include',\n    body: requestData ? JSON.stringify(requestData) : null,\n  })\n    .then(async (res) => {\n      const { ok, status, statusText } = res;\n      // TODO: Check is it json?\n      let data: (unknown & { detail?: string }) | undefined = undefined;\n      try {\n        data = await res.json();\n      } catch (\n        _e // eslint-disable-line @typescript-eslint/no-unused-vars\n      ) {\n        // NOOP\n      }\n      if (!ok || status !== 200) {\n        const errMsg = [getJsText('fetchError') + ' ' + status, data?.detail || statusText]\n          .filter(Boolean)\n          .join(': ');\n        // eslint-disable-next-line no-console\n        console.error('[sendApiRequest]', errMsg, {\n          ok,\n          data,\n          statusText,\n          status,\n          res,\n          url,\n          requestData,\n          method,\n          headers,\n        });\n        debugger; // eslint-disable-line no-debugger\n        throw new Error(errMsg);\n      }\n      return data as unknown;\n    })\n    .catch((err) => {\n      const errMsg = [getJsText('failedApiRequest'), CommonHelpers.getErrorText(err)]\n        .filter(Boolean)\n        .join(': ');\n      // eslint-disable-next-line no-console\n      console.error('[sendApiRequest]', errMsg, {\n        err,\n        url,\n        requestData,\n        method,\n        headers,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw new Error(errMsg);\n    });\n}\n","import { floatToStr } from '../../helpers/floatToStr';\n\ntype Status = 'playing' | 'paused' | 'waiting';\n\nexport interface FloatingPlayerState {\n  lastTimestamp?: number; // Timestamp\n  visible?: boolean;\n  loaded?: boolean;\n  status?: Status | undefined;\n  position?: number;\n  progress?: number;\n  error?: string;\n}\n\nconst storageFloatingPlayerStateId = 'FloatingPlayerState';\n\nfunction convertFloatingPlayerStateFromJsonStr(str?: string | null) {\n  if (!str) {\n    return {};\n  }\n  try {\n    const list = str.split(',');\n    const [\n      // Keep the order!\n      lastTimestamp,\n      visible,\n      status,\n      position,\n      progress,\n    ] = list;\n    const data: FloatingPlayerState = {\n      // Keep the order!\n      lastTimestamp: lastTimestamp ? Number(lastTimestamp) * 1000 : undefined, // Timestamp\n      visible: visible ? Boolean(visible) : undefined,\n      status: status ? (String(status) as Status) : undefined,\n      position: position ? Number(position) : undefined,\n      progress: progress ? Number(progress) : undefined,\n    };\n    return data;\n  } catch (\n    err // eslint-disable-line @typescript-eslint/no-unused-vars\n  ) {\n    // eslint-disable-next-line no-console\n    console.warn('[FloatingPlayerState:convertFloatingPlayerStateFromJsonStr] Parse error', {\n      str,\n      err,\n    });\n    return {};\n  }\n}\n\nfunction convertFloatingPlayerStateToJsonStr(data: FloatingPlayerState) {\n  const {\n    // Keep the order!\n    lastTimestamp,\n    visible,\n    status,\n    position,\n    progress,\n  } = data;\n  const list = [\n    // Keep the order!\n    lastTimestamp ? Math.round(lastTimestamp / 1000) : undefined, // Timestamp\n    visible ? Number(visible) : undefined, // Boolean\n    status ? status : undefined,\n    position ? floatToStr(position) : undefined,\n    progress ? floatToStr(progress) : undefined,\n  ];\n  const str = list.join(',').replace(/,+$/, '');\n  return str;\n}\n\nexport function saveFloatingPlayerState(data: FloatingPlayerState) {\n  const saveData = { ...data, lastTimestamp: Date.now() };\n  const str = convertFloatingPlayerStateToJsonStr(saveData);\n  window.localStorage.setItem(storageFloatingPlayerStateId, str);\n}\n\nexport function loadFloatingPlayerState() {\n  const str = window.localStorage.getItem(storageFloatingPlayerStateId);\n  return convertFloatingPlayerStateFromJsonStr(str);\n}\n","interface THiddenPlayerOptions {\n  type?: string;\n  src?: string;\n}\n\nexport class HiddenPlayer {\n  hiddenPlayerNode?: HTMLElement;\n  parentDomNode?: HTMLElement;\n\n  audioNode?: HTMLAudioElement;\n  sourceNode?: HTMLSourceElement;\n\n  setParentDomNode(parentDomNode: HTMLElement) {\n    this.parentDomNode = parentDomNode;\n  }\n\n  requireParentDomNode() {\n    return this.parentDomNode || document.body;\n  }\n\n  ensureHiddenPlayer(/* opts: THiddenPlayerOptions = {} */) {\n    if (!this.hiddenPlayerNode) {\n      this.hiddenPlayerNode = document.createElement('div');\n      this.hiddenPlayerNode.classList.add('hidden-player');\n      const audio = document.createElement('audio');\n      // audio.addEventListener('loadeddata', this.hiddenPlayerCanPlay);\n      this.hiddenPlayerNode.appendChild(audio);\n      const parentDomNode = this.requireParentDomNode();\n      parentDomNode.appendChild(this.hiddenPlayerNode);\n    }\n    return this.hiddenPlayerNode;\n  }\n\n  hasAudio() {\n    return !!this.audioNode;\n  }\n\n  hasSource() {\n    return !!this.sourceNode;\n  }\n\n  ensureHiddenPlayerAudio() {\n    if (!this.audioNode) {\n      const parentDomNode = this.requireParentDomNode();\n      this.audioNode = document.createElement('audio');\n      this.audioNode.classList.add('hidden-player');\n      this.audioNode.setAttribute('preload', 'auto');\n      // audio.addEventListener('loadeddata', this.hiddenPlayerCanPlay);\n      parentDomNode.appendChild(this.audioNode);\n    }\n    return this.audioNode;\n  }\n\n  createHiddenPlayerSource(opts: THiddenPlayerOptions = {}) {\n    this.removeHiddenPlayerSource();\n    const audio = this.ensureHiddenPlayerAudio();\n    this.sourceNode = document.createElement('source');\n    this.sourceNode.setAttribute('type', opts.type || 'audio/mpeg');\n    if (opts.src) {\n      this.sourceNode.setAttribute('src', opts.src);\n    }\n    // @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/loadeddata_event\n    // audio.addEventListener('canplay', this.handleCanPlay.bind(this));\n    // audio.addEventListener('playing', this.handlePlay.bind(this));\n    // audio.addEventListener('timeupdate', this.handleTimeUpdate.bind(this));\n    // audio.addEventListener('ended', this.handleEnded.bind(this));\n    // this.sourceNode.addEventListener('error', this.handleError.bind(this));\n    audio.appendChild(this.sourceNode);\n    return this.sourceNode;\n  }\n\n  removeHiddenPlayerAudio() {\n    if (this.audioNode) {\n      this.audioNode.pause();\n      this.audioNode.remove();\n      this.audioNode = undefined;\n      this.sourceNode = undefined;\n    }\n  }\n\n  removeHiddenPlayerSource() {\n    const audio = this.ensureHiddenPlayerAudio();\n    const prevSources = Array.from(audio.getElementsByTagName('source'));\n    for (const node of prevSources) {\n      node.remove();\n    }\n    this.sourceNode = undefined;\n  }\n}\n","import { formatDuration, quoteHtmlAttr } from '../helpers/CommonHelpers';\n\nimport { localTrackInfoDb } from './localTrackInfoDb';\nimport { floatingPlayer } from '../entities/FloatingPlayer/floatingPlayer';\nimport {\n  FloatingPlayerFavoriteData,\n  FloatingPlayerFavoritesData,\n  FloatingPlayerIncrementData,\n  FloatingPlayerUpdateData,\n} from '../entities/FloatingPlayer/FloatingPlayerCallbacks';\nimport { floatToStr } from '../helpers/floatToStr';\nimport { TrackInfo } from './TrackInfo';\n\nlet allPlayers: NodeListOf<HTMLElement>;\nlet currentTrackPlayer: HTMLElement | undefined = undefined;\n\n// Values for dataset statuses\nconst TRUE = 'true';\n\nfunction calculateAndUpdateTrackPosition(\n  trackNode: HTMLElement,\n  position: number,\n  _isCurrent?: boolean,\n) {\n  const timeNode = trackNode.querySelector<HTMLElement>('.time');\n  const { dataset } = trackNode;\n  const { trackId, trackDuration } = dataset;\n  const timeMs = Math.floor(position * 1000);\n  const timeFormatted = formatDuration(timeMs);\n  const id = Number(trackId);\n  const duration = trackDuration ? parseFloat(trackDuration.replace(',', '.')) : 0;\n  if (!duration) {\n    const error = new Error(`No duration provided for a track: ${id}`);\n    // eslint-disable-next-line no-console\n    console.error('[tracksPlayer:updateTrackPosition]', error.message, {\n      error,\n    });\n    debugger; // eslint-disable-line no-debugger\n  }\n  const ratio = position / duration;\n  const progress = Math.min(100, ratio * 100);\n  requestAnimationFrame(() => {\n    dataset.position = floatToStr(position);\n    dataset.progress = floatToStr(progress);\n    trackNode.style.setProperty('--progress', dataset.progress);\n    if (timeNode) {\n      timeNode.innerText = timeFormatted;\n    }\n  });\n  localTrackInfoDb.updatePosition(id, position);\n  // TODO: Update the floating player if isCurrent?\n  return { position, duration, progress };\n}\n\nfunction floatingPlayerUpdate(data: FloatingPlayerUpdateData) {\n  const { floatingPlayerState, activePlayerData } = data;\n  const { id } = activePlayerData;\n  let trackNode = currentTrackPlayer;\n  if (!trackNode || Number(trackNode.dataset.trackId) !== id) {\n    trackNode = getTrackNode(id);\n  }\n  if (!trackNode) {\n    return;\n  }\n  // const isCurrent = trackNode === currentTrackPlayer;\n  const { position = 0, progress = 0, status } = floatingPlayerState;\n  const { dataset } = trackNode;\n  const timeNode = trackNode.querySelector<HTMLElement>('.time');\n  const timeMs = Math.floor(position * 1000);\n  const timeFormatted = formatDuration(timeMs);\n  requestAnimationFrame(() => {\n    if (status) {\n      dataset.status = status;\n    } else {\n      delete dataset.status;\n    }\n    dataset.position = floatToStr(position);\n    dataset.progress = floatToStr(progress);\n    trackNode.style.setProperty('--progress', dataset.progress);\n    if (timeNode) {\n      timeNode.innerText = timeFormatted;\n    }\n  });\n  // calculateAndUpdateTrackPosition(trackNode, position, isCurrent); // Is it required here?\n  // TODO: Update the floating player if isCurrent?\n}\n\nfunction floatingPlayerPlay(data: FloatingPlayerUpdateData) {\n  const {\n    // floatingPlayerState,\n    activePlayerData,\n  } = data;\n  if (!currentTrackPlayer) {\n    throw new Error('No current track player node!');\n  }\n  const { dataset } = currentTrackPlayer;\n  const id = Number(dataset.trackId);\n  if (id !== activePlayerData.id) {\n    throw new Error('Wrong active track id!');\n  }\n  requestAnimationFrame(() => {\n    dataset.status = 'playing';\n  });\n}\n\nfunction floatingPlayerStop(data: FloatingPlayerUpdateData) {\n  const {\n    // floatingPlayerState, // ???\n    activePlayerData,\n  } = data;\n  if (!currentTrackPlayer) {\n    throw new Error('No current track player node!');\n  }\n  const { dataset } = currentTrackPlayer;\n  const id = Number(dataset.trackId);\n  if (id !== activePlayerData.id) {\n    throw new Error('Wrong active track id!');\n  }\n  requestAnimationFrame(() => {\n    delete dataset.status;\n  });\n}\n\nfunction getTrackNode(id: number) {\n  const players = Array.from(allPlayers);\n  const trackNode = players.find((it) => Number(it.dataset.trackId) === id);\n  return trackNode;\n}\n\nfunction stopPreviousPlayer() {\n  if (currentTrackPlayer) {\n    const { dataset } = currentTrackPlayer;\n    requestAnimationFrame(() => {\n      currentTrackPlayer!.classList.toggle('current', false);\n      delete dataset.status;\n      delete dataset.loaded;\n      delete dataset.error;\n    });\n  }\n}\n\nfunction updateTrackPlayedCount(\n  trackNode: HTMLElement,\n  playedCount?: number,\n  _isCurrent?: boolean,\n) {\n  const { dataset } = trackNode;\n  const { trackId } = dataset;\n  const id = Number(trackId);\n  if (!id) {\n    throw new Error('No current track id!');\n  }\n  const updatedTrackInfo = localTrackInfoDb.updatePlayedCount(id, playedCount);\n  const { playedCount: updatedPlayedCount } = updatedTrackInfo;\n  const strValue = quoteHtmlAttr(String(updatedPlayedCount));\n  const valueNode = trackNode.querySelector('#played_count') as HTMLElement;\n  // Update counter in the document...\n  if (valueNode) {\n    const parent = valueNode.closest('.track-played-count[data-played-count]') as HTMLElement;\n    requestAnimationFrame(() => {\n      valueNode.innerText = strValue;\n      if (parent) {\n        parent.dataset.playedCount = strValue;\n      }\n    });\n  }\n  // TODO: Update value in the floating player?\n}\n\nfunction updateIncrementCallback(data: FloatingPlayerIncrementData) {\n  const {\n    count,\n    // floatingPlayerState,\n    activePlayerData,\n  } = data;\n  const trackNode = getTrackNode(activePlayerData.id);\n  const isCurrent = trackNode === currentTrackPlayer;\n  if (trackNode) {\n    updateTrackPlayedCount(trackNode, count, isCurrent);\n  }\n}\n\n/** Play button click handler */\nfunction trackPlayHandler(ev: MouseEvent) {\n  const controlNode = ev.currentTarget as HTMLElement;\n  const trackNode = controlNode.closest('.track-player') as HTMLElement;\n  // Reset previous player\n  if (currentTrackPlayer && currentTrackPlayer !== trackNode) {\n    stopPreviousPlayer();\n  }\n  const { dataset } = trackNode;\n  const id = Number(dataset.trackId);\n\n  const playingId = floatingPlayer.getActiveTrackId();\n  const isFloatingPlaying = floatingPlayer.isPlaying();\n  if (isFloatingPlaying) {\n    // Pause playback\n    floatingPlayer.pauseCurrentPlayer();\n    if (playingId === id) {\n      // Return -- just pause current track\n      return;\n    }\n  }\n\n  // Clear all tracks active status?\n  requestAnimationFrame(() => {\n    allPlayers.forEach((it) => {\n      if (it !== trackNode && it.classList.contains('current')) {\n        it.classList.toggle('current', false);\n      }\n    });\n    trackNode.classList.toggle('current', true);\n  });\n\n  currentTrackPlayer = trackNode;\n\n  const position = parseFloat((dataset.position || '0').replace(',', '.'));\n  floatingPlayer.setActiveTrack(trackNode, position);\n\n  floatingPlayer.playCurrentPlayer();\n\n  // Show floating player if has been hidden\n  if (!isFloatingPlaying) {\n    floatingPlayer.showFloatingPlayer();\n  }\n}\n\nfunction updateTrackFavorite(trackNode: HTMLElement, isFavorite: boolean) {\n  const { dataset } = trackNode;\n  const { favorite } = dataset;\n  const isCurrentFavorite = Boolean(favorite);\n  if (isFavorite !== isCurrentFavorite) {\n    requestAnimationFrame(() => {\n      if (isFavorite) {\n        dataset.favorite = TRUE;\n      } else {\n        delete dataset.favorite;\n      }\n    });\n  }\n}\n\nfunction updateSingleFavoriteCallback({ id, favorite }: FloatingPlayerFavoriteData) {\n  const trackNode = getTrackNode(id);\n  if (trackNode) {\n    updateTrackFavorite(trackNode, favorite);\n  }\n}\n\nfunction updateFavoritesCallback({ favorites }: FloatingPlayerFavoritesData) {\n  allPlayers.forEach((trackNode) => {\n    const { dataset } = trackNode;\n    const { trackId } = dataset;\n    const id = Number(trackId);\n    const isFavorite = favorites.includes(id);\n    updateTrackFavorite(trackNode, isFavorite);\n  });\n}\n\n// function updateTrackDataFromDataset(\n//   trackInfo: TrackInfo,\n//   dataset: DOMStringMap,\n//   activePlayerData?: ActivePlayerData,\n// ) {\n//   ///\n// }\n\nfunction initTrackPlayerNode(trackNode: HTMLElement) {\n  const activePlayerData = floatingPlayer.activePlayerData;\n  const { dataset } = trackNode;\n  const {\n    inited,\n    trackId, // \"1\"\n    trackMediaUrl, // \"/media/samples/gr-400x225.jpg\"\n  } = dataset;\n  const id = Number(trackId || '');\n  if (!id || inited || !trackMediaUrl) {\n    return;\n  }\n  const hasServerData = window.isAuthenticated;\n  const isCurrent = activePlayerData?.id == id;\n  const trackInfo: TrackInfo | undefined = localTrackInfoDb.getById(id);\n  if (trackInfo) {\n    if (!hasServerData) {\n      // If no server data then update favorite from the local db\n      if (trackInfo?.favorite) {\n        updateTrackFavorite(trackNode, trackInfo.favorite);\n      }\n    }\n    const {\n      duration,\n      // position,\n      // progress,\n    } = calculateAndUpdateTrackPosition(trackNode, trackInfo.position || 0, isCurrent);\n    const playedCount = Number(\n      trackNode.querySelector<HTMLElement>('.track-played-count')?.dataset.playedCount || '0',\n    );\n    const favorite = Boolean(dataset.favorite);\n    // Update the local db date...\n    if (activePlayerData) {\n      activePlayerData.favorite = favorite;\n      activePlayerData.duration = duration;\n    }\n    /* TODO: Update local data (favorite, playedCount) from track node dataset?\n     * - id\n     * - favorite\n     * - lastPlayed\n     * - lastUpdated\n     * - playedCount\n     * - position\n     */\n    if (playedCount !== trackInfo.playedCount || favorite !== trackInfo.favorite) {\n      trackInfo.playedCount = playedCount;\n      trackInfo.favorite = favorite;\n      localTrackInfoDb.save(trackInfo);\n    }\n  }\n  if (isCurrent) {\n    activePlayerData.title = dataset.trackTitle || '';\n    currentTrackPlayer = trackNode;\n    requestAnimationFrame(() => {\n      trackNode.classList.toggle('current', true);\n    });\n    floatingPlayerUpdate({ floatingPlayerState: floatingPlayer.state, activePlayerData });\n  }\n\n  // Set controls' handlers\n  const controls = trackNode.querySelectorAll<HTMLElement>('.track-control');\n  controls.forEach((node) => {\n    const { dataset } = node;\n    const { inited, controlId } = dataset;\n    if (inited) {\n      return;\n    }\n    if (controlId === 'toggleFavorite') {\n      node.addEventListener('click', () => floatingPlayer.toggleFavoriteById(id));\n    }\n    if (controlId === 'play') {\n      node.addEventListener('click', trackPlayHandler);\n    }\n    dataset.inited = TRUE;\n  });\n  dataset.inited = TRUE;\n}\n\nexport function initTracksPlayerWrapper(domNode: HTMLElement = document.body) {\n  allPlayers = domNode.querySelectorAll<HTMLElement>('.track-player[data-track-media-url]');\n  allPlayers.forEach(initTrackPlayerNode);\n  floatingPlayer.callbacks.addPlayStartCallback(floatingPlayerPlay);\n  floatingPlayer.callbacks.addPlayStopCallback(floatingPlayerStop);\n  floatingPlayer.callbacks.addUpdateCallback(floatingPlayerUpdate);\n  floatingPlayer.callbacks.addIncrementCallback(updateIncrementCallback);\n  floatingPlayer.callbacks.addFavoritesCallback(updateFavoritesCallback);\n  floatingPlayer.callbacks.addFavoriteCallback(updateSingleFavoriteCallback);\n}\n","import { ActivePlayerData } from '../ActivePlayerData/ActivePlayerData';\nimport { FloatingPlayerState } from './FloatingPlayerState';\n\nexport interface FloatingPlayerUpdateData {\n  floatingPlayerState: FloatingPlayerState;\n  activePlayerData: ActivePlayerData;\n}\nexport interface FloatingPlayerIncrementData {\n  count?: number;\n  // floatingPlayerState: FloatingPlayerState;\n  activePlayerData: ActivePlayerData;\n}\nexport interface FloatingPlayerFavoritesData {\n  favorites: number[];\n}\nexport interface FloatingPlayerFavoriteData {\n  id: number;\n  favorite: boolean;\n  // activePlayerData: ActivePlayerData;\n}\ntype UpdateCallback = (data: FloatingPlayerUpdateData) => void;\ntype IncrementCallback = (data: FloatingPlayerIncrementData) => void;\ntype FavoritesCallback = (data: FloatingPlayerFavoritesData) => void;\ntype FavoriteCallback = (data: FloatingPlayerFavoriteData) => void;\ntype ErrorCallback = (error: Error | string) => void;\n\n// type HandlerId = 'play' | 'stop' | 'time';\nexport class FloatingPlayerCallbacks {\n  onPlayStartCallbacks: UpdateCallback[] = [];\n  onPlayStopCallbacks: UpdateCallback[] = [];\n  onUpdateCallbacks: UpdateCallback[] = [];\n  onIncrementCallbacks: IncrementCallback[] = [];\n  onFavoritesCallbacks: FavoritesCallback[] = [];\n  onFavoriteCallbacks: FavoriteCallback[] = [];\n  onErrorCallbacks: ErrorCallback[] = [];\n\n  // handlers: Record<HandlerId, ErrorCallback[]> = {};\n\n  addPlayStartCallback(cb: UpdateCallback) {\n    if (cb && !this.onPlayStartCallbacks.includes(cb)) {\n      this.onPlayStartCallbacks.push(cb);\n    }\n  }\n\n  addPlayStopCallback(cb: UpdateCallback) {\n    if (cb && !this.onPlayStopCallbacks.includes(cb)) {\n      this.onPlayStopCallbacks.push(cb);\n    }\n  }\n\n  addUpdateCallback(cb: UpdateCallback) {\n    if (cb && !this.onUpdateCallbacks.includes(cb)) {\n      this.onUpdateCallbacks.push(cb);\n    }\n  }\n\n  addIncrementCallback(cb: IncrementCallback) {\n    if (cb && !this.onIncrementCallbacks.includes(cb)) {\n      this.onIncrementCallbacks.push(cb);\n    }\n  }\n\n  addFavoriteCallback(cb: FavoriteCallback) {\n    if (cb && !this.onFavoriteCallbacks.includes(cb)) {\n      this.onFavoriteCallbacks.push(cb);\n    }\n  }\n\n  addFavoritesCallback(cb: FavoritesCallback) {\n    if (cb && !this.onFavoritesCallbacks.includes(cb)) {\n      this.onFavoritesCallbacks.push(cb);\n    }\n  }\n\n  addErrorCallback(cb: ErrorCallback) {\n    if (cb && !this.onErrorCallbacks.includes(cb)) {\n      this.onErrorCallbacks.push(cb);\n    }\n  }\n\n  // Invokers\n\n  invokePlayStart(data: FloatingPlayerUpdateData) {\n    if (data.activePlayerData) {\n      this.onPlayStartCallbacks.forEach((cb) => {\n        cb(data);\n      });\n    }\n  }\n\n  invokePlayStop(data: FloatingPlayerUpdateData) {\n    if (data.activePlayerData) {\n      this.onPlayStopCallbacks.forEach((cb) => {\n        cb(data);\n      });\n    }\n  }\n\n  invokeUpdate(data: FloatingPlayerUpdateData) {\n    if (data.activePlayerData) {\n      this.onUpdateCallbacks.forEach((cb) => {\n        cb(data);\n      });\n    }\n  }\n\n  invokeIncrement(data: FloatingPlayerIncrementData) {\n    if (data.activePlayerData) {\n      this.onIncrementCallbacks.forEach((cb) => {\n        cb(data);\n      });\n    }\n  }\n\n  invokeFavorite(data: FloatingPlayerFavoriteData) {\n    this.onFavoriteCallbacks.forEach((cb) => {\n      cb(data);\n    });\n  }\n\n  invokeFavorites(data: FloatingPlayerFavoritesData) {\n    this.onFavoritesCallbacks.forEach((cb) => {\n      cb(data);\n    });\n  }\n\n  invokeError(error: Error | string) {\n    if (error) {\n      this.onErrorCallbacks.forEach((cb) => {\n        cb(error);\n      });\n    }\n  }\n}\n","import { getJsText } from '../../helpers/getJsText';\nimport { commonNotify } from '../../CommonNotify/CommonNotifySingleton';\nimport { formatDuration, getErrorText } from '../../helpers/CommonHelpers';\nimport { localTrackInfoDb } from '../../track-blocks/localTrackInfoDb';\n\nimport {\n  ActivePlayerData,\n  loadActivePlayerData,\n  saveActivePlayerData,\n} from '../ActivePlayerData/ActivePlayerData';\nimport { getActivePlayerDataFromTrackNode } from '../ActivePlayerData/getActivePlayerDataFromTrackNode';\nimport { sendApiRequest } from '../../helpers/sendApiRequest';\nimport { floatToStr } from '../../helpers/floatToStr';\nimport {\n  FloatingPlayerState,\n  loadFloatingPlayerState,\n  saveFloatingPlayerState,\n} from './FloatingPlayerState';\n\nimport { HiddenPlayer } from './HiddenPlayer';\nimport { FloatingPlayerCallbacks } from './FloatingPlayerCallbacks';\n\n// TODO: Update track title on the language change?\n\nconst TRUE = 'true';\n\n/** A value of forward/backward seek step */\nconst seekTimeSec = 1;\n\nexport class FloatingPlayer {\n  inited = false;\n  callbacks = new FloatingPlayerCallbacks();\n  audio?: HTMLAudioElement;\n  hiddenPlayer: HiddenPlayer = new HiddenPlayer();\n  activePlayerData?: ActivePlayerData;\n  state: FloatingPlayerState = {};\n  domNode?: HTMLElement | null;\n  incrementing?: boolean;\n  toggling: Record<number, boolean> = {};\n  seeking = false;\n\n  constructor() {\n    this.loadActivePlayerData();\n    this.loadFloatingPlayerState();\n    this.initDomNode();\n    this.updateAll();\n    // Check if it was recently playing...\n    const now = Date.now();\n    if (this.activePlayerData) {\n      this.ensureAudioLoaded();\n      if (\n        this.state.status === 'playing' &&\n        this.state.lastTimestamp &&\n        this.state.lastTimestamp > now - 5000\n      ) {\n        // TODO: Then resume playback...\n        /* console.log('[FloatingPlayerClass:constructor] Start play', {\n         *   activePlayerData: this.activePlayerData,\n         *   state: this.state,\n         * });\n         */\n        // TODO: Care about: `Uncaught (in promise) NotAllowedError: play() failed because the user didn't interact with the document first. https://goo.gl/xX8pDD`\n        this.playCurrentPlayer();\n      } else {\n        // Reset the status\n        delete this.state.status;\n      }\n    }\n  }\n\n  requireAudio() {\n    if (!this.audio) {\n      this.audio = this.hiddenPlayer.ensureHiddenPlayerAudio();\n      this.audio.addEventListener('canplay', this.handleAudioCanPlay.bind(this));\n      this.audio.addEventListener('playing', this.handleAudioPlay.bind(this));\n      this.audio.addEventListener('timeupdate', this.handleAudioTimeUpdate.bind(this));\n      this.audio.addEventListener('ended', this.handleAudioEnded.bind(this));\n      // source.addEventListener('error', this.handleAudioSourceError.bind(this));\n    }\n    return this.audio;\n  }\n\n  removeAudio() {\n    this.hiddenPlayer.removeHiddenPlayerAudio();\n    this.audio = undefined;\n  }\n\n  hasAudio() {\n    return !!this.audio;\n  }\n\n  hasAudioSource() {\n    return this.hiddenPlayer.hasSource();\n  }\n\n  requireDomNode() {\n    if (!this.domNode) {\n      this.domNode = document.querySelector<HTMLElement>('.floating-player');\n      this.hiddenPlayer.setParentDomNode(this.domNode!);\n    }\n    // TODO: Ensure created dom node?\n    if (!this.domNode) {\n      const error = new Error('No floating player node found');\n      // eslint-disable-next-line no-console\n      console.error('[FloatingPlayerClass:requireDomNode]', error.message, {\n        error,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw error;\n    }\n    return this.domNode;\n  }\n\n  requireActivePlayerData() {\n    // TODO: Ensure data?\n    if (!this.activePlayerData) {\n      const error = new Error('No active player data set');\n      // eslint-disable-next-line no-console\n      console.error('[FloatingPlayerClass:requireActivePlayerData]', error.message, {\n        error,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw error;\n    }\n    return this.activePlayerData;\n  }\n\n  // Sync persistent data...\n\n  loadActivePlayerData() {\n    this.activePlayerData = loadActivePlayerData();\n  }\n\n  saveActivePlayerData() {\n    saveActivePlayerData(this.activePlayerData);\n  }\n\n  loadFloatingPlayerState() {\n    this.state = loadFloatingPlayerState();\n  }\n\n  saveFloatingPlayerState() {\n    saveFloatingPlayerState(this.state);\n  }\n\n  // Dom node...\n\n  showFloatingPlayer() {\n    this.state.visible = true;\n    this.updateStateInDom();\n    this.saveFloatingPlayerState();\n  }\n\n  hideFloatingPlayer() {\n    this.state.visible = false;\n    this.updateStateInDom();\n    this.saveFloatingPlayerState();\n  }\n\n  // Updaters...\n\n  updateActivePlayerDataInDom() {\n    const domNode = this.requireDomNode();\n    const activePlayerData = this.requireActivePlayerData();\n    const id = activePlayerData.id;\n    const titleNode = domNode.querySelector<HTMLElement>('.title');\n    const durationNode = domNode.querySelector<HTMLElement>('.duration');\n    const imageNode = domNode.querySelector<HTMLElement>('.image');\n    const { dataset } = domNode;\n    requestAnimationFrame(() => {\n      titleNode!.innerText = activePlayerData.title;\n      durationNode!.innerText = formatDuration(Math.floor(activePlayerData.duration * 1000));\n      imageNode!.style.backgroundImage = 'url(' + activePlayerData.imageUrl + ')';\n      if (activePlayerData.favorite) {\n        dataset.favorite = TRUE;\n      } else {\n        delete dataset.favorite;\n      }\n      const links = domNode.querySelectorAll<HTMLLinkElement>('.trackLink');\n      links.forEach((it) => {\n        it.setAttribute('href', `/tracks/${id}`);\n      });\n    });\n  }\n\n  updateStateInDom() {\n    const domNode = this.requireDomNode();\n    const { dataset } = domNode;\n    requestAnimationFrame(() => {\n      if (this.state.status) {\n        dataset.status = this.state.status;\n      } else {\n        delete dataset.status;\n      }\n      document.body.classList.toggle('with-player', !!this.state.visible);\n    });\n  }\n\n  updatePositionInDom() {\n    const domNode = this.requireDomNode();\n    const seekBarNode = domNode.querySelector<HTMLInputElement>('.seekBar');\n    const { dataset } = domNode;\n    requestAnimationFrame(() => {\n      dataset.position = floatToStr(this.state.position);\n      dataset.progress = floatToStr(this.state.progress);\n      domNode.style.setProperty('--progress', dataset.progress);\n      seekBarNode!.value = dataset.progress;\n    });\n  }\n\n  calculateProgress() {\n    const activePlayerData = this.requireActivePlayerData();\n    const { position = 0 } = this.state;\n    const { id, duration } = activePlayerData;\n    if (!duration) {\n      const error = new Error(`No duration provided for a track: ${id}`);\n      // eslint-disable-next-line no-console\n      console.error('[FloatingPlayerClass:calculateProgress]', error.message, {\n        error,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw error;\n    }\n    const ratio = position / duration;\n    const progress = Math.min(100, ratio * 100);\n    return progress;\n  }\n\n  updateTrackPosition() {\n    const domNode = this.requireDomNode();\n    const timeNode = domNode.querySelector<HTMLElement>('.time');\n    const activePlayerData = this.requireActivePlayerData();\n    const { position = 0 } = this.state;\n    const { id } = activePlayerData;\n    const progress = this.calculateProgress();\n    this.state.progress = progress;\n    this.updatePositionInDom();\n    if (timeNode) {\n      requestAnimationFrame(() => {\n        timeNode.innerText = formatDuration(Math.floor(position * 1000));\n      });\n    }\n    localTrackInfoDb.updatePosition(id, position);\n  }\n\n  updateAll() {\n    if (this.activePlayerData) {\n      this.updateTrackPosition();\n    }\n    this.updateStateInDom();\n    this.updatePositionInDom();\n    if (this.activePlayerData) {\n      this.updateActivePlayerDataInDom();\n    }\n  }\n\n  // Audio handlers...\n\n  handleAudioTimeUpdate(ev: Event) {\n    if (this.seeking) {\n      return;\n    }\n    const currAudio = this.audio;\n    const audio = ev.currentTarget as HTMLAudioElement;\n    if (audio !== currAudio) {\n      return;\n    }\n    const activePlayerData = this.requireActivePlayerData();\n    const {\n      currentTime,\n      // readyState, // DEBUG\n    } = audio;\n    /* // DEBUG\n     * const source = audio.getElementsByTagName('SOURCE')[0] as HTMLSourceElement;\n     * console.log('[FloatingPlayerClass:handleAudioTimeUpdate]', {\n     *   currentTime,\n     *   readyState,\n     *   id: activePlayerData.id,\n     *   activePlayerData,\n     *   src: source.src,\n     *   source,\n     *   thisAudio: currAudio === audio,\n     *   currAudio,\n     *   audio,\n     * });\n     */\n    // TODO: Check loaded status?\n    if (this.state.position != currentTime) {\n      this.state.position = currentTime;\n      this.updateTrackPosition();\n      this.saveFloatingPlayerState();\n      this.callbacks.invokeUpdate({ floatingPlayerState: this.state, activePlayerData });\n      localTrackInfoDb.updatePosition(activePlayerData.id, currentTime);\n    }\n  }\n\n  handleAudioCanPlay(_ev: Event) {\n    if (!this.state.loaded) {\n      this.state.loaded = true;\n      delete this.state.error;\n    }\n  }\n\n  handleAudioPlay(_ev: Event) {\n    const activePlayerData = this.requireActivePlayerData();\n    this.state.status = 'playing';\n    this.updateStateInDom();\n    this.saveFloatingPlayerState();\n    this.callbacks.invokePlayStart({\n      floatingPlayerState: this.state,\n      activePlayerData,\n    });\n  }\n\n  handleAudioEnded(_ev: Event) {\n    const activePlayerData = this.requireActivePlayerData();\n    this.incrementPlayedCount();\n    this.state.status = 'paused'; // stopped, ready?\n    this.updateStateInDom();\n    this.saveFloatingPlayerState();\n    this.callbacks.invokePlayStop({\n      floatingPlayerState: this.state,\n      activePlayerData,\n    });\n  }\n\n  handleError(err: Error | string) {\n    const errName = err instanceof Error && err.name;\n    // eslint-disable-next-line no-console\n    console.error('[FloatingPlayerClass:handleError]', {\n      err,\n    });\n    if (errName === 'AbortError') {\n      // NOTE: Do nothing on abort\n      return;\n    }\n    debugger; // eslint-disable-line no-debugger\n    this.state.error = getErrorText(err);\n    this.updateStateInDom();\n    commonNotify.showError(err);\n    this.callbacks.invokeError(err);\n  }\n\n  handleAudioSourceError(ev: Event) {\n    const srcElement = ev.currentTarget as HTMLSourceElement;\n    const { src, type } = srcElement;\n    const errMsg = getJsText('errorLoadingAudioFile') + ' ' + src + (type ? `( ${type})` : '');\n    const error = new Error(errMsg);\n    this.handleError(error);\n  }\n\n  /// Active player data\n\n  getActiveTrackId(): number | undefined {\n    return this.activePlayerData ? this.activePlayerData.id : undefined;\n  }\n\n  // Core handlers...\n\n  loadAudio() {\n    const activePlayerData = this.requireActivePlayerData();\n    this.state.loaded = false;\n    const source = this.hiddenPlayer.createHiddenPlayerSource({ src: activePlayerData.mediaUrl });\n    source.addEventListener('error', this.handleAudioSourceError.bind(this));\n  }\n\n  isAudioPlaying() {\n    const audio = this.audio;\n    return (\n      !!audio && audio.currentTime > 0 && !audio.paused && !audio.ended && audio.readyState > 2\n    );\n  }\n\n  isPlaying() {\n    return this.state.status === 'playing';\n  }\n\n  pauseCurrentPlayer() {\n    if (this.isAudioPlaying()) {\n      const audio = this.requireAudio();\n      audio.pause();\n    }\n    if (this.isPlaying()) {\n      this.state.status = 'paused';\n      this.updateStateInDom();\n      this.saveFloatingPlayerState();\n    }\n  }\n\n  playCurrentPlayer() {\n    const audio = this.requireAudio();\n    const activePlayerData = this.requireActivePlayerData();\n    if (this.isAudioPlaying()) {\n      return;\n    }\n    if (\n      audio.ended ||\n      (this.state.position && this.state.position > activePlayerData.duration - 0.1)\n    ) {\n      // Start from the begining\n      this.state.position = 0;\n      audio.load();\n    }\n    this.updateTrackPosition();\n    this.callbacks.invokeUpdate({\n      floatingPlayerState: this.state,\n      activePlayerData,\n    });\n\n    audio.currentTime = this.state.position || 0;\n    const result = audio.play();\n    result.catch((err) => {\n      if (err.name === 'NotAllowedError') {\n        //  play() failed because the user didn't interact with the document first. -> Just cancel\n        this.state.status = undefined;\n        this.updateStateInDom();\n      } else {\n        this.handleError(err);\n      }\n    });\n  }\n\n  /** Play button click handler */\n  trackPlayHandler(_ev: MouseEvent) {\n    const isPlaying = this.isPlaying();\n    if (isPlaying) {\n      this.pauseCurrentPlayer();\n    } else {\n      this.playCurrentPlayer();\n    }\n  }\n\n  // Active player track data...\n\n  ensureAudioLoaded() {\n    if (!this.state.loaded || !this.hasAudio() || !this.hasAudioSource) {\n      this.loadAudio();\n    }\n  }\n\n  setActivePlayerData(activePlayerData: ActivePlayerData, position?: number) {\n    if (this.activePlayerData?.id !== activePlayerData.id) {\n      if (this.activePlayerData && this.isPlaying()) {\n        this.pauseCurrentPlayer();\n      }\n      this.state.loaded = false;\n      if (position != null) {\n        this.state.position = position;\n      }\n      this.removeAudio();\n      this.activePlayerData = activePlayerData;\n    }\n    this.saveActivePlayerData();\n    this.updateActivePlayerDataInDom();\n    this.ensureAudioLoaded();\n  }\n\n  setActiveTrack(trackNode: HTMLElement, position?: number) {\n    const activePlayerData = getActivePlayerDataFromTrackNode(trackNode);\n    this.setActivePlayerData(activePlayerData, position);\n  }\n\n  clearActiveData() {\n    this.activePlayerData = undefined;\n    this.hideFloatingPlayer();\n    this.removeAudio();\n  }\n\n  // Update related data\n\n  sendIncrementPlayedCount(id: number) {\n    const url = `/api/v1/tracks/${id}/increment-played-count/`;\n    return sendApiRequest(url, 'POST');\n  }\n\n  incrementPlayedCount() {\n    const activePlayerData = this.requireActivePlayerData();\n    if (this.incrementing) {\n      return;\n    }\n    this.incrementing = true;\n    return this.sendIncrementPlayedCount(activePlayerData.id)\n      .then(({ played_count }: { played_count?: number }) => {\n        if (played_count != null) {\n          // Re-update local data with server data...\n          this.callbacks.invokeIncrement({ count: played_count, activePlayerData });\n        }\n        // TODO: Update other instances of this track on the page (eg, in player, or in other track listings)?\n      })\n      .catch((err) => {\n        // eslint-disable-next-line no-console\n        console.error('[FloatingPlayerClass:incrementPlayedCount:sendIncrementPlayedCount] error', {\n          err,\n        });\n        debugger; // eslint-disable-line no-debugger\n        commonNotify.showError(err);\n        // Increment locally (?)\n        this.callbacks.invokeIncrement({ activePlayerData });\n        throw err;\n      })\n      .finally(() => {\n        this.incrementing = false;\n      });\n  }\n\n  sendToggleFavoriteRequest(id: number, value: boolean) {\n    const url = `/api/v1/tracks/${id}/toggle-favorite/`;\n    return sendApiRequest(url, 'POST', { value });\n  }\n\n  toggleFavorite() {\n    const activePlayerData = this.requireActivePlayerData();\n    const id = activePlayerData.id;\n    this.toggleFavoriteById(id);\n  }\n\n  toggleFavoriteById(id: number) {\n    if (this.toggling[id]) {\n      return;\n    }\n    const activePlayerData = this.activePlayerData;\n    const isCurrent = id === activePlayerData?.id;\n    const trackInfo = localTrackInfoDb.getById(id);\n    const favorite = !trackInfo?.favorite;\n    localTrackInfoDb.updateFavorite(id, favorite);\n    if (isCurrent) {\n      activePlayerData.favorite = favorite;\n      this.updateActivePlayerDataInDom();\n      this.saveActivePlayerData();\n    }\n    this.callbacks.invokeFavorite({ id, favorite });\n    if (window.isAuthenticated) {\n      this.toggling[id] = true;\n      this.sendToggleFavoriteRequest(id, favorite)\n        .then((results: { favorite_track_ids: number[] }) => {\n          const { favorite_track_ids } = results;\n          localTrackInfoDb.updateFavoritesByTrackIds(favorite_track_ids);\n          this.callbacks.invokeFavorites({\n            favorites: favorite_track_ids,\n          });\n          const msgId = favorite ? 'trackAddedToFavorites' : 'trackRemovedFromFavorites';\n          commonNotify.showSuccess(getJsText(msgId));\n        })\n        .catch((err) => {\n          // eslint-disable-next-line no-console\n          console.error('[FloatingPlayerClass:toggleFavoriteById] error', {\n            err,\n          });\n          debugger; // eslint-disable-line no-debugger\n          commonNotify.showError(err);\n        })\n        .finally(() => {\n          this.toggling[id] = false;\n        });\n    }\n  }\n\n  seekPosition(position: number) {\n    this.seeking = true;\n    const audio = this.requireAudio();\n    audio.currentTime = position || 0;\n    this.state.position = position;\n    this.updateTrackPosition();\n    this.saveFloatingPlayerState();\n    const activePlayerData = this.requireActivePlayerData();\n    this.callbacks.invokeUpdate({ floatingPlayerState: this.state, activePlayerData });\n    setTimeout(() => {\n      this.seeking = false;\n    }, 150);\n  }\n\n  seekRewind() {\n    const position = Math.max(0, (this.state.position || 0) - seekTimeSec);\n    this.seekPosition(position);\n  }\n\n  seekForward() {\n    const activePlayerData = this.requireActivePlayerData();\n    const { duration } = activePlayerData;\n    const position = Math.min(duration, (this.state.position || 0) + seekTimeSec);\n    this.seekPosition(position);\n  }\n\n  seekBarHandle(ev: Event) {\n    const activePlayerData = this.requireActivePlayerData();\n    const { duration } = activePlayerData;\n    if (!duration) {\n      return;\n    }\n    const node = ev.currentTarget as HTMLInputElement;\n    const value = Number(node.value);\n    const position = (value * duration) / 100;\n    this.seekPosition(position);\n    if (!this.isPlaying()) {\n      this.playCurrentPlayer();\n    }\n  }\n\n  // Initilization...\n\n  initDomNode() {\n    const domNode = this.requireDomNode();\n    const seekBarNode = domNode.querySelector<HTMLInputElement>('.seekBar');\n    if (seekBarNode) {\n      seekBarNode.addEventListener('input', this.seekBarHandle.bind(this));\n    }\n    const hideButton = domNode.querySelector<HTMLButtonElement>('.track-control-hide');\n    if (hideButton) {\n      hideButton.addEventListener('click', this.hideFloatingPlayer.bind(this));\n    }\n    const controls = domNode.querySelectorAll<HTMLButtonElement>('.track-control');\n    controls.forEach((node) => {\n      const { dataset } = node;\n      const { inited, controlId } = dataset;\n      if (inited) {\n        return;\n      }\n      if (controlId === 'rewind') {\n        node.addEventListener('click', this.seekRewind.bind(this));\n      }\n      if (controlId === 'forward') {\n        node.addEventListener('click', this.seekForward.bind(this));\n      }\n      if (controlId === 'toggleFavorite') {\n        node.addEventListener('click', this.toggleFavorite.bind(this));\n      }\n      if (controlId === 'play') {\n        node.addEventListener('click', this.trackPlayHandler.bind(this));\n      }\n      dataset.inited = TRUE;\n    });\n    this.inited = true;\n  }\n}\n","import { ActivePlayerData } from './ActivePlayerData';\n\nexport function getActivePlayerDataFromTrackNode(trackNode: HTMLElement) {\n  const { dataset } = trackNode;\n  const id = Number(dataset.trackId);\n  const favorite = Boolean(dataset.favorite);\n  // const status = dataset.status;\n  const duration = parseFloat((dataset.trackDuration || '0').replace(',', '.'));\n  // const position = parseFloat((dataset.position || '0').replace(',', '.'));\n  const mediaUrl = dataset.trackMediaUrl || '';\n  const imageNode = trackNode.querySelector<HTMLImageElement>('img.card-img');\n  const imageUrl = imageNode?.getAttribute('src') || '';\n  const title = dataset.trackTitle || '';\n  const activePlayerData: ActivePlayerData = {\n    id,\n    title,\n    imageUrl,\n    mediaUrl,\n    duration,\n    favorite,\n  };\n  return activePlayerData;\n}\n","import { FloatingPlayer } from './FloatingPlayerClass';\n\n// Singleton\nexport const floatingPlayer = new FloatingPlayer();\n\nexport function initFloatingPlayer() {\n  // console.log('[floatingPlayer:initFloatingPlayer]');\n}\n","/**\n * @desc Main entry point module (scripts)\n * @module src/assets/index.ts\n * @changed 2025.02.17, 00:17\n */\n\nimport { checkProjectVersion } from './checkProjectVersion';\nimport { initTracksPlayerWrapper } from './track-blocks/tracksPlayer';\nimport { initFloatingPlayer } from './entities/FloatingPlayer/floatingPlayer';\n\ncheckProjectVersion();\n\ninitTracksPlayerWrapper();\ninitFloatingPlayer();\n"],"names":["getMinorVersionFromProjectInfo","info","match","_e","getErrorText","error","Array","isArray","map","this","bind","join","Error","message","String","quoteHtmlAttr","str","preserveCR","crValue","replace","formatDuration","time","sec","min","hrs","items","Math","floor","val","idx","padStart","shift","filter","Boolean","floatToStr","num","isNaN","Number","toFixed","localTrackInfoDb","updatePlayedCount","id","playedCount","now","_now","Date","trackInfo","getOrCreate","undefined","lastPlayed","lastUpdated","insert","err","console","updatePosition","position","updateFavorite","favorite","_toggleInFavoritesIndex","updateFavoritesByTrackIds","ids","_getIndex","forEach","isFavorite","includes","_setFavoritesIndex","save","createNewRecord","getById","window","localStorage","setItem","round","trackInfoToJsonStr","_addToIndex","getFavorites","getAll","it","getItem","list","split","warn","trackInfoFromJsonStr","_getFavoritesIndex","data","JSON","parse","_","favoritesIndex","stringify","_addToFavoritesIndex","push","_removeFromFavoritesIndex","checkId","value","v","_setIndex","index","_removeFromIndex","_toggleInIndex","delete","removeItem","clearAll","getJsText","textNode","document","body","querySelector","innerHTML","trim","icons","success","commonNotify","timeoutDelay","inited","removeNotify","notifyData","node","handler","classList","remove","clearTimeout","setTimeout","notifyRoot","removeChild","showNotify","mode","text","content","ensureInit","createElement","add","nodeIcon","appendChild","nodeText","requestAnimationFrame","removeNotifyHandler","addEventListener","showInfo","showSuccess","showWarn","showError","showDemo","init","createDomNode","rootNode","setAttribute","storageActivePlayerDataId","saveActivePlayerData","convertActivePlayerDataToJsonStr","loadActivePlayerData","raw","title","imageUrl","mediaUrl","duration","convertActivePlayerDataFromJsonStr","sendApiRequest","url","method","requestData","headers","Accept","cookieId","cookiesList","cookie","i","length","s","decodeURIComponent","getCookie","fetch","credentials","then","res","ok","status","statusText","json","errMsg","detail","catch","storageFloatingPlayerStateId","saveFloatingPlayerState","lastTimestamp","visible","progress","convertFloatingPlayerStateToJsonStr","loadFloatingPlayerState","convertFloatingPlayerStateFromJsonStr","allPlayers","domNode","setParentDomNode","parentDomNode","requireParentDomNode","ensureHiddenPlayer","hiddenPlayerNode","audio","hasAudio","audioNode","hasSource","sourceNode","ensureHiddenPlayerAudio","createHiddenPlayerSource","opts","removeHiddenPlayerSource","type","src","removeHiddenPlayerAudio","pause","from","getElementsByTagName","onPlayStartCallbacks","onPlayStopCallbacks","onUpdateCallbacks","onIncrementCallbacks","onFavoritesCallbacks","onFavoriteCallbacks","onErrorCallbacks","addPlayStartCallback","cb","addPlayStopCallback","addUpdateCallback","addIncrementCallback","addFavoriteCallback","addFavoritesCallback","addErrorCallback","invokePlayStart","activePlayerData","invokePlayStop","invokeUpdate","invokeIncrement","invokeFavorite","invokeFavorites","invokeError","TRUE","callbacks","FloatingPlayerCallbacks","hiddenPlayer","HiddenPlayer","state","toggling","seeking","initDomNode","updateAll","ensureAudioLoaded","playCurrentPlayer","requireAudio","handleAudioCanPlay","handleAudioPlay","handleAudioTimeUpdate","handleAudioEnded","removeAudio","hasAudioSource","requireDomNode","requireActivePlayerData","showFloatingPlayer","updateStateInDom","hideFloatingPlayer","updateActivePlayerDataInDom","titleNode","durationNode","imageNode","dataset","innerText","style","backgroundImage","querySelectorAll","toggle","updatePositionInDom","seekBarNode","setProperty","calculateProgress","ratio","updateTrackPosition","timeNode","ev","currAudio","currentTarget","currentTime","floatingPlayerState","_ev","loaded","incrementPlayedCount","handleError","errName","name","handleAudioSourceError","srcElement","getActiveTrackId","loadAudio","isAudioPlaying","paused","ended","readyState","isPlaying","pauseCurrentPlayer","load","play","trackPlayHandler","setActivePlayerData","setActiveTrack","trackNode","trackId","parseFloat","trackDuration","trackMediaUrl","getAttribute","trackTitle","getActivePlayerDataFromTrackNode","clearActiveData","sendIncrementPlayedCount","incrementing","played_count","count","finally","sendToggleFavoriteRequest","toggleFavorite","toggleFavoriteById","isCurrent","isAuthenticated","results","favorite_track_ids","favorites","msgId","seekPosition","seekRewind","max","seekForward","seekBarHandle","hideButton","controlId","floatingPlayer","FloatingPlayer","currentTrackPlayer","floatingPlayerUpdate","getTrackNode","timeFormatted","floatingPlayerPlay","floatingPlayerStop","find","updateIncrementCallback","updatedPlayedCount","strValue","valueNode","closest","updateTrackPlayedCount","stopPreviousPlayer","playingId","isFloatingPlaying","contains","updateTrackFavorite","isCurrentFavorite","updateSingleFavoriteCallback","updateFavoritesCallback","initTrackPlayerNode","hasServerData","calculateAndUpdateTrackPosition","oldInfo","newInfo","projectInfo","oldVersion","newVersion","checkProjectVersion"],"sourceRoot":""}