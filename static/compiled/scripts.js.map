{"version":3,"file":"scripts.js","mappings":"mBA6BO,SAASA,EAAaC,GAC3B,GAAKA,EAGL,OAAIC,MAAMC,QAAQF,GACTA,EAAMG,IAAIC,KAAKL,aAAaM,KAAKD,OAAOE,KAAK,OAElDN,aAAiBO,MACnBP,EAAQA,EAAMQ,QACY,iBAAVR,IAEhBA,EAAQS,OAAOT,IAEVA,EACT,CAMO,SAASU,EAAcC,EAAKC,GACjC,MAAMC,EAAUD,EAAa,QAAU,KACvC,OACEH,OAAOE,GACJG,QAAQ,KAAM,SACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,UACdA,QAAQ,KAAM,QACdA,QAAQ,KAAM,QAIdA,QAAQ,QAASD,GACjBC,QAAQ,UAAWD,EAE1B,CC1DA,IAAME,EAA+B,CACnCC,QAAS,WACThB,MAAO,+BACPiB,KAAM,eACNC,KAAM,cA6JKC,EAAe,IAlJ5B,wBACE,KAAAC,gBAA6BC,EAE7B,KAAAC,aAAe,IAEf,KAAAC,QAAS,CA0IX,QAtIE,YAAAC,aAAA,SAAaC,GAAb,WACUC,EAAkBD,EAAU,KAAtBE,EAAYF,EAAU,QAEpCC,EAAKE,UAAUC,OAAO,UAClBF,IACFG,aAAaH,GACbF,EAAWE,aAAUN,GAEvBU,YAAW,WAET,IACE,EAAKX,WAAWY,YAAYN,EAC9B,CAAE,MACAO,GAGF,CACF,GAAG,IACL,EAMA,YAAAC,WAAA,SAAWC,EAAaC,GAAxB,IAOMC,EAPN,OACEjC,KAAKkC,aACAF,IAEHA,EAAOD,EACPA,EAAO,QAKPE,EAFED,aAAgB7B,MAER,EAA2B6B,GAE3B3B,OAAO2B,GAGnB,IAAMV,EAAOa,SAASC,cAAc,OACpCd,EAAKE,UAAUa,IAAI,UACnBf,EAAKE,UAAUa,IAAI,UAAYN,GAE/B,IAAMO,EAAWH,SAASC,cAAc,QACxCE,EAASd,UAAUa,IAAI,QACvBC,EAASd,UAAUa,IA9DK,MA+DxBC,EAASd,UAAUa,IAAI1B,EAAMoB,IAC7BT,EAAKiB,YAAYD,GAEjB,IAAME,EAAWL,SAASC,cAAc,OACxCI,EAAShB,UAAUa,IAAI,QACvBG,EAASC,UAAYR,EACrBX,EAAKiB,YAAYC,GACjBxC,KAAKgB,WAAWuB,YAAYjB,GAE5BoB,OAAOC,uBAAsB,WAC3BhB,YAAW,WACTL,EAAKE,UAAUa,IAAI,SACrB,GAAG,GACL,IAGA,IAAMhB,EAA0B,CAAEC,KAAI,EAAEC,aAASN,GAC3C2B,EAAsB5C,KAAKoB,aAAanB,KAAKD,KAAMqB,GACzDA,EAAWE,QAAUI,WAAWiB,EAAqB5C,KAAKkB,cAE1DI,EAAKuB,iBAAiB,cAAc,WAElCnB,aAAaL,EAAWE,QAC1B,IACAD,EAAKuB,iBAAiB,cAAc,WAElCxB,EAAWE,QAAUI,WAAWiB,EAAqB,EAAK1B,aAC5D,IAEAI,EAAKuB,iBAAiB,QAASD,EACjC,EAKA,YAAAE,SAAA,SAASd,GACPhC,KAAK8B,WAAW,OAAQE,EAC1B,EAGA,YAAAe,YAAA,SAAYf,GACVhC,KAAK8B,WAAW,UAAWE,EAC7B,EAGA,YAAAgB,SAAA,SAAShB,GACPhC,KAAK8B,WAAW,OAAQE,EAC1B,EAGA,YAAAiB,UAAA,SAAUjB,GACRhC,KAAK8B,WAAW,QAASE,EAC3B,EAIA,YAAAkB,SAAA,WAEElD,KAAK8C,SAAS,QACd9C,KAAK+C,YAAY,WACjB/C,KAAKgD,SAAS,QACdhD,KAAKiD,UAAU,QACjB,EAKA,YAAAf,WAAA,WACElC,KAAKmD,MACP,EAEA,YAAAC,cAAA,WAEE,IAAMC,EAAWlB,SAASmB,KACpBtC,EAAamB,SAASC,cAAc,OAC1CpB,EAAWQ,UAAUa,IAAI,eACzBrB,EAAWuC,aAAa,KAAM,eAC9BF,EAASd,YAAYvB,GACrBhB,KAAKgB,WAAaA,CACpB,EAGA,YAAAmC,KAAA,WACOnD,KAAKmB,SACRnB,KAAKoD,gBACLpD,KAAKmB,QAAS,EAElB,EACF,EA/IA,ICnBO,SAASqC,EAAUC,GACxB,IAAMC,EAAWvB,SAASmB,KAAKK,cAAc,cAAgBF,GAM7D,OALKC,GAEHE,QAAQ/C,KAAK,gDAAiD4C,GAGzDnD,GADMoD,aAAQ,EAARA,EAAUjB,YAAagB,GACTI,MAC7B,C,+6CCNO,SAASC,EACdC,EACAC,EACAC,GAHF,gBAEE,IAAAD,IAAAA,EAAA,YACA,IAAAC,IAAAA,OAAA,GAEA,IAGMC,EAAU,CACdC,OAAQ,mBACR,eAAgB,mBAChB,cHmaG,SAAmBC,GACxB,MACMC,EADalC,SAASmC,OACGC,MAAM,KACrC,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAYI,OAAQD,IAAK,CAC3C,MAAME,EAAIL,EAAYG,IACff,EAAIkB,GAAOD,EAAEb,OAAOU,MAAM,KAAKxE,IAAI6E,oBAC1C,GAAInB,IAAOW,EACT,OAAOO,CAEX,CAEF,CGpboBE,CAAU,cAmB5B,OAAOC,MAAMf,EAAK,CAChBC,OAAM,EACNE,QAAO,EACPa,YAAa,UACbzB,KAAMW,GAAee,KAAKC,UAAUhB,KAEnCiB,MAAK,SAAOC,GAAG,qC,gEACNC,EAA2BD,EAAG,GAA1BE,EAAuBF,EAAG,OAAlBG,EAAeH,EAAG,W,iBAI7B,O,sBAAA,GAAMA,EAAII,Q,cAAjBC,EAAO,S,0CAMT,IAAKJ,GAAiB,MAAXC,EAAgB,CACnBI,EAAS,CAACjC,EAAU,cAAgB,IAAM6B,GAAQG,aAAI,EAAJA,EAAME,SAAUJ,GACrEK,OAAOC,SACP1F,KAAK,MAER0D,QAAQhE,MAAM,mBAAoB6F,EAAQ,CACxCL,GAAE,EACFI,KAAI,EACJF,WAAU,EACVD,OAAM,EACNF,IAAG,EACHpB,IAAG,EACHE,YAAW,EACXD,OAAM,EACNE,QAAO,IAET,SACA,MAAM,IAAI/D,MAAMsF,EAClB,CASA,MAAO,CAAP,EAAOD,G,UAERK,OAAM,SAACC,GACN,IAAML,EAAS,CAACjC,EAAU,oBAAqB,EAA2BsC,IACvEH,OAAOC,SACP1F,KAAK,MAER0D,QAAQhE,MAAM,mBAAoB6F,EAAQ,CACxCK,IAAG,EACH/B,IAAG,EACHE,YAAW,EACXD,OAAM,EACNE,QAAO,IAET,SACA,MAAM,IAAI/D,MAAMsF,EAClB,GACJ,CCpFA,IAAMM,EAAwB5D,SAASmB,KAEnC0C,OAA4C/E,EAC5CgF,OAA8ChF,EAQ5CiF,EAAO,OAcb,SAASC,IACP,IAAMC,EAbR,WACE,IAAKJ,EAAkB,EACrBA,EAAmB7D,SAASC,cAAc,QACzBZ,UAAUa,IAAI,iBAC/B,IAAMgE,EAAQlE,SAASC,cAAc,SACrCiE,EAAMxD,iBAAiB,aAAcyD,GACrCN,EAAiBzD,YAAY8D,GAC7BN,EAAsBxD,YAAYyD,EACpC,CACA,OAAOA,CACT,CAGuBO,GACfF,EAAQD,EAAaI,qBAAqB,SAAS,GACzD,IAAKH,EACH,MAAM,IAAIlG,MAAMqD,EAAU,qBAE5B,OAAO6C,CACT,CAyBA,SAASI,EAAkBC,GACXP,IAERQ,YAAc,EAEpB,IAAMC,EAAUX,aAAkB,EAAlBA,EAAoBW,QAChCA,WACKA,EAAQvB,cACRuB,EAAQC,OAEnB,CAEA,SAASC,EAAuBC,GAC9B,IAAMC,EAAWf,aAAkB,EAAlBA,EAAoBtC,cAAc,SAE3CgD,EADMI,EAAGE,cACY,YAC7B,GAAID,EAAU,CACZ,IACME,EJsSH,SAAwBC,GAC7B,MAAMC,EAAMD,EAAO,IACbE,EAAMD,EAAM,GACZE,EAAMD,EAAM,GASZE,EAPW,CADJD,EAAM,GAIjBA,EAAM,GACND,EAAM,GACND,EAAM,IAEerH,IAAIyH,KAAKC,OAAO1H,KAAI,CAAC4E,EAAK+C,KAE/C,KAAIA,EAAM,IAAM/C,EAIhB,OAAI+C,GAAO,EACFrH,OAAOsE,GAAKgD,SAAS,EAAG,KAG5BD,OAAL,EACSrH,OAAOsE,GAAO,GACvB,IAaF,MAAO,CADS4C,EAAMK,QAIpBL,EAAM5B,OAAOC,SAAS1F,KAAK,MAE1ByF,OAAOC,SACP1F,KAAK,IACV,CIlV8B2H,CADbL,KAAKC,MAAoB,IAAdd,IAExBK,EAASvE,UAAYyE,CACvB,CACF,CAEA,SAASY,EAAiBpB,GACxB,IAyEMqB,EAzEAnB,EAAUX,aAAkB,EAAlBA,EAAoBW,QAChCA,IACFA,EAAQvB,OAAS,UACZuB,EAAQC,SACXD,EAAQC,OAASX,EAqEf6B,EAAc9B,EARtB,WACU,IAAAW,EAAYX,EAAkB,QAC9B+B,EAAYpB,EAAO,QAE3B,OAAO9C,EADK,yBAAkBkE,EAAO,4BACV,OAC7B,CAIEC,GACG/C,MAAK,SAAC,G,IAAEgD,EAAY,eAEbC,EAAYJ,EAAYpE,cAAc,iBAE5C,GAAoB,MAAhBuE,GAAwBC,EAAW,CACrCA,EAAUC,UAAY9H,EAAcD,OAAO6H,IAC3C,IAAM,EAASC,EAAUE,QAAQ,0CAC7B,IACF,EAAOzB,QAAQ0B,YAAcjI,OAAO6H,GAExC,CAEF,IACCrC,OAAM,SAACC,GAENlC,QAAQhE,MAAM,qEAAsE,CAClFkG,IAAG,IAEL,SAEA,MADA/E,EAAakC,UAAU6C,GACjBA,CACR,KAxFJ,CAEA,SAASQ,EAAmBI,GAC1B,IAAML,EAAQF,IACRS,EAAUX,aAAkB,EAAlBA,EAAoBW,QAChCA,IACFA,EAAQ2B,OAASrC,SACVU,EAAQhH,OAEjByG,EAAMmC,MACR,CAEA,SAASC,EAAkB1B,GACzB,IAAM2B,EAAa3B,EAAGE,cACd0B,EAAcD,EAAU,IAAnBE,EAASF,EAAU,KAC1BjD,EAASjC,EAAU,yBAA2B,IAAMmF,EACpD/I,EAAQ,IAAIO,MAAMsF,GAExB7B,QAAQhE,MAAM,sBAAuB6F,EAAQ,CAC3C7F,MAAK,EACLqG,mBAAkB,EAClB0C,IAAG,EACHC,KAAI,EACJ7B,GAAE,IAEJ,SAEAhG,EAAakC,UAAUwC,GACvB,IAAMmB,EAAUX,aAAkB,EAAlBA,EAAoBW,QAChCA,IACFA,EAAQhH,MAAQ6F,SACTmB,EAAQ2B,cACR3B,EAAQvB,OAEnB,CAyDA,SAASwD,IACP,IACQjC,EADYX,EACW,QACzB6C,IAAalC,EAAQ2B,OACrBlC,EAAQF,IACd,GAAK2C,EAWHlC,EAAQvB,OAAS,UACjBgB,EAAMmC,WAZO,CACb5B,EAAQvB,OAAS,iBACVuB,EAAQ2B,cACR3B,EAAQhH,MACP,IACFmJ,EA5JV,SAAkCC,QAAA,IAAAA,IAAAA,EAAA,IAIhC,IAFA,IAAM3C,EAAQF,IAEK,MADCtG,MAAMoJ,KAAK5C,EAAMG,qBAAqB,WACvC,eAAJ,KACR/E,SAEP4E,EAAM9C,aAAa,UAAW,QAC9B,IAAMwF,EAAS5G,SAASC,cAAc,UAYtC,OAXA2G,EAAOxF,aAAa,OAAQyF,EAAKJ,MAAQ,cACrCI,EAAKL,KACPI,EAAOxF,aAAa,MAAOyF,EAAKL,KAGlCtC,EAAMxD,iBAAiB,aAAcyD,GACrCD,EAAMxD,iBAAiB,UAAWiF,GAClCzB,EAAMxD,iBAAiB,aAAciE,GACrCT,EAAMxD,iBAAiB,QAAS4D,GAChCsC,EAAOlG,iBAAiB,QAAS4F,GACjCpC,EAAM9D,YAAYwG,GACXA,CACT,CAuImBG,CAAyB,CAAEP,IADhB/B,EAAO,gBAEjC,IAAKmC,EACH,MAAM,IAAI5I,MAAMqD,EAAU,2BAE5B6C,EAAM8C,MACR,CAIF,CAEA,SAASC,EAAiBrC,GACxB,IACMgB,EADchB,EAAGE,cACSoB,QAAQ,iBACpCpC,GAAsBA,IAAuB8B,GA3EnD,WACE,GAAI/B,EAAkB,CACpB,IAAMK,EAAQL,EAAiBQ,qBAAqB,SAAS,GACzDH,GAPR,SAAwBA,GACtB,QAASA,GAASA,EAAMM,YAAc,IAAMN,EAAMgD,SAAWhD,EAAMiD,OAASjD,EAAMkD,WAAa,CACjG,CAKiBC,CAAenD,KAC1BA,EAAMoD,QACNpD,EAAMM,YAAc,EAExB,CACA,GAAIV,EAAoB,CACd,IAAAW,EAAYX,EAAkB,eAC/BW,EAAQvB,cACRuB,EAAQ2B,cACR3B,EAAQhH,aACRgH,EAAQC,MACjB,CACF,CA6DI6C,GAEM,IAAA9C,EAAYmB,EAAW,QACzB4B,EAA+B,YAAnB/C,EAAQvB,OAEpBuE,IAD+B,YAAnBhD,EAAQvB,QACSsE,GAC7BtD,EAAQF,IACVwD,GAEFtD,EAAMoD,QACN7C,EAAQvB,OAAS,UACRuE,IACT3D,EAAqB8B,EACrBc,IAEJ,CAEA,SAASgB,EAAoBC,GACnB,IAAAlD,EAAYkD,EAAU,QAE5B3I,EAGEyF,EAAO,OADTmD,EACEnD,EAAO,eACPzF,GAAW4I,IAGKD,EAAWnG,cAAc,uBACjCd,iBAAiB,QAASuG,GACtCxC,EAAQzF,OAAS+E,EACnB,CC3OA,ID6OwC8D,EC7OlC,EAAO,OAOb,SAASC,EAAelD,GACtB,IAEQH,EAFKG,EAAGE,cACUoB,QAAQ,mBACF,QACxBL,EAAsBpB,EAAO,QAC/BsD,GADwBtD,EAAO,UATvC,SAAmCoB,EAA0BkC,GAE3D,OAAOpG,EADK,yBAAkBkE,EAAO,qBACV,OAAQ,CAAEkC,MAAK,GAC5C,EAQEC,CAA0BnC,EAASkC,GAChChF,MAAK,SAACkF,GAODF,GACFtD,EAAQyD,SAAW,EACnBtJ,EAAagC,YAAYS,EAAU,mCAE5BoD,EAAQyD,SACftJ,EAAagC,YAAYS,EAAU,8BAEvC,IACCqC,OAAM,SAACC,GAENlC,QAAQhE,MAAM,gEAAiE,CAC7EkG,IAAG,IAEL,SACA/E,EAAakC,UAAU6C,EACzB,GACJ,CAEA,SAASwE,EAAsBhJ,GACrB,IAAAsF,EAAYtF,EAAI,QAChBH,EAAsByF,EAAO,OAArB2D,EAAc3D,EAAO,UACjCzF,IAGc,mBAAdoJ,GACFjJ,EAAKuB,iBAAiB,QAASoH,GAEjCrD,EAAQzF,OAAS,EACnB,MD4LwC,IAAA6I,IAAAA,EAAuB7H,SAASmB,MACtD0G,EAAQQ,iBAAiB,uCACjCC,QAAQZ,GC5LX,SAAkCG,QAAA,IAAAA,IAAAA,EAAuB7H,SAASmB,MACvD0G,EAAQQ,iBACtB,kEAEMC,QAAQH,EAClB,CCnDAI,E","sources":["webpack://march-tales/./src/assets/helpers/CommonHelpers.js","webpack://march-tales/./src/assets/CommonNotify/CommonNotifySingleton.ts","webpack://march-tales/./src/assets/helpers/getJsText.ts","webpack://march-tales/./src/assets/helpers/sendApiRequest.ts","webpack://march-tales/./src/assets/track-blocks/tracksPlayer.ts","webpack://march-tales/./src/assets/track-blocks/trackControls.ts","webpack://march-tales/./src/assets/index.ts"],"sourcesContent":["// @ts-check\n\nexport function NOOP() {}\n\n/** Compare two arrays with scalar (number, string, boolean) values\n * @param {(number | string | boolean)[]} a1\n * @param {(number | string | boolean)[]} a2\n * @return {boolean}\n */\nexport function compareArrays(a1, a2) {\n  if (!a1 || !a1) {\n    return a1 === a2;\n  }\n  if (a1.length !== a2.length) {\n    return false;\n  }\n  // Compare all the items...\n  for (let i = 0; i < a1.length; i++) {\n    if (a1[i] !== a2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/** getErrorText - Return plain text for error.\n * @param {string|Error|string[]|Error[]} error - Error or errors list.\n * @return {string}\n */\nexport function getErrorText(error) {\n  if (!error) {\n    return;\n  }\n  if (Array.isArray(error)) {\n    return error.map(this.getErrorText.bind(this)).join('\\n');\n  }\n  if (error instanceof Error) {\n    error = error.message;\n  } else if (typeof error !== 'string') {\n    // TODO?\n    error = String(error);\n  }\n  return error;\n}\n\n/** quoteHtmlAttr -- quote all invalid characters for html\n * @param {string} str\n * @param {boolean} [preserveCR]\n */\nexport function quoteHtmlAttr(str, preserveCR) {\n  const crValue = preserveCR ? '&#13;' : '\\n';\n  return (\n    String(str) // Forces the conversion to string\n      .replace(/&/g, '&amp;') // This MUST be the 1st replacement\n      .replace(/'/g, '&apos;') // The 4 other predefined entities, required\n      .replace(/\"/g, '&quot;')\n      .replace(/</g, '&lt;')\n      .replace(/>/g, '&gt;')\n      // You may add other replacements here for HTML only (but it's not\n      // necessary). Or for XML, only if the named entities are defined in its\n      // DTD.\n      .replace(/\\r\\n/g, crValue) // Must be before the next replacement\n      .replace(/[\\r\\n]/g, crValue)\n  );\n}\n\n/** htmlToElement -- Create dom node instance from html string\n * @param {string} html - Html representing a single element\n * @return {HTMLElement}\n */\nexport function htmlToElement(html) {\n  const template = document.createElement('template');\n  if (Array.isArray(html)) {\n    html = html.join('');\n  }\n  html = html.trim(); // Never return a text node of whitespace as the result\n  template.innerHTML = html;\n  const content = template.content;\n  return /** @type HTMLElement */ (content.firstChild);\n}\n\n/** htmlToElements -- Convert text html representation to HTMLCollection object\n * @param {string|string[]} html\n * @return {HTMLCollection}\n */\nexport function htmlToElements(html) {\n  const template = document.createElement('template');\n  if (Array.isArray(html)) {\n    html = html.join('');\n  }\n  html = html.trim(); // Never return a text node of whitespace as the result\n  template.innerHTML = html;\n  const content = template.content;\n  return content.children;\n}\n\n/** updateNodeContent -- Replace all inner dom node content.\n * @param {Element} node\n * @param {THtmlContent} content\n */\nexport function updateNodeContent(node, content) {\n  if (!node) {\n    throw new Error('Undefined node to update content');\n  }\n  if (typeof content === 'string') {\n    // Replace with string content...\n    node.innerHTML = content;\n  } else if (Array.isArray(content)) {\n    // Replace multiple elements...\n    node.replaceChildren.apply(node, content);\n  } else {\n    // Replace single element...\n    node.replaceChildren(content);\n  }\n}\n\n/** decodeQuery\n * @param {string | string[]} qs\n * @param {string} [sep]\n * @param {string} [eq]\n * @param {any} [options]\n * @returns {{}}\n */\nexport function decodeQuery(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  /** @type {Record<string, unknown> | unknown[]} */\n  const obj = {};\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n  const regexp = /\\+/g;\n  qs = qs.split(sep);\n  let maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n  let len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n  for (let i = 0; i < len; ++i) {\n    const x = qs[i].replace(regexp, '%20'),\n      idx = x.indexOf(eq);\n    let kstr, vstr;\n    if (idx >= 0) {\n      kstr = x.substring(0, idx);\n      vstr = x.substring(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n    const k = decodeURIComponent(kstr);\n    const v = decodeURIComponent(vstr);\n    const it = obj[k];\n    if (!Object.prototype.hasOwnProperty.call(obj, k)) {\n      obj[k] = v;\n    } else if (Array.isArray(it)) {\n      it.push(v);\n    } else {\n      obj[k] = [it, v];\n    }\n  }\n  return obj;\n}\n\n/** parseQuery -- Parse url query string (in form `?xx=yy&...` or `xx=yy&...`)\n * @param {string} search  - Query string\n * @return {Record<string, string>} query - Query object\n */\nexport function parseQuery(search) {\n  if (!search) {\n    return {};\n  }\n  if (search.indexOf('?') === 0) {\n    search = search.substring(1);\n  }\n  return decodeQuery(search);\n}\n\n/** makeQuery\n * @param {Record<string, string | number | boolean> | {}} params\n * @param {{ addQuestionSymbol?: boolean; useEmptyStrings?: boolean; useUndefinedValues?: boolean }} opts\n * @returns {string}\n */\nexport function makeQuery(params, opts = {}) {\n  let url = Object.entries(params)\n    .map(([id, val]) => {\n      const valStr = String(val);\n      if (val == undefined && !opts.useUndefinedValues) {\n        return undefined;\n      }\n      if (valStr === '' && !opts.useEmptyStrings) {\n        return undefined;\n      }\n      return encodeURI(id) + '=' + encodeURI(String(val == undefined ? '' : val));\n    })\n    .filter(Boolean)\n    .join('&');\n  if (opts.addQuestionSymbol && url) {\n    url = '?' + url;\n  }\n  return url;\n}\n\n/** Dynamically load external script\n * @param {string} url\n * @return {Promise<Event>}\n */\nexport function addScript(url) {\n  return new Promise((resolve, reject) => {\n    // document.write('<script src=\"' + url + '\"></script>');\n    const script = document.createElement('script');\n    script.setAttribute('src', url);\n    script.addEventListener('load', resolve);\n    script.addEventListener('error', (event) => {\n      const {\n        target,\n        // srcElement,\n      } = event;\n      // @ts-ignore\n      const { href, baseURI } = target;\n      const error = new Error(`Cannot load script resurce by url '${url}'`);\n      // eslint-disable-next-line no-console\n      console.error('[CommonHelpers:addScript]', {\n        error,\n        url,\n        href,\n        baseURI,\n        target,\n        event,\n      });\n      // eslint-disable-next-line no-debugger\n      debugger;\n      reject(error);\n    });\n    document.head.appendChild(script);\n  });\n}\n\n/** Dynamically load external css\n * @param {string} url\n * @return {Promise<unknown>}\n */\nexport function addCssStyle(url) {\n  return new Promise((resolve, reject) => {\n    // Try to find exists node...\n    const testNode = document.head.querySelector(\n      'link[href=\"' + url + '\"], link[data-url=\"' + url + '\"]',\n    );\n    if (testNode) {\n      // Style already found!\n      return resolve({ type: 'already-loaded', target: testNode });\n    }\n    // reject(new Error('test')); // DEBUG: Test errors catching\n    const node = document.createElement('link');\n    node.setAttribute('href', url);\n    node.setAttribute('type', 'text/css');\n    node.setAttribute('rel', 'stylesheet');\n    node.setAttribute('data-url', url);\n    node.addEventListener('load', resolve);\n    node.addEventListener('error', (event) => {\n      const {\n        target,\n        // srcElement,\n      } = event;\n      // @ts-ignore\n      const { href, baseURI } = target;\n      const error = new Error(`Cannot load css resurce by url '${url}'`);\n      // eslint-disable-next-line no-console\n      console.error('[CommonHelpers:addCssStyle]', {\n        error,\n        url,\n        href,\n        baseURI,\n        target,\n        event,\n      });\n      // eslint-disable-next-line no-debugger\n      debugger;\n      reject(error);\n    });\n    document.head.appendChild(node);\n  });\n}\n\n/**\n * @param {HTMLSelectElement} node\n * @param {(string|number)[]} values\n */\nexport function setMultipleSelectValues(node, values) {\n  const strValues = values.map(String);\n  const options = Array.from(node.options);\n  options.forEach((item) => {\n    const { value, selected } = item;\n    const isSelected = strValues.includes(value);\n    if (isSelected !== selected) {\n      item.selected = isSelected;\n    }\n  });\n}\n\n/** processMultipleRequestErrors\n * @param {Response[]} resList\n * @return {Error[]}\n */\nexport function processMultipleRequestErrors(resList) {\n  return /** @type {Error[]} */ (\n    resList\n      .map((res) => {\n        if (!res.ok) {\n          return new Error(`Can't load url '${res.url}': ${res.statusText}, ${res.status}`);\n        }\n      })\n      .filter(Boolean)\n  );\n}\n\n/**\n * @param {number} n\n * @param {TNormalizedFloatStrOptions} [opts={}]\n * @returns {string}\n */\nexport function normalizedFloatStr(n, opts = {}) {\n  const {\n    // prettier-ignore\n    fixedPoint = 2,\n    stripFixedZeros = true,\n  } = opts;\n  let str = n.toFixed(fixedPoint);\n  if (stripFixedZeros) {\n    str = str.replace(/\\.*0+$/, '');\n  }\n  return str;\n}\n/**\n * @param {number} size\n * @param {TGetApproxSizeOptions} [opts={}]\n * @returns {[number | string, string]}\n */\nexport function getApproxSize(size, opts = {}) {\n  const { normalize } = opts;\n  const levels = [\n    'B', // Bytes\n    'K', // Kilobytes\n    'M', // Megabytes\n    'G', // Gigabites\n  ];\n  const lastLevel = levels.length - 1;\n  const range = 1024;\n  let level = 0;\n  while (level < lastLevel) {\n    if (size < range) {\n      break;\n    }\n    size /= range;\n    level++;\n  }\n  const currLevelStr = levels[level];\n  /** Result: final number or normalized representation (depends on option's `normalize`)\n   * @type {number | string}\n   */\n  let result = size;\n  if (normalize) {\n    const normalizeOpts = typeof normalize === 'object' ? normalize : undefined;\n    result = normalizedFloatStr(size, normalizeOpts);\n  }\n  return [result, currLevelStr];\n}\n\n/** @param {number} time - Time duration, ms\n * @return {string}\n */\nexport function formatDuration(time) {\n  const sec = time / 1000;\n  const min = sec / 60;\n  const hrs = min / 60;\n  const days = hrs / 24;\n  const srcItems = [\n    // prettier-ignore\n    days,\n    hrs % 24,\n    min % 60,\n    sec % 60,\n  ];\n  const items = srcItems.map(Math.floor).map((val, idx) => {\n    // Not mins and secs and empty...\n    if (idx < 2 && !val) {\n      return undefined;\n    }\n    // Hours, mins, secs...\n    if (idx >= 1) {\n      return String(val).padStart(2, '0');\n    }\n    // Days...\n    if (!idx) {\n      return String(val) + 'd';\n    }\n  });\n  /* console.log('[CommonHelpers:formatDuration]', {\n   *   sec,\n   *   min,\n   *   hrs,\n   *   days,\n   *   items,\n   *   srcItems,\n   *   time,\n   * });\n   */\n  const daysStr = items.shift();\n  return [\n    // prettier-ignore\n    daysStr,\n    items.filter(Boolean).join(':'),\n  ]\n    .filter(Boolean)\n    .join(' ');\n}\n\n/** @param {string} str */\nexport function getAsyncHash(str) {\n  const encoder = new TextEncoder();\n  const buf = encoder.encode(str);\n  return crypto.subtle.digest('SHA-256', buf).then((aryBuf) => {\n    const ary = new Uint8Array(aryBuf);\n    const res = Array.from(ary)\n      .map((x) => x.toString(16).padStart(2, '0'))\n      .join('');\n    return res;\n  });\n}\n\n/** @param {string} cookieId */\nexport function getCookie(cookieId) {\n  const cookiesStr = document.cookie;\n  const cookiesList = cookiesStr.split(';'); // .map((s) => s.trim().split('='));\n  for (let i = 0; i < cookiesList.length; i++) {\n    const s = cookiesList[i];\n    const [id, val] = s.trim().split('=').map(decodeURIComponent);\n    if (id === cookieId) {\n      return val;\n    }\n  }\n  return undefined;\n}\n\n/**\n * @param {string} id\n * @param {string} val\n * @param {number} maxAgeSecs -- Seconds of expire period\n */\nexport function setCookie(id, val, maxAgeSecs) {\n  const cookieVal = [id, val || ''].map(encodeURIComponent).join('=');\n  const parts = [\n    // prettier-ignore\n    cookieVal,\n  ];\n  if (maxAgeSecs) {\n    parts.push('max-age=' + maxAgeSecs);\n  }\n  const fullCookie = parts.filter(Boolean).join(';');\n  document.cookie = fullCookie;\n}\n","import * as CommonHelpers from '../helpers/CommonHelpers';\n\n/** Toast types */\ntype TMode = 'info' | 'error' | 'warn' | 'success';\n\n/** Icon shapes (move to constants?) */\nconst icons: Record<TMode, string> = {\n  success: 'bi-check',\n  error: 'bi-exclamation-triangle-fill',\n  warn: 'bi-bell-fill',\n  info: 'bi-info-lg',\n};\n\nconst iconClassNamePrefix = 'bi';\n\ninterface TNotifyData {\n  node: HTMLDivElement;\n  handler?: TSetTimeout;\n}\n\n// Define module...\nclass CommonNotify {\n  notifyRoot: HTMLDivElement = undefined;\n\n  timeoutDelay = 3000;\n\n  inited = false;\n\n  // Methods...\n\n  removeNotify(notifyData: TNotifyData) {\n    const { node, handler } = notifyData;\n    // Play animation...\n    node.classList.remove('active');\n    if (handler) {\n      clearTimeout(handler);\n      notifyData.handler = undefined;\n    }\n    setTimeout(() => {\n      // ...And remove node (TODO: Check if node still exists in dom tree)...\n      try {\n        this.notifyRoot.removeChild(node);\n      } catch (\n        _e // eslint-disable-line @typescript-eslint/no-unused-vars\n      ) {\n        // NOOP\n      }\n    }, 250); // Value of `var(--common-animation-time)`\n  }\n\n  /** showNotify\n   * @param {'info' | 'error' | 'warn' | 'success'} mode - Message type ('info' is default)\n   * @param {string|Error} text - Message content\n   */\n  showNotify(mode: TMode, text: string | Error) {\n    this.ensureInit();\n    if (!text) {\n      // If only one parameters passed assume it as message with default type\n      text = mode;\n      mode = 'info';\n    }\n    let content: string;\n    if (text instanceof Error) {\n      // Convert error object to the plain text...\n      content = CommonHelpers.getErrorText(text);\n    } else {\n      content = String(text);\n    }\n    // Create node...\n    const node = document.createElement('div');\n    node.classList.add('notify');\n    node.classList.add('notify-' + mode);\n    // Add icon...\n    const nodeIcon = document.createElement('span');\n    nodeIcon.classList.add('icon');\n    nodeIcon.classList.add(iconClassNamePrefix);\n    nodeIcon.classList.add(icons[mode]);\n    node.appendChild(nodeIcon);\n    // Add text...\n    const nodeText = document.createElement('div');\n    nodeText.classList.add('text');\n    nodeText.innerHTML = content;\n    node.appendChild(nodeText);\n    this.notifyRoot.appendChild(node);\n    // Play appearing animation...\n    window.requestAnimationFrame(() => {\n      setTimeout(() => {\n        node.classList.add('active');\n      }, 10);\n    });\n    // Remove node after delay...\n    /** @type {TNotifyData} */\n    const notifyData: TNotifyData = { node, handler: undefined };\n    const removeNotifyHandler = this.removeNotify.bind(this, notifyData);\n    notifyData.handler = setTimeout(removeNotifyHandler, this.timeoutDelay);\n    // Stop & restore timer on mouse in and out events...\n    node.addEventListener('mouseenter', () => {\n      // Clear timer...\n      clearTimeout(notifyData.handler);\n    });\n    node.addEventListener('mouseleave', () => {\n      // Resume timer...\n      notifyData.handler = setTimeout(removeNotifyHandler, this.timeoutDelay);\n    });\n    // Click handler...\n    node.addEventListener('click', removeNotifyHandler);\n  }\n\n  // Some shorthands...\n\n  /** @param {string|Error} text - Message content */\n  showInfo(text: string | Error) {\n    this.showNotify('info', text);\n  }\n\n  /** @param {string|Error} text - Message content */\n  showSuccess(text: string | Error) {\n    this.showNotify('success', text);\n  }\n\n  /** @param {string|Error} text - Message content */\n  showWarn(text: string | Error) {\n    this.showNotify('warn', text);\n  }\n\n  /** @param {string|Error} text - Message content */\n  showError(text: string | Error) {\n    this.showNotify('error', text);\n  }\n\n  // Demo...\n\n  showDemo() {\n    // DEBUG: Show sample notifiers...\n    this.showInfo('Info');\n    this.showSuccess('Success');\n    this.showWarn('Warn');\n    this.showError('Error');\n  }\n\n  // Initialization...\n\n  /** Ensure the modal has initiazlized */\n  ensureInit() {\n    this.init();\n  }\n\n  createDomNode() {\n    // TODO: To use bootstrap toasts?\n    const rootNode = document.body;\n    const notifyRoot = document.createElement('div');\n    notifyRoot.classList.add('notify-root');\n    notifyRoot.setAttribute('id', 'notify-root');\n    rootNode.appendChild(notifyRoot);\n    this.notifyRoot = notifyRoot;\n  }\n\n  /** Initialize nodule. */\n  init() {\n    if (!this.inited) {\n      this.createDomNode();\n      this.inited = true;\n    }\n  }\n}\n\n// Create and export singletone\nexport const commonNotify = new CommonNotify();\n\n// commonNotify.init();\n","import { quoteHtmlAttr } from '../helpers/CommonHelpers';\n\nexport function getJsText(id: string) {\n  const textNode = document.body.querySelector('#js-texts #' + id);\n  if (!textNode) {\n    // eslint-disable-next-line no-console\n    console.warn('[getJsText] Can not find js text node for id:', id);\n  }\n  const text = textNode?.innerHTML || id;\n  return quoteHtmlAttr(text).trim();\n}\n","import { getCookie } from '../helpers/CommonHelpers';\nimport * as CommonHelpers from '../helpers/CommonHelpers';\nimport { getJsText } from './getJsText';\n\nexport function sendApiRequest(\n  url: string,\n  method: string = 'GET',\n  requestData: unknown = undefined,\n) {\n  const csrftoken = getCookie('csrftoken');\n  // const sessionId = getCookie('sessionid');\n  // const url = `/api/v1/tracks/${trackId}/toggle-favorite/`;\n  const headers = {\n    Accept: 'application/json',\n    'Content-Type': 'application/json',\n    'X-CSRFToken': csrftoken,\n    // Credentials: 'include',\n    // Cookie: csrftoken && `csrftoken=${csrftoken}`,\n    // 'X-Session-Token': sessionId, // X-Session-Token\n    // 'Accept-Language': 'ru', // django_language=ru; content-language: ru;\n  };\n  /* console.log('[sendApiRequest] start', {\n   *   url,\n   *   method,\n   *   requestData,\n   *   headers,\n   * });\n   */\n  return fetch(url, {\n    method,\n    headers,\n    credentials: 'include',\n    body: requestData && JSON.stringify(requestData),\n  })\n    .then(async (res) => {\n      const { ok, status, statusText } = res;\n      // TODO: Check is it json?\n      let data: unknown & { detail?: string };\n      try {\n        data = await res.json();\n      } catch (\n        _e // eslint-disable-line @typescript-eslint/no-unused-vars\n      ) {\n        // NOOP\n      }\n      if (!ok || status !== 200) {\n        const errMsg = [getJsText('fetchError') + ' ' + status, data?.detail || statusText]\n          .filter(Boolean)\n          .join(': ');\n        // eslint-disable-next-line no-console\n        console.error('[sendApiRequest]', errMsg, {\n          ok,\n          data,\n          statusText,\n          status,\n          res,\n          url,\n          requestData,\n          method,\n          headers,\n        });\n        debugger; // eslint-disable-line no-debugger\n        throw new Error(errMsg);\n      }\n      /* console.log('[sendApiRequest] Got json', {\n       *   data,\n       *   url,\n       *   requestData,\n       *   method,\n       *   headers,\n       * });\n       */\n      return data as unknown;\n    })\n    .catch((err) => {\n      const errMsg = [getJsText('failedApiRequest'), CommonHelpers.getErrorText(err)]\n        .filter(Boolean)\n        .join(': ');\n      // eslint-disable-next-line no-console\n      console.error('[sendApiRequest]', errMsg, {\n        err,\n        url,\n        requestData,\n        method,\n        headers,\n      });\n      debugger; // eslint-disable-line no-debugger\n      throw new Error(errMsg);\n    });\n}\n","import { formatDuration, quoteHtmlAttr } from '../helpers/CommonHelpers';\nimport { commonNotify } from '../CommonNotify/CommonNotifySingleton';\nimport { sendApiRequest } from '../helpers/sendApiRequest';\nimport { getJsText } from '../helpers/getJsText';\n\nconst sharedPlayerContainer = document.body;\n\nlet sharedPlayerNode: HTMLElement | undefined = undefined;\nlet currentTrackPlayer: HTMLElement | undefined = undefined;\n\ninterface TSharedPlayerOptions {\n  type?: string;\n  src?: string;\n}\n\n// Values for dataset statuses\nconst TRUE = 'true';\n\nfunction ensureSharedPlayer(/* opts: TSharedPlayerOptions = {} */) {\n  if (!sharedPlayerNode) {\n    sharedPlayerNode = document.createElement('div');\n    sharedPlayerNode.classList.add('shared-player');\n    const audio = document.createElement('audio');\n    audio.addEventListener('loadeddata', sharedPlayerLoaded);\n    sharedPlayerNode.appendChild(audio);\n    sharedPlayerContainer.appendChild(sharedPlayerNode);\n  }\n  return sharedPlayerNode;\n}\n\nfunction ensureSharedPlayerAudio() {\n  const sharedPlayer = ensureSharedPlayer();\n  const audio = sharedPlayer.getElementsByTagName('audio')[0];\n  if (!audio) {\n    throw new Error(getJsText('noAudioNodeFound'));\n  }\n  return audio;\n}\n\nfunction createSharedPlayerSource(opts: TSharedPlayerOptions = {}) {\n  // const sharedPlayer = ensureSharedPlayer();\n  const audio = ensureSharedPlayerAudio();\n  const prevSources = Array.from(audio.getElementsByTagName('source'));\n  for (const node of prevSources) {\n    node.remove();\n  }\n  audio.setAttribute('preload', 'auto');\n  const source = document.createElement('source');\n  source.setAttribute('type', opts.type || 'audio/mpeg');\n  if (opts.src) {\n    source.setAttribute('src', opts.src);\n  }\n  // @see https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement/loadeddata_event\n  audio.addEventListener('loadeddata', sharedPlayerLoaded);\n  audio.addEventListener('playing', sharedPlayerPlay);\n  audio.addEventListener('timeupdate', sharedPlayerTimeUpdate);\n  audio.addEventListener('ended', sharedPlayerEnded);\n  source.addEventListener('error', sharedPlayerError);\n  audio.appendChild(source);\n  return source;\n}\n\nfunction sharedPlayerEnded(_ev: Event) {\n  const audio = ensureSharedPlayerAudio();\n  // Rewind for the next play\n  audio.currentTime = 0;\n  // Update status\n  const dataset = currentTrackPlayer?.dataset;\n  if (dataset) {\n    delete dataset.status;\n    delete dataset.played;\n  }\n}\n\nfunction sharedPlayerTimeUpdate(ev: Event) {\n  const timeNode = currentTrackPlayer?.querySelector('.time');\n  const audio = ev.currentTarget as HTMLAudioElement;\n  const { currentTime } = audio;\n  if (timeNode) {\n    const secs = Math.floor(currentTime * 1000);\n    const durationFormatted = formatDuration(secs);\n    timeNode.innerHTML = durationFormatted;\n  }\n}\n\nfunction sharedPlayerPlay(_ev: Event) {\n  const dataset = currentTrackPlayer?.dataset;\n  if (dataset) {\n    dataset.status = 'playing';\n    if (!dataset.played) {\n      dataset.played = TRUE;\n      incrementPlayedCount();\n    }\n  }\n}\n\nfunction sharedPlayerLoaded(_ev: Event) {\n  const audio = ensureSharedPlayerAudio();\n  const dataset = currentTrackPlayer?.dataset;\n  if (dataset) {\n    dataset.loaded = TRUE;\n    delete dataset.error;\n  }\n  audio.play();\n}\n\nfunction sharedPlayerError(ev: Event) {\n  const srcElement = ev.currentTarget as HTMLSourceElement;\n  const { src, type } = srcElement;\n  const errMsg = getJsText('errorLoadingAudioFile') + ' ' + src;\n  const error = new Error(errMsg);\n  // eslint-disable-next-line no-console\n  console.error('[sharedPlayerError]', errMsg, {\n    error,\n    currentTrackPlayer,\n    src,\n    type,\n    ev,\n  });\n  debugger; // eslint-disable-line no-debugger\n  // TODO: Show toast\n  commonNotify.showError(errMsg);\n  const dataset = currentTrackPlayer?.dataset;\n  if (dataset) {\n    dataset.error = errMsg;\n    delete dataset.loaded;\n    delete dataset.status;\n  }\n}\n\nfunction isAudioPlaying(audio: HTMLAudioElement) {\n  return !!audio && audio.currentTime > 0 && !audio.paused && !audio.ended && audio.readyState > 2;\n}\n\nfunction stopPreviousPlayer() {\n  if (sharedPlayerNode) {\n    const audio = sharedPlayerNode.getElementsByTagName('audio')[0];\n    if (audio && isAudioPlaying(audio)) {\n      audio.pause();\n      audio.currentTime = 0;\n    }\n  }\n  if (currentTrackPlayer) {\n    const { dataset } = currentTrackPlayer;\n    delete dataset.status;\n    delete dataset.loaded;\n    delete dataset.error;\n    delete dataset.played;\n  }\n}\n\nfunction sendIncrementPlayedCount() {\n  const { dataset } = currentTrackPlayer;\n  const { trackId } = dataset;\n  const url = `/api/v1/tracks/${trackId}/increment-played-count/`;\n  return sendApiRequest(url, 'POST');\n}\n\nfunction incrementPlayedCount() {\n  const trackPlayer = currentTrackPlayer;\n  sendIncrementPlayedCount()\n    .then(({ played_count }: { played_count?: number }) => {\n      // Update track data...\n      const valueNode = trackPlayer.querySelector('#played_count') as HTMLElement;\n      // Update counter in the document...\n      if (played_count != null && valueNode) {\n        valueNode.innerText = quoteHtmlAttr(String(played_count));\n        const parent = valueNode.closest('.track-played-count[data-played-count]') as HTMLElement;\n        if (parent) {\n          parent.dataset.playedCount = String(played_count);\n        }\n      }\n      // TODO: Update other instances of this track on the page (eg, in player, or in other track listings)?\n    })\n    .catch((err) => {\n      // eslint-disable-next-line no-console\n      console.error('[tracksPlayer:incrementPlayedCount:sendIncrementPlayedCount] error', {\n        err,\n      });\n      debugger; // eslint-disable-line no-debugger\n      commonNotify.showError(err);\n      throw err;\n    });\n}\n\nfunction startPlay() {\n  const trackPlayer = currentTrackPlayer;\n  const { dataset } = trackPlayer;\n  const isLoaded = !!dataset.loaded;\n  const audio = ensureSharedPlayerAudio();\n  if (!isLoaded) {\n    dataset.status = 'waiting';\n    delete dataset.loaded;\n    delete dataset.error;\n    const { trackMediaUrl } = dataset;\n    const source = createSharedPlayerSource({ src: trackMediaUrl });\n    if (!source) {\n      throw new Error(getJsText('noAudioSourceNodeFound'));\n    }\n    audio.load();\n  } else {\n    dataset.status = 'playing';\n    audio.play();\n  }\n}\n\nfunction trackPlayHandler(ev: MouseEvent) {\n  const controlNode = ev.currentTarget as HTMLElement;\n  const trackPlayer = controlNode.closest('.track-player') as HTMLElement;\n  if (currentTrackPlayer && currentTrackPlayer !== trackPlayer) {\n    stopPreviousPlayer();\n  }\n  const { dataset } = trackPlayer;\n  const isPlaying = dataset.status === 'playing';\n  const isWaiting = dataset.status === 'waiting';\n  const readyToPlay = !isWaiting && !isPlaying;\n  const audio = ensureSharedPlayerAudio();\n  if (isPlaying) {\n    // Pause if playing...\n    audio.pause();\n    dataset.status = 'paused';\n  } else if (readyToPlay) {\n    currentTrackPlayer = trackPlayer;\n    startPlay();\n  }\n}\n\nfunction initTrackPlayerNode(playerNode: HTMLElement) {\n  const { dataset } = playerNode;\n  const {\n    inited,\n    // trackId, // \"1\"\n    trackMediaUrl, // \"/media/samples/gr-400x225.jpg\"\n  } = dataset;\n  if (inited || !trackMediaUrl) {\n    return;\n  }\n  const playControl = playerNode.querySelector('.track-control-play');\n  playControl.addEventListener('click', trackPlayHandler);\n  dataset.inited = TRUE;\n}\n\nexport function initTracksPlayerWrapper(domNode: HTMLElement = document.body) {\n  const players = domNode.querySelectorAll('.track-player[data-track-media-url]');\n  players.forEach(initTrackPlayerNode);\n}\n","import { commonNotify } from '../CommonNotify/CommonNotifySingleton';\nimport { getJsText } from '../helpers/getJsText';\nimport { sendApiRequest } from '../helpers/sendApiRequest';\n\n// Values for dataset statuses\nconst TRUE = 'true';\n\nfunction sendToggleFavoriteRequest(trackId: number | string, value: boolean) {\n  const url = `/api/v1/tracks/${trackId}/toggle-favorite/`;\n  return sendApiRequest(url, 'POST', { value });\n}\n\nfunction toggleFavorite(ev: Event) {\n  const node = ev.currentTarget as HTMLElement;\n  const controlsNode = node.closest('.track-controls') as HTMLElement;\n  const { dataset } = controlsNode;\n  const { trackId, favorite } = dataset;\n  const value = !favorite;\n  sendToggleFavoriteRequest(trackId, value)\n    .then((_results: { favorite_track_ids: number[] }) => {\n      /* // DEBUG\n       * const { favorite_track_ids } = results;\n       * console.log('[trackControls:toggleFavorite]', {\n       *   favorite_track_ids,\n       * });\n       */\n      if (value) {\n        dataset.favorite = TRUE;\n        commonNotify.showSuccess(getJsText('trackAddedToFavorites'));\n      } else {\n        delete dataset.favorite;\n        commonNotify.showSuccess(getJsText('trackRemovedFromFavorites'));\n      }\n    })\n    .catch((err) => {\n      // eslint-disable-next-line no-console\n      console.error('[tracksPlayer:toggleFavorite:sendToggleFavoriteRequest] error', {\n        err,\n      });\n      debugger; // eslint-disable-line no-debugger\n      commonNotify.showError(err);\n    });\n}\n\nfunction initTrackControlsNode(node: HTMLElement) {\n  const { dataset } = node;\n  const { inited, controlId } = dataset;\n  if (inited) {\n    return;\n  }\n  if (controlId === 'toggleFavorite') {\n    node.addEventListener('click', toggleFavorite);\n  }\n  dataset.inited = TRUE;\n}\n\nexport function initTrackControlsWrapper(domNode: HTMLElement = document.body) {\n  const players = domNode.querySelectorAll(\n    '.track-controls[data-track-id] .track-control[data-control-id]',\n  );\n  players.forEach(initTrackControlsNode);\n}\n","/**\n * @desc Main entry point module (scripts)\n * @module src/assets/index.ts\n * @changed 2025.01.12, 10:00\n */\n\nimport { initTracksPlayerWrapper } from './track-blocks/tracksPlayer';\nimport { initTrackControlsWrapper } from './track-blocks/trackControls';\n\ninitTracksPlayerWrapper();\ninitTrackControlsWrapper();\n"],"names":["getErrorText","error","Array","isArray","map","this","bind","join","Error","message","String","quoteHtmlAttr","str","preserveCR","crValue","replace","icons","success","warn","info","commonNotify","notifyRoot","undefined","timeoutDelay","inited","removeNotify","notifyData","node","handler","classList","remove","clearTimeout","setTimeout","removeChild","_e","showNotify","mode","text","content","ensureInit","document","createElement","add","nodeIcon","appendChild","nodeText","innerHTML","window","requestAnimationFrame","removeNotifyHandler","addEventListener","showInfo","showSuccess","showWarn","showError","showDemo","init","createDomNode","rootNode","body","setAttribute","getJsText","id","textNode","querySelector","console","trim","sendApiRequest","url","method","requestData","headers","Accept","cookieId","cookiesList","cookie","split","i","length","s","val","decodeURIComponent","getCookie","fetch","credentials","JSON","stringify","then","res","ok","status","statusText","json","data","errMsg","detail","filter","Boolean","catch","err","sharedPlayerContainer","sharedPlayerNode","currentTrackPlayer","TRUE","ensureSharedPlayerAudio","sharedPlayer","audio","sharedPlayerLoaded","ensureSharedPlayer","getElementsByTagName","sharedPlayerEnded","_ev","currentTime","dataset","played","sharedPlayerTimeUpdate","ev","timeNode","currentTarget","durationFormatted","time","sec","min","hrs","items","Math","floor","idx","padStart","shift","formatDuration","sharedPlayerPlay","trackPlayer","trackId","sendIncrementPlayedCount","played_count","valueNode","innerText","closest","playedCount","loaded","play","sharedPlayerError","srcElement","src","type","startPlay","isLoaded","source","opts","from","createSharedPlayerSource","load","trackPlayHandler","paused","ended","readyState","isAudioPlaying","pause","stopPreviousPlayer","isPlaying","readyToPlay","initTrackPlayerNode","playerNode","trackMediaUrl","domNode","toggleFavorite","value","sendToggleFavoriteRequest","_results","favorite","initTrackControlsNode","controlId","querySelectorAll","forEach","initTrackControlsWrapper"],"sourceRoot":""}