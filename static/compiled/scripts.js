(()=>{"use strict";function t(t){const e=document.cookie.split(";");for(let r=0;r<e.length;r++){const n=e[r],[o,a]=n.trim().split("=").map(decodeURIComponent);if(o===t)return a}}var e={success:"bi-check",error:"bi-exclamation-triangle-fill",warn:"bi-bell-fill",info:"bi-info-lg"},r=new(function(){function t(){this.notifyRoot=void 0,this.timeoutDelay=3e3,this.inited=!1}return t.prototype.removeNotify=function(t){var e=this,r=t.node,n=t.handler;r.classList.remove("active"),n&&(clearTimeout(n),t.handler=void 0),setTimeout((function(){try{e.notifyRoot.removeChild(r)}catch(t){}}),250)},t.prototype.showNotify=function(t,r){var n,o=this;this.ensureInit(),r||(r=t,t="info"),n=r instanceof Error?function(t){if(t)return Array.isArray(t)?t.map(this.getErrorText.bind(this)).join("\n"):(t instanceof Error?t=t.message:"string"!=typeof t&&(t=String(t)),t)}(r):String(r);var a=document.createElement("div");a.classList.add("notify"),a.classList.add("notify-"+t);var i=document.createElement("span");i.classList.add("icon"),i.classList.add("bi"),i.classList.add(e[t]),a.appendChild(i);var c=document.createElement("div");c.classList.add("text"),c.innerHTML=n,a.appendChild(c),this.notifyRoot.appendChild(a),window.requestAnimationFrame((function(){setTimeout((function(){a.classList.add("active")}),10)}));var s={node:a,handler:void 0},u=this.removeNotify.bind(this,s);s.handler=setTimeout(u,this.timeoutDelay),a.addEventListener("mouseenter",(function(){clearTimeout(s.handler)})),a.addEventListener("mouseleave",(function(){s.handler=setTimeout(u,o.timeoutDelay)})),a.addEventListener("click",u)},t.prototype.showInfo=function(t){this.showNotify("info",t)},t.prototype.showSuccess=function(t){this.showNotify("success",t)},t.prototype.showWarn=function(t){this.showNotify("warn",t)},t.prototype.showError=function(t){this.showNotify("error",t)},t.prototype.showDemo=function(){this.showInfo("Info"),this.showSuccess("Success"),this.showWarn("Warn"),this.showError("Error")},t.prototype.ensureInit=function(){this.init()},t.prototype.createDomNode=function(){var t=document.body,e=document.createElement("div");e.classList.add("notify-root"),e.setAttribute("id","notify-root"),t.appendChild(e),this.notifyRoot=e},t.prototype.init=function(){this.inited||(this.createDomNode(),this.inited=!0)},t}()),n=function(t,e,r,n){return new(r||(r=Promise))((function(o,a){function i(t){try{s(n.next(t))}catch(t){a(t)}}function c(t){try{s(n.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,c)}s((n=n.apply(t,e||[])).next())}))},o=function(t,e){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},a=document.body,i=void 0,c=void 0,s="true";function u(){var t=function(){if(!i){(i=document.createElement("div")).classList.add("shared-player");var t=document.createElement("audio");t.addEventListener("loadeddata",p),i.appendChild(t),a.appendChild(i)}return i}(),e=t.getElementsByTagName("audio")[0];if(!e)throw new Error("No audio node found");return e}function l(t){u().currentTime=0;var e=null==c?void 0:c.dataset;e&&(delete e.status,delete e.played)}function d(t){var e=null==c?void 0:c.querySelector(".time"),r=t.currentTarget.currentTime;if(e){var n=function(t){const e=t/1e3,r=e/60,n=r/60,o=[n/24,n%24,r%60,e%60].map(Math.floor).map(((t,e)=>{if(!(e<2)||t)return e>=1?String(t).padStart(2,"0"):e?void 0:String(t)+"d"}));return[o.shift(),o.filter(Boolean).join(":")].filter(Boolean).join(" ")}(Math.floor(1e3*r));e.innerHTML=n}null==c||c.dataset}function f(e){var a,i=null==c?void 0:c.dataset;i&&(i.status="playing",i.played||(i.played=s,a=c,function(){var e=this,r=c.dataset,a=r.trackId,i=t("csrftoken"),s="/api/api-tracks/".concat(a,"/incrementPlayedCount/");return fetch(s,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRFToken":i,sessionid:t("sessionid")},body:JSON.stringify({})}).then((function(t){return n(e,void 0,void 0,(function(){var e;return o(this,(function(r){switch(r.label){case 0:return[4,t.json()];case 1:return e=r.sent(),[2,[t,e]]}}))}))})).then((function(t){var e=t[0],r=t[1],n=e.ok,o=e.status;if(!n){var a=["Error ".concat(o),(null==r?void 0:r.detail)||e.statusText].filter(Boolean).join(": ");throw new Error(a)}return r}))}().then((function(t){var e=t.played_count,r=a.querySelector("#played_count");null!=e&&r&&(r.innerText=function(t,e){const r=e?"&#13;":"\n";return String(t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,r).replace(/[\r\n]/g,r)}(String(e)))})).catch((function(t){console.error("[tracksPlayer:incrementPlayedCount:sendIncrementPlayedCount] error",{err:t});debugger;throw r.showError(t),t}))))}function p(t){var e=u(),r=null==c?void 0:c.dataset;r&&(r.loaded=s,delete r.error),e.play()}function h(t){var e=t.currentTarget,n=e.src,o=e.type,a="Error loading audio file "+n,i=new Error(a);console.error("[sharedPlayerError]",a,{error:i,currentTrackPlayer:c,src:n,type:o,ev:t});debugger;r.showError(a);var s=null==c?void 0:c.dataset;s&&(s.error=a,delete s.loaded,delete s.status)}function y(){var t=c.dataset,e=!!t.loaded,r=u();if(e)t.status="playing",r.play();else{t.status="waiting",delete t.loaded,delete t.error;var n=function(t){void 0===t&&(t={});for(var e=u(),r=0,n=Array.from(e.getElementsByTagName("source"));r<n.length;r++)n[r].remove();e.setAttribute("preload","auto");var o=document.createElement("source");return o.setAttribute("type",t.type||"audio/mpeg"),t.src&&o.setAttribute("src",t.src),e.addEventListener("loadeddata",p),e.addEventListener("playing",f),e.addEventListener("timeupdate",d),e.addEventListener("ended",l),o.addEventListener("error",h),e.appendChild(o),o}({src:t.trackMediaUrl});if(!n)throw new Error("No audio source node found");r.load()}}function v(t){var e=t.currentTarget.closest(".track-player");c&&c!==e&&function(){if(i){var t=i.getElementsByTagName("audio")[0];t&&function(t){return!!t&&t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}(t)&&(t.pause(),t.currentTime=0)}if(c){var e=c.dataset;delete e.status,delete e.loaded,delete e.error,delete e.played}}();var r=e.dataset,n="playing"===r.status,o=!("waiting"===r.status||n),a=u();n?(a.pause(),r.status="paused"):o&&(c=e,y())}function m(t){var e=t.dataset,r=e.inited,n=e.trackMediaUrl;!r&&n&&(t.querySelector(".track-control-play").addEventListener("click",v),e.inited=s)}var g,w=function(t,e,r,n){return new(r||(r=Promise))((function(o,a){function i(t){try{s(n.next(t))}catch(t){a(t)}}function c(t){try{s(n.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,c)}s((n=n.apply(t,e||[])).next())}))},b=function(t,e){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},E="true";function k(e){var n=e.currentTarget.closest(".track-controls").dataset,o=n.trackId,a=!n.favorite;(function(e,r){var n=this,o=t("csrftoken"),a="/api/api-tracks/".concat(e,"/toggleFavorite/");return fetch(a,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRFToken":o},body:JSON.stringify({value:r})}).then((function(t){return w(n,void 0,void 0,(function(){var e;return b(this,(function(r){switch(r.label){case 0:return[4,t.json()];case 1:return e=r.sent(),[2,[t,e]]}}))}))})).then((function(t){var e=t[0],r=t[1],n=e.ok,o=e.status;if(!n){var a=["Error ".concat(o),(null==r?void 0:r.detail)||e.statusText].filter(Boolean).join(": ");throw new Error(a)}return r}))})(o,a).then((function(){a?n.favorite=E:delete n.favorite})).catch((function(t){console.error("[tracksPlayer:toggleFavorite:sendToggleFavoriteRequest] error",{err:t});debugger;r.showError(t)}))}function T(t){var e=t.dataset,r=e.inited,n=e.controlId;r||("toggleFavorite"===n&&t.addEventListener("click",k),e.inited=E)}void 0===g&&(g=document.body),g.querySelectorAll(".track-player[data-track-media-url]").forEach(m),function(t){void 0===t&&(t=document.body),t.querySelectorAll(".track-controls[data-track-id] .track-control[data-control-id]").forEach(T)}()})();
//# sourceMappingURL=scripts.js.map