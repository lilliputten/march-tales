(()=>{"use strict";function t(t){return t?Array.isArray(t)?t.map(this.getErrorText.bind(this)).join("\n"):(t instanceof Error?t=t.message:"string"!=typeof t&&(t=String(t)),t):""}function e(t,e){const r=e?"&#13;":"\n";return String(t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,r).replace(/[\r\n]/g,r)}function r(t){const e=t/1e3,r=e/60,o=r/60,a=[o/24,o%24,r%60,e%60].map(Math.floor).map(((t,e)=>{if(!(e<2)||t)return e>=1?String(t).padStart(2,"0"):e?void 0:String(t)+"d"}));return[a.shift(),a.filter(Boolean).join(":")].filter(Boolean).join(" ")}function o(t,e,r){const o=[[t,e||""].map(encodeURIComponent).join("="),"path=/"];r&&o.push("max-age="+r);const a=o.filter(Boolean).join(";");document.cookie=a}var a={success:"bi-check",error:"bi-exclamation-triangle-fill",warn:"bi-bell-fill",info:"bi-info-lg"},i=new(function(){function e(){this.timeoutDelay=3e3,this.inited=!1}return e.prototype.removeNotify=function(t){var e=this,r=t.node,o=t.handler;r.classList.remove("active"),o&&(clearTimeout(o),t.handler=void 0),setTimeout((function(){var t;try{null===(t=e.notifyRoot)||void 0===t||t.removeChild(r)}catch(t){}}),250)},e.prototype.showNotify=function(e,r){var o,i,n=this;this.ensureInit(),r||(r=e,e="info"),i=r instanceof Error?t(r):String(r);var s=document.createElement("div");s.classList.add("notify"),s.classList.add("notify-"+e);var l=document.createElement("span");l.classList.add("icon"),l.classList.add("bi"),l.classList.add(a[e]),s.appendChild(l);var c=document.createElement("div");c.classList.add("text"),c.innerHTML=i,s.appendChild(c),null===(o=this.notifyRoot)||void 0===o||o.appendChild(s),window.requestAnimationFrame((function(){setTimeout((function(){s.classList.add("active")}),10)}));var d={node:s,handler:void 0},u=this.removeNotify.bind(this,d);d.handler=setTimeout(u,this.timeoutDelay),s.addEventListener("mouseenter",(function(){clearTimeout(d.handler)})),s.addEventListener("mouseleave",(function(){d.handler=setTimeout(u,n.timeoutDelay)})),s.addEventListener("click",u)},e.prototype.showInfo=function(t){this.showNotify("info",t)},e.prototype.showSuccess=function(t){this.showNotify("success",t)},e.prototype.showWarn=function(t){this.showNotify("warn",t)},e.prototype.showError=function(t){this.showNotify("error",t)},e.prototype.showDemo=function(){this.showInfo("Info"),this.showSuccess("Success"),this.showWarn("Warn"),this.showError("Error")},e.prototype.ensureInit=function(){this.init()},e.prototype.createDomNode=function(){var t=document.body,e=document.createElement("div");e.classList.add("notify-root"),e.setAttribute("id","notify-root"),t.appendChild(e),this.notifyRoot=e},e.prototype.init=function(){this.inited||(this.createDomNode(),this.inited=!0)},e}());function n(t){var r=document.body.querySelector("#js-texts #"+t);return r||console.warn("[getJsText] Can not find js text node for id:",t),e((null==r?void 0:r.innerHTML)||t).trim()}function s(t){if(!t)return"0";if("string"==typeof t){if(isNaN(t))return"0";t=Number(t)}return t.toFixed(3).replace(/(\.\d+)0+$/,"$1").replace(/\.0+$/,"")}var l="-",c=new RegExp("-+$"),d="cookies",u=new(function(){function t(){}return t.prototype.updatePlayedCount=function(t,e,r){try{var o=Date.now(),a=this.getOrCreate(t);return null==e||isNaN(e)?a.playedCount=a.playedCount?a.playedCount+1:1:a.playedCount=e,a.lastPlayed=r||o,a.lastUpdated=o,this.insert(a),a}catch(e){console.error("[LocalTrackInfoDb:incrementPlayedCount]",e.message,{err:e,id:t});debugger;throw e}},t.prototype.updatePosition=function(t,e,r){try{var o=Date.now(),a=this.getOrCreate(t);return a.position=e,a.lastPlayed=r||o,a.lastUpdated=o,this.insert(a),a}catch(e){console.error("[LocalTrackInfoDb:updatePosition]",e.message,{err:e,id:t});debugger;throw e}},t.prototype.updateFavorite=function(t,e,r){try{var o=Date.now(),a=this.getOrCreate(t);return a.favorite=e,a.lastFavorited=r||o,a.lastUpdated=o,this.insert(a),this._toggleInFavoritesIndex(t,e),a}catch(e){console.error("[LocalTrackInfoDb:setFavorite]",e.message,{err:e,id:t});debugger;throw e}},t.prototype.updateFavoritesByTrackIds=function(t,e,r){var o=this,a=Date.now();this._getIndex().forEach((function(i){var n=t.includes(i),s=o.getOrCreate(i);s.favorite!==n&&(s.favorite=n,s.lastFavorited=e&&e[i]||r||a,s.lastUpdated=a,o.insert(s))})),this._setFavoritesIndex(t)},t.prototype.save=function(t,e){try{var r=Date.now();return t.lastPlayed=e||r,t.lastUpdated=r,this.insert(t),t}catch(e){console.error("[LocalTrackInfoDb:save]",e.message,{err:e,trackInfo:t});debugger;throw e}},t.prototype.createNewRecord=function(t){return{id:t,favorite:!1,playedCount:0,position:0,lastUpdated:Date.now(),lastPlayed:0,lastFavorited:0}},t.prototype.getOrCreate=function(t){return this.getById(t)||this.createNewRecord(t)},t.prototype.insert=function(t){var e=t.id,r=function(t){var e=t.id,r=t.favorite,o=t.playedCount,a=t.position,i=t.lastUpdated,n=t.lastPlayed,d=t.lastFavorited;return[e?Number(e):void 0,r?Number(r):void 0,o?Number(o):void 0,a?s(a):void 0,i?Math.round(i/1e3):void 0,n?Math.round(n/1e3):void 0,d?Math.round(d/1e3):void 0].join(l).replace(c,"")}(t);window.localStorage.setItem("ti-"+e,r),this._addToIndex(e)},t.prototype.getFavorites=function(){return this.getAll().filter((function(t){return t.favorite}))},t.prototype.getById=function(t){var e=window.localStorage.getItem("ti-"+t);if(e)return function(t){if(t)try{var e=t.split(l),r=e[0],o=e[1],a=e[2],i=e[3],n=e[4],s=e[5],c=e[6];return{id:r?Number(r):0,favorite:Boolean(o),playedCount:a?Number(a):0,position:i?Number(i):0,lastUpdated:n?1e3*Number(n):0,lastPlayed:s?1e3*Number(s):0,lastFavorited:c?1e3*Number(c):0}}catch(e){return void console.warn("[TrackInfo:trackInfoFromJsonStr] Parse error",{str:t,err:e})}}(e)},t.prototype._getFavoritesIndex=function(){try{var t=window.localStorage.getItem("favorites");return t?t.split(l).map(Number).filter((function(t){return!isNaN(t)})):[]}catch(t){return[]}},t.prototype._setFavoritesIndex=function(t){var e=t.filter((function(t){return!isNaN(t)})).filter(Boolean),r=e.join(l);window.localStorage.setItem("favorites",r);var a=e.length,i=!!a;document.body.classList.toggle("has-favorites",i),document.querySelectorAll(".favorites-count").forEach((function(t){t.innerText=String(a)})),window.localStorage.getItem(d)&&o("favorites",r)},t.prototype._addToFavoritesIndex=function(t){var e=this._getFavoritesIndex();e.includes(t)||(e.push(t),this._setFavoritesIndex(e))},t.prototype._removeFromFavoritesIndex=function(t){var e=this._getFavoritesIndex();e.includes(t)&&this._setFavoritesIndex(e.filter((function(e){return t!==e})))},t.prototype._toggleInFavoritesIndex=function(t,e){e?this._addToFavoritesIndex(t):this._removeFromFavoritesIndex(t)},t.prototype._getIndex=function(){try{var t=window.localStorage.getItem("ti-index");return t?t.split(l).map((function(t){return t?Number(t):0})):[]}catch(t){return[]}},t.prototype._setIndex=function(t){window.localStorage.setItem("ti-index",t.join(l))},t.prototype._addToIndex=function(t){var e=this._getIndex();e.includes(t)||(e.push(t),this._setIndex(e))},t.prototype._removeFromIndex=function(t){var e=this._getIndex();e.includes(t)&&this._setIndex(e.filter((function(e){return t!==e})))},t.prototype._toggleInIndex=function(t,e){e?this._addToIndex(t):this._removeFromIndex(t)},t.prototype.getAll=function(){var t=this;return this._getIndex().map((function(e){return t.getById(e)})).filter(Boolean)},t.prototype.delete=function(t){window.localStorage.removeItem("ti-"+t),this._removeFromIndex(t)},t.prototype.clearAll=function(){this._getIndex().forEach((function(t){window.localStorage.removeItem("ti-"+t)})),this._setIndex([])},t}()),p="ActivePlayerData";function h(t){var e=t?function(t){return JSON.stringify(t)}(t):"";window.localStorage.setItem(p,e)}function v(){var t=function(t){if(t)try{var e=JSON.parse(t),r=e.id,o=e.title,a=e.imageUrl,i=e.mediaUrl,n=e.duration,s=e.favorite;return{id:r?Number(r):0,title:o?String(o):"",imageUrl:a?String(a):"",mediaUrl:i?String(i):"",duration:n?Number(n):0,favorite:Boolean(s)}}catch(e){return void console.warn("[ActivePlayerData:storageActivePlayerDataId] Parse error",{str:t,err:e})}}(window.localStorage.getItem(p));return(null==t?void 0:t.id)?t:void 0}var y=function(t,e,r,o){return new(r||(r=Promise))((function(a,i){function n(t){try{l(o.next(t))}catch(t){i(t)}}function s(t){try{l(o.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(n,s)}l((o=o.apply(t,e||[])).next())}))},f=function(t,e){var r,o,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},n=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return n.next=s(0),n.throw=s(1),n.return=s(2),"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,s[0]&&(i=0)),i;)try{if(r=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],o=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};function g(e,r,o){var a=this;void 0===r&&(r="GET");var i={Accept:"application/json","Content-Type":"application/json","X-CSRFToken":function(t){const e=document.cookie.split(";");for(let r=0;r<e.length;r++){const o=e[r],[a,i]=o.trim().split("=").map(decodeURIComponent);if(a===t)return i}}("csrftoken")||""};return fetch(e,{method:r,headers:i,credentials:"include",body:o?JSON.stringify(o):null}).then((function(t){return y(a,void 0,void 0,(function(){var a,s,l,c,d;return f(this,(function(u){switch(u.label){case 0:a=t.ok,s=t.status,l=t.statusText,c=void 0,u.label=1;case 1:return u.trys.push([1,3,,4]),[4,t.json()];case 2:return c=u.sent(),[3,4];case 3:return u.sent(),[3,4];case 4:if(!a||200!==s){d=[n("fetchError")+" "+s,(null==c?void 0:c.detail)||l].filter(Boolean).join(": "),console.error("[sendApiRequest]",d,{ok:a,data:c,statusText:l,status:s,res:t,url:e,requestData:o,method:r,headers:i});debugger;throw new Error(d)}return[2,c]}}))}))})).catch((function(a){var s=[n("failedApiRequest"),t(a)].filter(Boolean).join(": ");console.error("[sendApiRequest]",s,{err:a,url:e,requestData:o,method:r,headers:i});debugger;throw new Error(s)}))}var m=function(){return m=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},m.apply(this,arguments)},P="FloatingPlayerState";function b(t){var e=function(t){var e=t.lastTimestamp,r=t.visible,o=t.status,a=t.position,i=t.progress;return[e?Math.round(e/1e3):void 0,r?Number(r):void 0,o||void 0,a?s(a):void 0,i?s(i):void 0].join(",").replace(/,+$/,"")}(m(m({},t),{lastTimestamp:Date.now()}));window.localStorage.setItem(P,e)}function k(){return function(t){if(!t)return{};try{var e=t.split(","),r=e[0],o=e[1],a=e[2],i=e[3],n=e[4];return{lastTimestamp:r?1e3*Number(r):void 0,visible:o?Boolean(o):void 0,status:a?String(a):void 0,position:i?Number(i):void 0,progress:n?Number(n):void 0}}catch(e){return console.warn("[FloatingPlayerState:convertFloatingPlayerStateFromJsonStr] Parse error",{str:t,err:e}),{}}}(window.localStorage.getItem(P))}var w,S=function(){function t(){}return t.prototype.setParentDomNode=function(t){this.parentDomNode=t},t.prototype.requireParentDomNode=function(){return this.parentDomNode||document.body},t.prototype.ensureHiddenPlayer=function(){if(!this.hiddenPlayerNode){this.hiddenPlayerNode=document.createElement("div"),this.hiddenPlayerNode.classList.add("hidden-player");var t=document.createElement("audio");this.hiddenPlayerNode.appendChild(t),this.requireParentDomNode().appendChild(this.hiddenPlayerNode)}return this.hiddenPlayerNode},t.prototype.hasAudio=function(){return!!this.audioNode},t.prototype.hasSource=function(){return!!this.sourceNode},t.prototype.ensureHiddenPlayerAudio=function(){if(!this.audioNode){var t=this.requireParentDomNode();this.audioNode=document.createElement("audio"),this.audioNode.classList.add("hidden-player"),this.audioNode.setAttribute("preload","auto"),t.appendChild(this.audioNode)}return this.audioNode},t.prototype.createHiddenPlayerSource=function(t){void 0===t&&(t={}),this.removeHiddenPlayerSource();var e=this.ensureHiddenPlayerAudio();return this.sourceNode=document.createElement("source"),this.sourceNode.setAttribute("type",t.type||"audio/mpeg"),t.src&&this.sourceNode.setAttribute("src",t.src),e.appendChild(this.sourceNode),this.sourceNode},t.prototype.removeHiddenPlayerAudio=function(){this.audioNode&&(this.audioNode.pause(),this.audioNode.remove(),this.audioNode=void 0,this.sourceNode=void 0)},t.prototype.removeHiddenPlayerSource=function(){for(var t=this.ensureHiddenPlayerAudio(),e=0,r=Array.from(t.getElementsByTagName("source"));e<r.length;e++)r[e].remove();this.sourceNode=void 0},t}(),A=function(){function t(){this.onPlayStartCallbacks=[],this.onPlayStopCallbacks=[],this.onUpdateCallbacks=[],this.onIncrementCallbacks=[],this.onFavoritesCallbacks=[],this.onFavoriteCallbacks=[],this.onErrorCallbacks=[]}return t.prototype.addPlayStartCallback=function(t){t&&!this.onPlayStartCallbacks.includes(t)&&this.onPlayStartCallbacks.push(t)},t.prototype.addPlayStopCallback=function(t){t&&!this.onPlayStopCallbacks.includes(t)&&this.onPlayStopCallbacks.push(t)},t.prototype.addUpdateCallback=function(t){t&&!this.onUpdateCallbacks.includes(t)&&this.onUpdateCallbacks.push(t)},t.prototype.addIncrementCallback=function(t){t&&!this.onIncrementCallbacks.includes(t)&&this.onIncrementCallbacks.push(t)},t.prototype.addFavoriteCallback=function(t){t&&!this.onFavoriteCallbacks.includes(t)&&this.onFavoriteCallbacks.push(t)},t.prototype.addFavoritesCallback=function(t){t&&!this.onFavoritesCallbacks.includes(t)&&this.onFavoritesCallbacks.push(t)},t.prototype.addErrorCallback=function(t){t&&!this.onErrorCallbacks.includes(t)&&this.onErrorCallbacks.push(t)},t.prototype.invokePlayStart=function(t){t.activePlayerData&&this.onPlayStartCallbacks.forEach((function(e){e(t)}))},t.prototype.invokePlayStop=function(t){t.activePlayerData&&this.onPlayStopCallbacks.forEach((function(e){e(t)}))},t.prototype.invokeUpdate=function(t){t.activePlayerData&&this.onUpdateCallbacks.forEach((function(e){e(t)}))},t.prototype.invokeIncrement=function(t){t.activePlayerData&&this.onIncrementCallbacks.forEach((function(e){e(t)}))},t.prototype.invokeFavorite=function(t){this.onFavoriteCallbacks.forEach((function(e){e(t)}))},t.prototype.invokeFavorites=function(t){this.onFavoritesCallbacks.forEach((function(e){e(t)}))},t.prototype.invokeError=function(t){t&&this.onErrorCallbacks.forEach((function(e){e(t)}))},t}(),I=function(t,e,r,o){return new(r||(r=Promise))((function(a,i){function n(t){try{l(o.next(t))}catch(t){i(t)}}function s(t){try{l(o.throw(t))}catch(t){i(t)}}function l(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(n,s)}l((o=o.apply(t,e||[])).next())}))},D=function(t,e){var r,o,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},n=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return n.next=s(0),n.throw=s(1),n.return=s(2),"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;n&&(n=0,s[0]&&(i=0)),i;)try{if(r=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,o=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((a=(a=i.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){i.label=s[1];break}if(6===s[0]&&i.label<a[1]){i.label=a[1],a=s;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(s);break}a[2]&&i.ops.pop(),i.trys.pop();continue}s=e.call(t,i)}catch(t){s=[6,t],o=0}finally{r=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},F="true",N=window.DEBUG?1e3:1e4,E=function(){function e(){this.inited=!1,this.callbacks=new A,this.hiddenPlayer=new S,this.state={},this.toggling={},this.seeking=!1,this.lastUpdatedServerPlayback=0,this.isUpdatingServerPlayback=!1,this.loadActivePlayerData(),this.loadFloatingPlayerState(),this.initDomNode(),this.updateAll()}return e.prototype.tracksLoaded=function(){var t=Date.now();this.activePlayerData&&(this.ensureAudioLoaded(),"playing"===this.state.status&&this.state.lastTimestamp&&this.state.lastTimestamp>t-5e3?this.playCurrentPlayer():delete this.state.status)},e.prototype.requireAudio=function(){return this.audio||(this.audio=this.hiddenPlayer.ensureHiddenPlayerAudio(),this.audio.addEventListener("canplay",this.handleAudioCanPlay.bind(this)),this.audio.addEventListener("playing",this.handleAudioPlay.bind(this)),this.audio.addEventListener("timeupdate",this.handleAudioTimeUpdate.bind(this)),this.audio.addEventListener("ended",this.handleAudioEnded.bind(this))),this.audio},e.prototype.removeAudio=function(){this.hiddenPlayer.removeHiddenPlayerAudio(),this.audio=void 0},e.prototype.hasAudio=function(){return!!this.audio},e.prototype.hasAudioSource=function(){return this.hiddenPlayer.hasSource()},e.prototype.requireDomNode=function(){if(this.domNode||(this.domNode=document.querySelector(".floating-player"),this.hiddenPlayer.setParentDomNode(this.domNode)),!this.domNode){var t=new Error("No floating player node found");console.error("[FloatingPlayerClass:requireDomNode]",t.message,{error:t});debugger;throw t}return this.domNode},e.prototype.requireActivePlayerData=function(){if(!this.activePlayerData){var t=new Error("No active player data set");console.error("[FloatingPlayerClass:requireActivePlayerData]",t.message,{error:t});debugger;throw t}return this.activePlayerData},e.prototype.loadActivePlayerData=function(){this.activePlayerData=v()},e.prototype.saveActivePlayerData=function(){h(this.activePlayerData)},e.prototype.clearActivePlayerData=function(){this.activePlayerData=void 0,this.saveActivePlayerData()},e.prototype.loadFloatingPlayerState=function(){this.state=k()},e.prototype.saveFloatingPlayerState=function(){b(this.state)},e.prototype.clearFloatingPlayerState=function(){this.state={},this.saveFloatingPlayerState()},e.prototype.showFloatingPlayer=function(){this.state.visible=!0,this.updateStateInDom(),this.saveFloatingPlayerState()},e.prototype.hideFloatingPlayer=function(){this.state.visible=!1,this.updateStateInDom(),this.saveFloatingPlayerState()},e.prototype.updateActivePlayerDataInDom=function(){var t=this.requireDomNode(),e=this.requireActivePlayerData(),o=e.id,a=t.querySelector(".title"),i=t.querySelector(".duration"),n=t.querySelector(".image"),s=t.dataset;requestAnimationFrame((function(){a.innerText=e.title,i.innerText=r(Math.floor(1e3*e.duration)),n.style.backgroundImage="url("+e.imageUrl+")",e.favorite?s.favorite=F:delete s.favorite,t.querySelectorAll(".trackLink").forEach((function(t){t.setAttribute("href","/tracks/".concat(o,"/"))}))}))},e.prototype.updateStateInDom=function(){var t=this,e=this.requireDomNode().dataset;requestAnimationFrame((function(){t.state.status?e.status=t.state.status:delete e.status,document.body.classList.toggle("with-player",!!t.state.visible)}))},e.prototype.updatePositionInDom=function(){var t=this,e=this.requireDomNode(),r=e.querySelector(".seekBar"),o=e.dataset;requestAnimationFrame((function(){o.position=s(t.state.position),o.progress=s(t.state.progress),e.style.setProperty("--progress",o.progress),r.value=o.progress}))},e.prototype.calculateProgress=function(){var t=this.requireActivePlayerData(),e=this.state.position,r=void 0===e?0:e,o=t.id,a=t.duration;if(!a){var i=new Error("No duration provided for a track: ".concat(o));console.warn("[FloatingPlayerClass:calculateProgress]",i.message,{error:i,id:o,duration:a,position:r,activePlayerData:t});debugger;return 0}var n=r/a;return Math.min(100,100*n)},e.prototype.updateTrackPosition=function(t){void 0===t&&(t=!1);var e=this.requireDomNode().querySelector(".time"),o=this.requireActivePlayerData(),a=this.state.position,i=void 0===a?0:a,n=o.id,s=this.calculateProgress();this.state.progress=s,this.updatePositionInDom(),e&&requestAnimationFrame((function(){e.innerText=r(Math.floor(1e3*i))})),t||u.updatePosition(n,i)},e.prototype.updateAll=function(){this.activePlayerData&&this.updateTrackPosition(!0),this.updateStateInDom(),this.updatePositionInDom(),this.activePlayerData&&this.updateActivePlayerDataInDom()},e.prototype.handleAudioTimeUpdate=function(t){if(!this.seeking){var e=this.audio,r=t.currentTarget;if(r===e){var o=this.requireActivePlayerData(),a=r.currentTime;this.state.position!=a&&(this.state.position=a,this.updateTrackPosition(),this.saveFloatingPlayerState(),this.updateServerPlayback(),this.callbacks.invokeUpdate({floatingPlayerState:this.state,activePlayerData:o}),u.updatePosition(o.id,a))}}},e.prototype.handleAudioCanPlay=function(t){this.state.loaded||(this.state.loaded=!0,delete this.state.error)},e.prototype.handleAudioPlay=function(t){var e=this.requireActivePlayerData();this.state.status="playing",this.updateStateInDom(),this.saveFloatingPlayerState(),this.updateServerPlayback(),this.callbacks.invokePlayStart({floatingPlayerState:this.state,activePlayerData:e})},e.prototype.handleAudioEnded=function(t){var e=this.requireActivePlayerData();this.incrementPlayedCount(),this.state.status="paused",this.updateStateInDom(),this.saveFloatingPlayerState(),this.updateServerPlayback(!0),this.callbacks.invokePlayStop({floatingPlayerState:this.state,activePlayerData:e})},e.prototype.handleError=function(e){var r=e instanceof Error&&e.name;if(console.error("[FloatingPlayerClass:handleError]",{err:e}),"AbortError"!==r){debugger;this.state.error=t(e),this.updateStateInDom(),i.showError(e),this.callbacks.invokeError(e)}},e.prototype.handleAudioSourceError=function(t){var e=t.currentTarget,r=e.src,o=e.type,a=n("errorLoadingAudioFile")+" "+r+(o?"(".concat(o,")"):""),i=new Error(a);this.handleError(i)},e.prototype.sendUpdateServerPlayback=function(t,e,r){return g("/api/v1/tracks/".concat(t,"/update-position/"),"POST",{position:Number(e.toFixed(3)),timestamp_s:r?Math.round(r/1e3):null})},e.prototype.resetUpdateServerPlayback=function(){var t=Date.now();this.lastUpdatedServerPlayback=t,this.isUpdatingServerPlayback=!1},e.prototype.updateServerPlayback=function(){return I(this,arguments,void 0,(function(t){var e,r,o,a,n=this;return void 0===t&&(t=!1),D(this,(function(s){return window.isAuthenticated&&this.inited&&this.activePlayerData&&!this.isUpdatingServerPlayback?(e=this.activePlayerData.id,r=this.state.position,null==e||null==r?[2]:(o=Date.now(),a=o-this.lastUpdatedServerPlayback,!t&&a<N?[2]:(this.isUpdatingServerPlayback=!0,[2,this.sendUpdateServerPlayback(e,r,this.state.lastTimestamp).then((function(t){n.lastUpdatedServerPlayback=o})).catch((function(t){console.error("[FloatingPlayerClass:handleAudioTimeUpdate] request error",{err:t});debugger;throw i.showError(t),t})).finally((function(){n.isUpdatingServerPlayback=!1}))]))):[2]}))}))},e.prototype.getActiveTrackId=function(){return this.activePlayerData?this.activePlayerData.id:void 0},e.prototype.loadAudio=function(){var t=this.requireActivePlayerData();this.state.loaded=!1,this.hiddenPlayer.createHiddenPlayerSource({src:t.mediaUrl}).addEventListener("error",this.handleAudioSourceError.bind(this))},e.prototype.isAudioPlaying=function(){var t=this.audio;return!!t&&t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2},e.prototype.isPlaying=function(){return"playing"===this.state.status},e.prototype.pauseCurrentPlayer=function(){this.isAudioPlaying()&&this.requireAudio().pause(),this.isPlaying()&&(this.state.status="paused",this.updateStateInDom(),this.saveFloatingPlayerState(),this.updateServerPlayback(!0))},e.prototype.playCurrentPlayer=function(){var t=this,e=this.requireAudio(),r=this.requireActivePlayerData();if(!this.isAudioPlaying()){(e.ended||this.state.position&&this.state.position>r.duration-.1)&&(this.state.position=0,e.load()),this.updateTrackPosition(),this.updateServerPlayback(!0),this.callbacks.invokeUpdate({floatingPlayerState:this.state,activePlayerData:r});var o=this.state.position||0;o||e.load(),e.currentTime=o,e.play().catch((function(e){"NotAllowedError"===e.name?(t.state.status=void 0,t.updateStateInDom()):t.handleError(e)}))}},e.prototype.trackPlayHandler=function(t){this.isPlaying()?this.pauseCurrentPlayer():this.playCurrentPlayer()},e.prototype.ensureAudioLoaded=function(){this.state.loaded&&this.hasAudio()&&this.hasAudioSource||this.loadAudio()},e.prototype.setActivePlayerData=function(t,e){var r;(null===(r=this.activePlayerData)||void 0===r?void 0:r.id)!==t.id&&(this.activePlayerData&&this.isPlaying()&&this.pauseCurrentPlayer(),this.state.loaded=!1,null!=e&&(this.state.position=e),this.removeAudio(),this.activePlayerData=t),this.saveActivePlayerData(),this.updateActivePlayerDataInDom(),this.ensureAudioLoaded()},e.prototype.setActiveTrack=function(t,e){var r=function(t){var e=t.dataset,r=Number(e.trackId),o=Boolean(e.favorite),a=parseFloat((e.trackDuration||"0").replace(",",".")),i=e.trackMediaUrl||"",n=t.querySelector("img.card-img"),s=(null==n?void 0:n.getAttribute("src"))||"";return{id:r,title:e.trackTitle||"",imageUrl:s,mediaUrl:i,duration:a,favorite:o}}(t);this.setActivePlayerData(r,e)},e.prototype.clearActiveData=function(){this.activePlayerData=void 0,this.hideFloatingPlayer(),this.removeAudio()},e.prototype.sendIncrementPlayedCount=function(t,e){return g("/api/v1/tracks/".concat(t,"/increment-played-count/"),"POST",{timestamp_s:e?Math.round(e/1e3):null})},e.prototype.incrementPlayedCount=function(){var t=this,e=this.requireActivePlayerData();if(!this.incrementing)return this.incrementing=!0,this.sendIncrementPlayedCount(e.id).then((function(r){var o=r.played_count;null!=o&&t.callbacks.invokeIncrement({count:o,activePlayerData:e})})).catch((function(r){console.error("[FloatingPlayerClass:incrementPlayedCount:sendIncrementPlayedCount] error",{err:r});debugger;throw i.showError(r),t.callbacks.invokeIncrement({activePlayerData:e}),r})).finally((function(){t.incrementing=!1}))},e.prototype.sendToggleFavoriteRequest=function(t,e,r){return g("/api/v1/tracks/".concat(t,"/toggle-favorite/"),"POST",{value:e,timestamp_s:r?Math.round(r/1e3):null})},e.prototype.toggleFavorite=function(){var t=this.requireActivePlayerData().id;this.toggleFavoriteById(t)},e.prototype.toggleFavoriteById=function(t){var e=this;if(!this.toggling[t]){var r=this.activePlayerData,o=t===(null==r?void 0:r.id),a=u.getById(t),s=!(null==a?void 0:a.favorite);u.updateFavorite(t,s),o&&(r.favorite=s,this.updateActivePlayerDataInDom(),this.saveActivePlayerData()),this.callbacks.invokeFavorite({id:t,favorite:s}),window.isAuthenticated&&(this.toggling[t]=!0,this.sendToggleFavoriteRequest(t,s,this.state.lastTimestamp).then((function(t){var r=t.favorite_track_ids,o=t.user_tracks.reduce((function(t,e){var r=e.track_id,o=e.favorited_at_sec;return r&&o&&(t[r]=1e3*o),t}),{});u.updateFavoritesByTrackIds(r,o),e.callbacks.invokeFavorites({favorites:r});var a=s?"trackAddedToFavorites":"trackRemovedFromFavorites";i.showSuccess(n(a))})).catch((function(t){console.error("[FloatingPlayerClass:toggleFavoriteById] error",{err:t});debugger;i.showError(t)})).finally((function(){e.toggling[t]=!1})))}},e.prototype.seekPosition=function(t){var e=this;this.seeking=!0,this.requireAudio().currentTime=t||0,this.state.position=t,this.updateTrackPosition(),this.saveFloatingPlayerState(),this.updateServerPlayback();var r=this.requireActivePlayerData();this.callbacks.invokeUpdate({floatingPlayerState:this.state,activePlayerData:r}),setTimeout((function(){e.seeking=!1}),150)},e.prototype.seekRewind=function(){var t=Math.max(0,(this.state.position||0)-1);this.seekPosition(t)},e.prototype.seekForward=function(){var t=this.requireActivePlayerData().duration,e=Math.min(t,(this.state.position||0)+1);this.seekPosition(e)},e.prototype.seekBarHandle=function(t){var e=this.requireActivePlayerData().duration;if(e){var r=t.currentTarget,o=Number(r.value)*e/100;this.seekPosition(o),this.isPlaying()||this.playCurrentPlayer()}},e.prototype.initDomNode=function(){var t=this,e=this.requireDomNode(),r=e.querySelector(".seekBar");r&&r.addEventListener("input",this.seekBarHandle.bind(this));var o=e.querySelector(".track-control-hide");o&&o.addEventListener("click",this.hideFloatingPlayer.bind(this)),e.querySelectorAll(".track-control").forEach((function(e){var r=e.dataset,o=r.inited,a=r.controlId;o||("rewind"===a&&e.addEventListener("click",t.seekRewind.bind(t)),"forward"===a&&e.addEventListener("click",t.seekForward.bind(t)),"toggleFavorite"===a&&e.addEventListener("click",t.toggleFavorite.bind(t)),"play"===a&&e.addEventListener("click",t.trackPlayHandler.bind(t)),r.inited=F)})),this.inited=!0},e}(),C=new E;function T(t){return{track_id:t.id,is_favorite:t.favorite,position:t.position,favorited_at_sec:Math.round(t.lastFavorited/1e3),played_at_sec:Math.round(t.lastPlayed/1e3),updated_at_sec:Math.round(t.lastUpdated/1e3)}}function q(){window.localStorage&&(window.localStorage.getItem("logged"),window.localStorage.setItem("logged","yes"));var t=u.getAll().map(T);g("/api/v1/user/tracks/sync/","POST",{items:t}).then((function(t){})).catch((function(t){console.error("[userSession:sendSyncUserTracksRequest] error",{err:t});debugger;i.showError(t)})),console.log("[userSession:onLogin]")}function x(t){if(t)try{var e=t.match(/^\S+ v\.(\d+\.\d+)/);if(e)return e[1]}catch(t){return}}var L,_=void 0,U="true";function B(t,e,o,a){var i=t.querySelector(".time"),n=t.dataset,l=n.trackId,c=n.trackDuration,d=r(Math.floor(1e3*e)),p=Number(l),h=c?parseFloat(c.replace(",",".")):0;if(!h){var v=new Error("No duration provided for a track: ".concat(p));console.error("[tracksPlayer:updateTrackPosition]",v.message,{error:v});debugger}var y=e/h,f=Math.min(100,100*y);return requestAnimationFrame((function(){n.position=s(e),n.progress=s(f),t.style.setProperty("--progress",n.progress),i&&(i.innerText=d)})),o&&u.updatePosition(p,e,o),a&&(C.state.position=e,C.state.progress=f,C.updateTrackPosition(!0)),{position:e,duration:h,progress:f}}function j(t){var e=t.floatingPlayerState;R(t.activePlayerData.id).forEach((function(t){var o=e.position,a=void 0===o?0:o,i=e.progress,n=void 0===i?0:i,l=e.status,c=t.dataset,d=t.querySelector(".time"),u=r(Math.floor(1e3*a));requestAnimationFrame((function(){l?c.status=l:delete c.status,c.position=s(a),c.progress=s(n),t.style.setProperty("--progress",c.progress),d&&(d.innerText=u)}))}))}function O(t){var e=t.activePlayerData;if(!_)throw new Error("No current track player node!");var r=_.dataset,o=Number(r.trackId);if(o===e.id)requestAnimationFrame((function(){r.status="playing"}));else{var a=new Error("Wrong active track id!");console.error("[tracksPlayer:floatingPlayerPlay]",a.message,{id:o,"activePlayerData.id":e.id,error:a});debugger}}function M(t){var e=t.activePlayerData;if(!_)throw new Error("No current track player node!");var r=_.dataset,o=Number(r.trackId);if(o===e.id)requestAnimationFrame((function(){delete r.status})),setTimeout(H.bind(void 0,_),500);else{var a=new Error("Wrong active track id!");console.error("[tracksPlayer:floatingPlayerState]",a.message,{id:o,"activePlayerData.id":e.id,error:a});debugger}}function H(t){var e=(Array.from(w).indexOf(t)+1)%w.length,r=w[e];r&&r!==t&&W(r)}function R(t){return Array.from(w).filter((function(e){return Number(e.id)===t}))}function J(t){var r=t.count;R(t.activePlayerData.id).forEach((function(t){!function(t,r){var o=t.dataset.trackId,a=Number(o);if(!a)throw new Error("No current track id!");var i=u.updatePlayedCount(a,r).playedCount,n=e(String(i)),s=t.querySelector("#played_count");if(s){var l=s.closest(".track-played-count[data-played-count]");requestAnimationFrame((function(){s.innerText=n,l&&(l.dataset.playedCount=n)}))}}(t,r)}))}function W(t){_&&_!==t&&function(){if(_){var t=_.dataset;requestAnimationFrame((function(){_.classList.toggle("current",!1),delete t.status,delete t.loaded,delete t.error}))}}();var e=t.dataset,r=Number(t.id),o=C.getActiveTrackId(),a=C.isPlaying();if(!a||(C.pauseCurrentPlayer(),o!==r)){requestAnimationFrame((function(){w.forEach((function(e){e!==t&&e.classList.contains("current")&&e.classList.toggle("current",!1)})),t.classList.toggle("current",!0)})),_=t;var i=parseFloat((e.position||"0").replace(",","."));C.setActiveTrack(t,i),C.playCurrentPlayer(),a||C.showFloatingPlayer()}}function G(t){W(t.currentTarget.closest(".track-player"))}function z(t,e){var r=t.dataset,o=r.favorite,a=Boolean(o);e!==a&&requestAnimationFrame((function(){e?r.favorite=U:delete r.favorite}))}function V(t){var e=t.id,r=t.favorite;w.forEach((function(t){Number(t.id)==e&&z(t,r)}))}function X(t){var e=t.favorites;w.forEach((function(t){var r=Number(t.id);z(t,e.includes(r))}))}function K(t){var e,r=C.activePlayerData,o=Number(t.id),a=t.dataset,i=a.inited,n=a.trackMediaUrl,s=a.trackTitle,l=a.trackDuration,c=a.favoritedAtSec,d=a.playedAtSec,p=a.position,h=p?parseFloat(p.replace(",",".")):0,v=l?parseFloat(l.replace(",",".")):0,y=isNaN(Number(d))?void 0:1e3*Number(d),f=isNaN(Number(c))?void 0:1e3*Number(c);if(o&&!i&&n){var g=window.isAuthenticated,m=!!r&&r.id==o,P=u.getById(o),b=g?Boolean(a.favorite):!!(null==P?void 0:P.favorite);if(P){if(g){var k=P.lastPlayed,w=P.lastFavorited;null!=a.favorite&&f&&f>=w&&(P.favorite=Boolean(a.favorite),P.lastFavorited=f,u.updateFavorite(o,Boolean(a.favorite),f)),y&&y>=k&&(P.position=h,P.lastPlayed=y,u.updatePosition(o,h,y))}else b&&z(t,P.favorite);B(t,P.position||0,P.lastPlayed,m);var S=Number((null===(e=t.querySelector(".track-played-count"))||void 0===e?void 0:e.dataset.playedCount)||"0");(S!==P.playedCount||b!==P.favorite)&&(P.playedCount=S,P.favorite=b,u.save(P))}else B(t,h,y,m);if(m){r.title=a.trackTitle||"",r.mediaUrl=n,_=t;var A=t.querySelector(".thumb-preview img"),I=null==A?void 0:A.getAttribute("src");I&&(r.imageUrl=I),r.duration=v,r.favorite=b,s&&(r.title=s),requestAnimationFrame((function(){t.classList.toggle("current",!0)})),j({floatingPlayerState:C.state,activePlayerData:r}),C.saveActivePlayerData()}!function(t){var e=t.dataset,r=e.trackId,o=Number(r||"");t.querySelectorAll(".track-control").forEach((function(t){var e=t.dataset,r=e.inited,a=e.controlId;r||("toggleFavorite"===a&&t.addEventListener("click",(function(){return C.toggleFavoriteById(o)})),"play"===a&&t.addEventListener("click",G),e.inited=U)})),e.inited=U}(t)}}function Q(t){if(!t.classList.contains("external")){t.classList.add("external"),t.setAttribute("target","_blank");var e=document.createElement("span");e.classList.add("icon","icon-external","bi","bi-box-arrow-up-right"),t.appendChild(e)}}function Y(t){t.querySelectorAll('a[href^="https://"]').forEach(Q)}function Z(t){var e=document.querySelector(".template-footer");if(t&&e){var r=t.clientHeight;e.style.marginBottom="".concat(r,"px")}}function tt(t){var e=t.currentTarget.closest(".cookies-banner"),r="allowed";window.localStorage.setItem("cookies",r),o(d,r),rt(e)}function et(t){var e=t.currentTarget.closest(".cookies-banner");window.localStorage.setItem(d,""),document.cookie.split(";").forEach((t=>{const e=t.indexOf("="),r=e>-1?t.substring(0,e):t;document.cookie=r+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"})),o(d,""),rt(e)}function rt(t){t&&t.remove(),document.body.classList.add("no-cookies-banner"),L&&(window.removeEventListener("resize",L),window.removeEventListener("orientationchange",L))}var ot,at,it,nt,st,lt=function(){return lt=Object.assign||function(t){for(var e,r=1,o=arguments.length;r<o;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t},lt.apply(this,arguments)},ct={dots:!0,arrows:!1,lazyLoad:"ondemand",infinite:!0,speed:1e3,slidesToShow:4,slidesToScroll:1,swipeToSlide:!0,autoplay:!0,autoplaySpeed:2e3,pauseOnHover:!0},dt={},ut={phoneScreenshots:{width:1200,count:5,step:200},phoneScreenshotsWide:{width:1600,count:8,step:200},browserScreenshotsWide:{width:1600,count:3,step:400}};function pt(t){var e=t.getAttribute("data-carousel-type"),r=e?dt[e]:void 0,o=e?function(t){if(t){for(var e=t.step,r=t.width,o=t.count,a=[],i={slidesToShow:o,responsive:a};o>0&&r>0;)a.push({breakpoint:r,settings:{slidesToShow:o}}),r-=e,o--;return i}}(ut[e]):void 0,a=lt(lt(lt({},ct),r),o);$(t).slick(a)}(ot=document.querySelector(".cookies-banner"))&&(null==window.localStorage.getItem(d)?function(t){var e,r;L&&(window.removeEventListener("resize",L),window.removeEventListener("orientationchange",L)),L=Z.bind(t),window.addEventListener("resize",L),window.addEventListener("orientationchange",L),Z(t),null===(e=t.querySelector("button#Accept"))||void 0===e||e.addEventListener("click",tt),null===(r=t.querySelector("button#Reject"))||void 0===r||r.addEventListener("click",et),t.classList.toggle("visible",!0)}(ot):rt(ot)),document.querySelectorAll(".text-content").forEach(Y),function(){var t=window.localStorage.getItem("projectInfo"),e=window.projectInfo;if(e&&e!==t){var r=x(t),o=x(e);o!==r&&console.warn("[checkProjectVersion] Project version has changed",o,"<->",r,{oldInfo:t,newInfo:e,oldVersion:r,newVersion:o}),window.localStorage.setItem("projectInfo",e)}}(),at=document.body,it=at.classList.contains("login_success"),nt=at.classList.contains("logged_out"),it?q():nt&&function(){if(window.localStorage){if(!window.localStorage.getItem("logged"))return;window.localStorage.removeItem("logged")}u.clearAll(),u.updateFavoritesByTrackIds([]),C.clearActivePlayerData(),C.clearFloatingPlayerState(),console.log("[userSession:onLogout]")}(),void 0===st&&(st=document.body),(w=st.querySelectorAll(".track-player[data-track-media-url]")).forEach(K),C.callbacks.addPlayStartCallback(O),C.callbacks.addPlayStopCallback(M),C.callbacks.addUpdateCallback(j),C.callbacks.addIncrementCallback(J),C.callbacks.addFavoritesCallback(X),C.callbacks.addFavoriteCallback(V),C.tracksLoaded(),function(){var t=$(".slick-carousel");if("IntersectionObserver"in window){var e=new IntersectionObserver((function(t,e){t.forEach((function(t){t.isIntersecting&&(pt(t.target),e.unobserve(t.target))}))}),{root:null,rootMargin:"50%",threshold:0});t.map((function(t,r){e.observe(r)}))}else t.map((function(t,e){return pt(e)}))}(),window.AOS&&window.AOS.init({once:!0})})();
//# sourceMappingURL=scripts.js.map