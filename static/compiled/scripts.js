(()=>{"use strict";function e(e){if(e)return Array.isArray(e)?e.map(this.getErrorText.bind(this)).join("\n"):(e instanceof Error?e=e.message:"string"!=typeof e&&(e=String(e)),e)}function t(e,t){const r=t?"&#13;":"\n";return String(e).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,r).replace(/[\r\n]/g,r)}var r={success:"bi-check",error:"bi-exclamation-triangle-fill",warn:"bi-bell-fill",info:"bi-info-lg"},n=new(function(){function t(){this.notifyRoot=void 0,this.timeoutDelay=3e3,this.inited=!1}return t.prototype.removeNotify=function(e){var t=this,r=e.node,n=e.handler;r.classList.remove("active"),n&&(clearTimeout(n),e.handler=void 0),setTimeout((function(){try{t.notifyRoot.removeChild(r)}catch(e){}}),250)},t.prototype.showNotify=function(t,n){var o,a=this;this.ensureInit(),n||(n=t,t="info"),o=n instanceof Error?e(n):String(n);var i=document.createElement("div");i.classList.add("notify"),i.classList.add("notify-"+t);var s=document.createElement("span");s.classList.add("icon"),s.classList.add("bi"),s.classList.add(r[t]),i.appendChild(s);var c=document.createElement("div");c.classList.add("text"),c.innerHTML=o,i.appendChild(c),this.notifyRoot.appendChild(i),window.requestAnimationFrame((function(){setTimeout((function(){i.classList.add("active")}),10)}));var d={node:i,handler:void 0},u=this.removeNotify.bind(this,d);d.handler=setTimeout(u,this.timeoutDelay),i.addEventListener("mouseenter",(function(){clearTimeout(d.handler)})),i.addEventListener("mouseleave",(function(){d.handler=setTimeout(u,a.timeoutDelay)})),i.addEventListener("click",u)},t.prototype.showInfo=function(e){this.showNotify("info",e)},t.prototype.showSuccess=function(e){this.showNotify("success",e)},t.prototype.showWarn=function(e){this.showNotify("warn",e)},t.prototype.showError=function(e){this.showNotify("error",e)},t.prototype.showDemo=function(){this.showInfo("Info"),this.showSuccess("Success"),this.showWarn("Warn"),this.showError("Error")},t.prototype.ensureInit=function(){this.init()},t.prototype.createDomNode=function(){var e=document.body,t=document.createElement("div");t.classList.add("notify-root"),t.setAttribute("id","notify-root"),e.appendChild(t),this.notifyRoot=t},t.prototype.init=function(){this.inited||(this.createDomNode(),this.inited=!0)},t}());function o(e){var r=document.body.querySelector("#js-texts #"+e);return r||console.warn("[getJsText] Can not find js text node for id:",e),t((null==r?void 0:r.innerHTML)||e).trim()}var a=function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}c((n=n.apply(e,t||[])).next())}))},i=function(e,t){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}};function s(t,r,n){var s=this;void 0===r&&(r="GET"),void 0===n&&(n=void 0);var c={Accept:"application/json","Content-Type":"application/json","X-CSRFToken":function(e){const t=document.cookie.split(";");for(let r=0;r<t.length;r++){const n=t[r],[o,a]=n.trim().split("=").map(decodeURIComponent);if(o===e)return a}}("csrftoken")};return fetch(t,{method:r,headers:c,credentials:"include",body:n&&JSON.stringify(n)}).then((function(e){return a(s,void 0,void 0,(function(){var a,s,d,u,l;return i(this,(function(i){switch(i.label){case 0:a=e.ok,s=e.status,d=e.statusText,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.json()];case 2:return u=i.sent(),[3,4];case 3:return i.sent(),[3,4];case 4:if(!a||200!==s){l=[o("fetchError")+" "+s,(null==u?void 0:u.detail)||d].filter(Boolean).join(": "),console.error("[sendApiRequest]",l,{ok:a,data:u,statusText:d,status:s,res:e,url:t,requestData:n,method:r,headers:c});debugger;throw new Error(l)}return[2,u]}}))}))})).catch((function(a){var i=[o("failedApiRequest"),e(a)].filter(Boolean).join(": ");console.error("[sendApiRequest]",i,{err:a,url:t,requestData:n,method:r,headers:c});debugger;throw new Error(i)}))}var c=document.body,d=void 0,u=void 0,l="true";function f(){var e=function(){if(!d){(d=document.createElement("div")).classList.add("shared-player");var e=document.createElement("audio");e.addEventListener("loadeddata",y),d.appendChild(e),c.appendChild(d)}return d}(),t=e.getElementsByTagName("audio")[0];if(!t)throw new Error(o("noAudioNodeFound"));return t}function p(e){f().currentTime=0;var t=null==u?void 0:u.dataset;t&&(delete t.status,delete t.played)}function h(e){var t=null==u?void 0:u.querySelector(".time"),r=e.currentTarget.currentTime;if(t){var n=function(e){const t=e/1e3,r=t/60,n=r/60,o=[n/24,n%24,r%60,t%60].map(Math.floor).map(((e,t)=>{if(!(t<2)||e)return t>=1?String(e).padStart(2,"0"):t?void 0:String(e)+"d"}));return[o.shift(),o.filter(Boolean).join(":")].filter(Boolean).join(" ")}(Math.floor(1e3*r));t.innerHTML=n}}function v(e){var r,o=null==u?void 0:u.dataset;o&&(o.status="playing",o.played||(o.played=l,r=u,function(){var e=u.dataset,t=e.trackId;return s("/api/v1/tracks/".concat(t,"/increment-played-count/"),"POST")}().then((function(e){var n=e.played_count,o=r.querySelector("#played_count");null!=n&&o&&(o.innerText=t(String(n)))})).catch((function(e){console.error("[tracksPlayer:incrementPlayedCount:sendIncrementPlayedCount] error",{err:e});debugger;throw n.showError(e),e}))))}function y(e){var t=f(),r=null==u?void 0:u.dataset;r&&(r.loaded=l,delete r.error),t.play()}function m(e){var t=e.currentTarget,r=t.src,a=t.type,i=o("errorLoadingAudioFile")+" "+r,s=new Error(i);console.error("[sharedPlayerError]",i,{error:s,currentTrackPlayer:u,src:r,type:a,ev:e});debugger;n.showError(i);var c=null==u?void 0:u.dataset;c&&(c.error=i,delete c.loaded,delete c.status)}function g(){var e=u.dataset,t=!!e.loaded,r=f();if(t)e.status="playing",r.play();else{e.status="waiting",delete e.loaded,delete e.error;var n=function(e){void 0===e&&(e={});for(var t=f(),r=0,n=Array.from(t.getElementsByTagName("source"));r<n.length;r++)n[r].remove();t.setAttribute("preload","auto");var o=document.createElement("source");return o.setAttribute("type",e.type||"audio/mpeg"),e.src&&o.setAttribute("src",e.src),t.addEventListener("loadeddata",y),t.addEventListener("playing",v),t.addEventListener("timeupdate",h),t.addEventListener("ended",p),o.addEventListener("error",m),t.appendChild(o),o}({src:e.trackMediaUrl});if(!n)throw new Error(o("noAudioSourceNodeFound"));r.load()}}function w(e){var t=e.currentTarget.closest(".track-player");u&&u!==t&&function(){if(d){var e=d.getElementsByTagName("audio")[0];e&&function(e){return!!e&&e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}(e)&&(e.pause(),e.currentTime=0)}if(u){var t=u.dataset;delete t.status,delete t.loaded,delete t.error,delete t.played}}();var r=t.dataset,n="playing"===r.status,o=!("waiting"===r.status||n),a=f();n?(a.pause(),r.status="paused"):o&&(u=t,g())}function b(e){var t=e.dataset,r=t.inited,n=t.trackMediaUrl;!r&&n&&(e.querySelector(".track-control-play").addEventListener("click",w),t.inited=l)}var E,T="true";function k(e){var t=e.currentTarget.closest(".track-controls").dataset,r=t.trackId,a=!t.favorite;(function(e,t){return s("/api/v1/tracks/".concat(e,"/toggle-favorite/"),"POST",{value:t})})(r,a).then((function(e){a?(t.favorite=T,n.showSuccess(o("trackAddedToFavorites"))):(delete t.favorite,n.showSuccess(o("trackRemovedFromFavorites")))})).catch((function(e){console.error("[tracksPlayer:toggleFavorite:sendToggleFavoriteRequest] error",{err:e});debugger;n.showError(e)}))}function S(e){var t=e.dataset,r=t.inited,n=t.controlId;r||("toggleFavorite"===n&&e.addEventListener("click",k),t.inited=T)}void 0===E&&(E=document.body),E.querySelectorAll(".track-player[data-track-media-url]").forEach(b),function(e){void 0===e&&(e=document.body),e.querySelectorAll(".track-controls[data-track-id] .track-control[data-control-id]").forEach(S)}()})();
//# sourceMappingURL=scripts.js.map