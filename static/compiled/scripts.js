(()=>{"use strict";function t(t,e){const r=e?"&#13;":"\n";return String(t).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,r).replace(/[\r\n]/g,r)}function e(t){const e=document.cookie.split(";");for(let r=0;r<e.length;r++){const n=e[r],[o,a]=n.trim().split("=").map(decodeURIComponent);if(o===t)return a}}var r={success:"bi-check",error:"bi-exclamation-triangle-fill",warn:"bi-bell-fill",info:"bi-info-lg"},n=new(function(){function t(){this.notifyRoot=void 0,this.timeoutDelay=3e3,this.inited=!1}return t.prototype.removeNotify=function(t){var e=this,r=t.node,n=t.handler;r.classList.remove("active"),n&&(clearTimeout(n),t.handler=void 0),setTimeout((function(){try{e.notifyRoot.removeChild(r)}catch(t){}}),250)},t.prototype.showNotify=function(t,e){var n,o=this;this.ensureInit(),e||(e=t,t="info"),n=e instanceof Error?function(t){if(t)return Array.isArray(t)?t.map(this.getErrorText.bind(this)).join("\n"):(t instanceof Error?t=t.message:"string"!=typeof t&&(t=String(t)),t)}(e):String(e);var a=document.createElement("div");a.classList.add("notify"),a.classList.add("notify-"+t);var i=document.createElement("span");i.classList.add("icon"),i.classList.add("bi"),i.classList.add(r[t]),a.appendChild(i);var c=document.createElement("div");c.classList.add("text"),c.innerHTML=n,a.appendChild(c),this.notifyRoot.appendChild(a),window.requestAnimationFrame((function(){setTimeout((function(){a.classList.add("active")}),10)}));var s={node:a,handler:void 0},u=this.removeNotify.bind(this,s);s.handler=setTimeout(u,this.timeoutDelay),a.addEventListener("mouseenter",(function(){clearTimeout(s.handler)})),a.addEventListener("mouseleave",(function(){s.handler=setTimeout(u,o.timeoutDelay)})),a.addEventListener("click",u)},t.prototype.showInfo=function(t){this.showNotify("info",t)},t.prototype.showSuccess=function(t){this.showNotify("success",t)},t.prototype.showWarn=function(t){this.showNotify("warn",t)},t.prototype.showError=function(t){this.showNotify("error",t)},t.prototype.showDemo=function(){this.showInfo("Info"),this.showSuccess("Success"),this.showWarn("Warn"),this.showError("Error")},t.prototype.ensureInit=function(){this.init()},t.prototype.createDomNode=function(){var t=document.body,e=document.createElement("div");e.classList.add("notify-root"),e.setAttribute("id","notify-root"),t.appendChild(e),this.notifyRoot=e},t.prototype.init=function(){this.inited||(this.createDomNode(),this.inited=!0)},t}()),o=function(t,e,r,n){return new(r||(r=Promise))((function(o,a){function i(t){try{s(n.next(t))}catch(t){a(t)}}function c(t){try{s(n.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,c)}s((n=n.apply(t,e||[])).next())}))},a=function(t,e){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},i=document.body,c=void 0,s=void 0,u="true";function l(){var t=function(){if(!c){(c=document.createElement("div")).classList.add("shared-player");var t=document.createElement("audio");t.addEventListener("loadeddata",h),c.appendChild(t),i.appendChild(c)}return c}(),e=t.getElementsByTagName("audio")[0];if(!e)throw new Error("No audio node found");return e}function d(t){l().currentTime=0;var e=null==s?void 0:s.dataset;e&&(delete e.status,delete e.played)}function f(t){var e=null==s?void 0:s.querySelector(".time"),r=t.currentTarget.currentTime;if(e){var n=function(t){const e=t/1e3,r=e/60,n=r/60,o=[n/24,n%24,r%60,e%60].map(Math.floor).map(((t,e)=>{if(!(e<2)||t)return e>=1?String(t).padStart(2,"0"):e?void 0:String(t)+"d"}));return[o.shift(),o.filter(Boolean).join(":")].filter(Boolean).join(" ")}(Math.floor(1e3*r));e.innerHTML=n}}function p(r){var i,c=null==s?void 0:s.dataset;c&&(c.status="playing",c.played||(c.played=u,i=s,function(){var t=this,r=s.dataset,n=r.trackId,i=e("csrftoken"),c="/api/v1/tracks/".concat(n,"/increment-played-count/");return fetch(c,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRFToken":i,sessionid:e("sessionid")},body:JSON.stringify({})}).then((function(e){return o(t,void 0,void 0,(function(){var t;return a(this,(function(r){switch(r.label){case 0:return[4,e.json()];case 1:return t=r.sent(),[2,[e,t]]}}))}))})).then((function(t){var e=t[0],r=t[1],n=e.ok,o=e.status;if(!n){var a=["Error ".concat(o),(null==r?void 0:r.detail)||e.statusText].filter(Boolean).join(": ");throw new Error(a)}return r}))}().then((function(e){var r=e.played_count,n=i.querySelector("#played_count");null!=r&&n&&(n.innerText=t(String(r)))})).catch((function(t){console.error("[tracksPlayer:incrementPlayedCount:sendIncrementPlayedCount] error",{err:t});debugger;throw n.showError(t),t}))))}function h(t){var e=l(),r=null==s?void 0:s.dataset;r&&(r.loaded=u,delete r.error),e.play()}function y(t){var e=t.currentTarget,r=e.src,o=e.type,a="Error loading audio file "+r,i=new Error(a);console.error("[sharedPlayerError]",a,{error:i,currentTrackPlayer:s,src:r,type:o,ev:t});debugger;n.showError(a);var c=null==s?void 0:s.dataset;c&&(c.error=a,delete c.loaded,delete c.status)}function v(){var t=s.dataset,e=!!t.loaded,r=l();if(e)t.status="playing",r.play();else{t.status="waiting",delete t.loaded,delete t.error;var n=function(t){void 0===t&&(t={});for(var e=l(),r=0,n=Array.from(e.getElementsByTagName("source"));r<n.length;r++)n[r].remove();e.setAttribute("preload","auto");var o=document.createElement("source");return o.setAttribute("type",t.type||"audio/mpeg"),t.src&&o.setAttribute("src",t.src),e.addEventListener("loadeddata",h),e.addEventListener("playing",p),e.addEventListener("timeupdate",f),e.addEventListener("ended",d),o.addEventListener("error",y),e.appendChild(o),o}({src:t.trackMediaUrl});if(!n)throw new Error("No audio source node found");r.load()}}function m(t){var e=t.currentTarget.closest(".track-player");s&&s!==e&&function(){if(c){var t=c.getElementsByTagName("audio")[0];t&&function(t){return!!t&&t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}(t)&&(t.pause(),t.currentTime=0)}if(s){var e=s.dataset;delete e.status,delete e.loaded,delete e.error,delete e.played}}();var r=e.dataset,n="playing"===r.status,o=!("waiting"===r.status||n),a=l();n?(a.pause(),r.status="paused"):o&&(s=e,v())}function g(t){var e=t.dataset,r=e.inited,n=e.trackMediaUrl;!r&&n&&(t.querySelector(".track-control-play").addEventListener("click",m),e.inited=u)}var w,b=function(t,e,r,n){return new(r||(r=Promise))((function(o,a){function i(t){try{s(n.next(t))}catch(t){a(t)}}function c(t){try{s(n.throw(t))}catch(t){a(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(i,c)}s((n=n.apply(t,e||[])).next())}))},E=function(t,e){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},k="true";function T(e){return t(document.body.querySelector("#js-texts #"+e).innerHTML||e).trim()}function S(t){var r=t.currentTarget.closest(".track-controls").dataset,o=r.trackId,a=!r.favorite;(function(t,r){var n=this,o=e("csrftoken"),a="/api/v1/tracks/".concat(t,"/toggle-favorite/");return fetch(a,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRFToken":o},body:JSON.stringify({value:r})}).then((function(t){return b(n,void 0,void 0,(function(){var e;return E(this,(function(r){switch(r.label){case 0:return[4,t.json()];case 1:return e=r.sent(),[2,[t,e]]}}))}))})).then((function(t){var e=t[0],r=t[1],n=e.ok,o=e.status;if(!n){var a=["Error ".concat(o),(null==r?void 0:r.detail)||e.statusText].filter(Boolean).join(": ");throw new Error(a)}return r}))})(o,a).then((function(){a?(r.favorite=k,n.showSuccess(T("trackAddedToFavorites"))):(delete r.favorite,n.showSuccess(T("trackRemovedFromFavorites")))})).catch((function(t){console.error("[tracksPlayer:toggleFavorite:sendToggleFavoriteRequest] error",{err:t});debugger;n.showError(t)}))}function L(t){var e=t.dataset,r=e.inited,n=e.controlId;r||("toggleFavorite"===n&&t.addEventListener("click",S),e.inited=k)}void 0===w&&(w=document.body),w.querySelectorAll(".track-player[data-track-media-url]").forEach(g),function(t){void 0===t&&(t=document.body),t.querySelectorAll(".track-controls[data-track-id] .track-control[data-control-id]").forEach(L)}()})();
//# sourceMappingURL=scripts.js.map