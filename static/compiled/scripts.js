(()=>{"use strict";function e(e,t){const r=t?"&#13;":"\n";return String(e).replace(/&/g,"&amp;").replace(/'/g,"&apos;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,r).replace(/[\r\n]/g,r)}function t(e){const t=document.cookie.split(";");for(let r=0;r<t.length;r++){const n=t[r],[o,a]=n.trim().split("=").map(decodeURIComponent);if(o===e)return a}}var r={success:"bi-check",error:"bi-exclamation-triangle-fill",warn:"bi-bell-fill",info:"bi-info-lg"},n=new(function(){function e(){this.notifyRoot=void 0,this.timeoutDelay=3e3,this.inited=!1}return e.prototype.removeNotify=function(e){var t=this,r=e.node,n=e.handler;r.classList.remove("active"),n&&(clearTimeout(n),e.handler=void 0),setTimeout((function(){try{t.notifyRoot.removeChild(r)}catch(e){}}),250)},e.prototype.showNotify=function(e,t){var n,o=this;this.ensureInit(),t||(t=e,e="info"),n=t instanceof Error?function(e){if(e)return Array.isArray(e)?e.map(this.getErrorText.bind(this)).join("\n"):(e instanceof Error?e=e.message:"string"!=typeof e&&(e=String(e)),e)}(t):String(t);var a=document.createElement("div");a.classList.add("notify"),a.classList.add("notify-"+e);var i=document.createElement("span");i.classList.add("icon"),i.classList.add("bi"),i.classList.add(r[e]),a.appendChild(i);var c=document.createElement("div");c.classList.add("text"),c.innerHTML=n,a.appendChild(c),this.notifyRoot.appendChild(a),window.requestAnimationFrame((function(){setTimeout((function(){a.classList.add("active")}),10)}));var s={node:a,handler:void 0},u=this.removeNotify.bind(this,s);s.handler=setTimeout(u,this.timeoutDelay),a.addEventListener("mouseenter",(function(){clearTimeout(s.handler)})),a.addEventListener("mouseleave",(function(){s.handler=setTimeout(u,o.timeoutDelay)})),a.addEventListener("click",u)},e.prototype.showInfo=function(e){this.showNotify("info",e)},e.prototype.showSuccess=function(e){this.showNotify("success",e)},e.prototype.showWarn=function(e){this.showNotify("warn",e)},e.prototype.showError=function(e){this.showNotify("error",e)},e.prototype.showDemo=function(){this.showInfo("Info"),this.showSuccess("Success"),this.showWarn("Warn"),this.showError("Error")},e.prototype.ensureInit=function(){this.init()},e.prototype.createDomNode=function(){var e=document.body,t=document.createElement("div");t.classList.add("notify-root"),t.setAttribute("id","notify-root"),e.appendChild(t),this.notifyRoot=t},e.prototype.init=function(){this.inited||(this.createDomNode(),this.inited=!0)},e}()),o=function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function c(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}s((n=n.apply(e,t||[])).next())}))},a=function(e,t){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},i=document.body,c=void 0,s=void 0,u="true";function l(){var e=function(){if(!c){(c=document.createElement("div")).classList.add("shared-player");var e=document.createElement("audio");e.addEventListener("loadeddata",h),c.appendChild(e),i.appendChild(c)}return c}(),t=e.getElementsByTagName("audio")[0];if(!t)throw new Error("No audio node found");return t}function d(e){l().currentTime=0;var t=null==s?void 0:s.dataset;t&&(delete t.status,delete t.played)}function f(e){var t=null==s?void 0:s.querySelector(".time"),r=e.currentTarget.currentTime;if(t){var n=function(e){const t=e/1e3,r=t/60,n=r/60,o=[n/24,n%24,r%60,t%60].map(Math.floor).map(((e,t)=>{if(!(t<2)||e)return t>=1?String(e).padStart(2,"0"):t?void 0:String(e)+"d"}));return[o.shift(),o.filter(Boolean).join(":")].filter(Boolean).join(" ")}(Math.floor(1e3*r));t.innerHTML=n}}function p(r){var i,c=null==s?void 0:s.dataset;c&&(c.status="playing",c.played||(c.played=u,i=s,function(){var e=this,r=s.dataset,n=r.trackId,i=t("csrftoken"),c="/api/v1/tracks/".concat(n,"/increment-played-count/");return fetch(c,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json","X-CSRFToken":i,credentials:"include",Cookie:i&&"csrftoken=".concat(i),sessionid:t("sessionid")},body:JSON.stringify({})}).then((function(t){return o(e,void 0,void 0,(function(){var e;return a(this,(function(r){switch(r.label){case 0:return[4,t.json()];case 1:return e=r.sent(),[2,[t,e]]}}))}))})).then((function(e){var t=e[0],r=e[1],n=t.ok,o=t.status;if(!n){var a=["Error ".concat(o),(null==r?void 0:r.detail)||t.statusText].filter(Boolean).join(": ");throw new Error(a)}return r}))}().then((function(t){var r=t.played_count,n=i.querySelector("#played_count");null!=r&&n&&(n.innerText=e(String(r)))})).catch((function(e){console.error("[tracksPlayer:incrementPlayedCount:sendIncrementPlayedCount] error",{err:e});debugger;throw n.showError(e),e}))))}function h(e){var t=l(),r=null==s?void 0:s.dataset;r&&(r.loaded=u,delete r.error),t.play()}function y(e){var t=e.currentTarget,r=t.src,o=t.type,a="Error loading audio file "+r,i=new Error(a);console.error("[sharedPlayerError]",a,{error:i,currentTrackPlayer:s,src:r,type:o,ev:e});debugger;n.showError(a);var c=null==s?void 0:s.dataset;c&&(c.error=a,delete c.loaded,delete c.status)}function v(){var e=s.dataset,t=!!e.loaded,r=l();if(t)e.status="playing",r.play();else{e.status="waiting",delete e.loaded,delete e.error;var n=function(e){void 0===e&&(e={});for(var t=l(),r=0,n=Array.from(t.getElementsByTagName("source"));r<n.length;r++)n[r].remove();t.setAttribute("preload","auto");var o=document.createElement("source");return o.setAttribute("type",e.type||"audio/mpeg"),e.src&&o.setAttribute("src",e.src),t.addEventListener("loadeddata",h),t.addEventListener("playing",p),t.addEventListener("timeupdate",f),t.addEventListener("ended",d),o.addEventListener("error",y),t.appendChild(o),o}({src:e.trackMediaUrl});if(!n)throw new Error("No audio source node found");r.load()}}function m(e){var t=e.currentTarget.closest(".track-player");s&&s!==t&&function(){if(c){var e=c.getElementsByTagName("audio")[0];e&&function(e){return!!e&&e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2}(e)&&(e.pause(),e.currentTime=0)}if(s){var t=s.dataset;delete t.status,delete t.loaded,delete t.error,delete t.played}}();var r=t.dataset,n="playing"===r.status,o=!("waiting"===r.status||n),a=l();n?(a.pause(),r.status="paused"):o&&(s=t,v())}function g(e){var t=e.dataset,r=t.inited,n=t.trackMediaUrl;!r&&n&&(e.querySelector(".track-control-play").addEventListener("click",m),t.inited=u)}var w,b=function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{s(n.next(e))}catch(e){a(e)}}function c(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,c)}s((n=n.apply(e,t||[])).next())}))},E=function(e,t){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(s){return function(c){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&c[0]?n.return:c[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,c[1])).done)return o;switch(n=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){a.label=c[1];break}if(6===c[0]&&a.label<o[1]){a.label=o[1],o=c;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(c);break}o[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],n=0}finally{r=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,s])}}},k="true";function T(t){return e(document.body.querySelector("#js-texts #"+t).innerHTML||t).trim()}function S(e){var r=e.currentTarget.closest(".track-controls").dataset,o=r.trackId,a=!r.favorite;(function(e,r){var n=this,o=t("csrftoken"),a="/api/v1/tracks/".concat(e,"/toggle-favorite/"),i={Accept:"application/json","Content-Type":"application/json","X-CSRFToken":o,credentials:"include",Cookie:o&&"csrftoken=".concat(o),sessionid:t("sessionid")};return fetch(a,{method:"POST",headers:i,body:JSON.stringify({value:r})}).then((function(e){return b(n,void 0,void 0,(function(){var t;return E(this,(function(r){switch(r.label){case 0:return[4,e.json()];case 1:return t=r.sent(),[2,[e,t]]}}))}))})).then((function(e){var t=e[0],r=e[1],n=t.ok,o=t.status;if(!n){var a=["Error ".concat(o),(null==r?void 0:r.detail)||t.statusText].filter(Boolean).join(": ");throw new Error(a)}return r}))})(o,a).then((function(){a?(r.favorite=k,n.showSuccess(T("trackAddedToFavorites"))):(delete r.favorite,n.showSuccess(T("trackRemovedFromFavorites")))})).catch((function(e){console.error("[tracksPlayer:toggleFavorite:sendToggleFavoriteRequest] error",{err:e});debugger;n.showError(e)}))}function L(e){var t=e.dataset,r=t.inited,n=t.controlId;r||("toggleFavorite"===n&&e.addEventListener("click",S),t.inited=k)}void 0===w&&(w=document.body),w.querySelectorAll(".track-player[data-track-media-url]").forEach(g),function(e){void 0===e&&(e=document.body),e.querySelectorAll(".track-controls[data-track-id] .track-control[data-control-id]").forEach(L)}()})();
//# sourceMappingURL=scripts.js.map